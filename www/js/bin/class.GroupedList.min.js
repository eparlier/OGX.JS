if(void 0===OGX)var OGX=function(){};OGX.GroupedList=function(e){"use strict";var t,i,s,n,a,l=this,d=e,r={group_by:"name",group_mode:null,group_param:null,sort:null,template:"",css:"",enabled:!0,list:new OGX.List,mode:OGX.NestedList.MODE_STATIC,display:null,key:null,list_mode:null},u={},o="mousedown";function c(e){var t,i=[];for(var s in e){t={title:d.group_mode?s:e[s][0].item[d.group_by],body:"",scopes:["public"],open:!0,items:[]};for(var l=0;l<e[s].length;l++)d.mode===OGX.NestedList.MODE_STATIC?t.body+='<span class="ogx_grouped_list_item '+d.css+'" data-id="'+e[s][l].pos+'">'+OGX.Templater.templatize(e[s][l].item,d.template)+"</span>":t.items.push(e[s][l].item);i.push(t)}return i}function f(e){e?d.mode===OGX.NestedList.MODE_STATIC?l.el.on(o,".ogx_grouped_list_item",function(){l.el.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(this).addClass("ogx_grouped_list_selected_item");var e=d.list[Number($(this).data("id"))];l.el.trigger(OGX.GroupedList.SELECT,e)}):l.el.on(OGX.DynamicList.SELECT,function(e,t){e.stopImmediatePropagation(),l.el.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(e.target).children(".ogx_dynamic_list_selected_item:first").addClass("ogx_grouped_list_selected_item"),l.el.trigger(OGX.GroupedList.SELECT,t)}):d.mode===OGX.NestedList.MODE_STATIC?l.el.off(o,".ogx_grouped_list_item"):l.el.off(OGX.DynamicList.SELECT)}function m(e){if("object"==typeof u[e]){switch(u[e]._NAME_){case OGX.DynamicList.NAME:u[e].el.off(OGX.DynamicList.SELECT),u[e].el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:u[e].el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:u[e].el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:u[e].el.off(OGX.DynamicList.CHANGE);break;default:u[e].off("input")}d.list.removeFilter(e),delete u[e],n=d.list.filter(),a=!0,_()}return!0}function g(e,t){for(var i=u[e].getSelection(),s=[],l=0;l<i.length;l++)s.push(i[l][t]);return s}function _(){if(d.list){var e=d.list;return a&&(e=n),e=e.group(d.group_by,d.group_mode,d.group_param),i.setData(c(e)),!0}return!1}this._NAME_=OGX.GroupedList.NAME,this.el=null,this.val=function(e){if(void 0===e)return d.list;e.hasOwnProperty("insert")?d.list=e:d.list=new OGX.List(e),s=d.list.group(d.group_by,d.group_mode,d.group_param),i.setData(c(s))},this.bind=function(e,t,i,s){return!u.hasOwnProperty(e)&&function(i,e,s,l){null==s&&(s=i);null==l&&(l="eqjson");if("object"==typeof e)switch((u[i]=e)._NAME_){case OGX.DynamicList.NAME:d.list.removeFilter(i);var r=g(i,s);d.list.addFilter(i,l,r),u[i].el.on(OGX.DynamicList.SELECT,function(e,t){d.list.removeFilter(i),r=u[i].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||u[i].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?u[i].getSelection()[0][s]:g(i,s),d.list.addFilter(i,l,r),n=d.list.filter(),a=!0,_()}),u[i].el.on(OGX.DynamicList.UNSELECT,function(e,t){d.list.removeFilter(i),0<(r=u[i].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||u[i].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:g(i,s)).length&&d.list.addFilter(i,l,r),n=d.list.filter(),a=!0,_()});break;case OGX.TagManager.NAME:d.list.removeFilter(i),d.list.addFilter(i,l,e.getCurrentTags()),u[i].el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(e,t){d.list.removeFilter(i),d.list.addFilter(i,l,u[i].getCurrentTags()),n=d.list.filter(),a=!0,_()});break;case OGX.Switch.NAME:d.list.removeFilter(i),d.list.addFilter(i,l,e.val()),u[i].el.on(OGX.Switch.TOGGLE,function(e,t){d.list.removeFilter(i),d.list.addFilter(i,l,t),n=d.list.filter(),a=!0,_()});break;case OGX.SwitchMulti.NAME:d.list.removeFilter(i),d.list.addFilter(i,l,e.val()),u[i].el.on(OGX.DynamicList.CHANGE,function(e,t){d.list.removeFilter(i),d.list.addFilter(i,l,t),n=d.list.filter(),a=!0,_()})}else if("string"==typeof e){if(0===$(e).length)return!1;var t;switch(u[i]=$(e),$(e).attr("type").toLowerCase()){case"text":case"number":case"email":case"password":u[i].on("input",function(){t=$(this).val(),d.list.removeFilter(i),t.length&&d.list.addFilter(i,l,t),n=d.list.filter(),a=!0,_()});break;case"range":var o;u[i].on("input",function(){o=Number($(this).attr("min")),d.list.removeFilter(i),d.list.addFilter(i,l,[o,$(this).val()]),n=d.list.filter(),a=!0,_()})}}}(e,t,i,s)},this.unbind=function(e){return!!u.hasOwnProperty(e)&&m(e)},this.filter=function(){n=d.list.filter(),a=!0,_()},this.unfilter=function(){a=!1,_()},this.addFilter=function(e,t,i){return d.list.addFilter(e,t,i)},this.removeFilter=function(e,t,i){return d.list.removeFilter(e,t,i)},this.resetFilters=function(){return d.list.resetFilters()},this.getFilters=function(){return d.list.getFilters()},this.enable=function(){d.enabled||(f(d.enabled=!0),i.enable())},this.disable=function(){d.enabled&&(f(d.enabled=!1),i.disable())},this.render=function(){return _()},this.refresh=function(){if(d.mode===OGX.NestedList.MODE_STATIC){var e=l.el.find(".ogx_grouped_list_selected_item:first");if(0<e.length){var t=e.data("id");e.html(OGX.Templater.templatize(d.list[t],d.template))}}},this.getNested=function(){return i||!1},this.destroy=function(){!function(){for(var e in u)m(e)}(),f(!1),i.destroy()},function(){if("undefined"!=typeof moment)if(void 0!==OGX.List)if(void 0!==OGX.Templater)if(void 0!==OGX.NestedList){!function(){for(var e in r)d.hasOwnProperty(e)||(d[e]=r[e]);0<d.list.length&&!d.list.hasOwnProperty("insert")&&(d.list=new OGX.List(d.list)),void 0!==window.ontouchstart&&(o="touchstart"),l.el=t=$(d.container),t.addClass("ogx_grouped_list")}();var e=c(s=d.list.group(d.group_by,d.group_mode,d.group_param));d.display&&d.display.hasOwnProperty("css")&&(d.display.css+=" ogx_grouped_list_item"),i=new OGX.NestedList({container:d.container,enabled:d.enabled,data:e,mode:d.mode,display:d.display,key:d.key}),d.enabled&&f(!0)}else console.log("%c CRITICAL ERROR - OGX.NestedList not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - moment.js not found! ","background:#222; color: #FF0000")}()},OGX.GroupedList.NAME="OgxGroupedList",OGX.GroupedList.SELECT="GroupedListSelect";