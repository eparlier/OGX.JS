if(void 0===OGX)var OGX=function(){};OGX.GroupedList=function(t){"use strict";var i,s,r,n,a,e=this,d=t,l={group_by:"name",group_mode:null,group_param:null,sort:null,mode:"static",template:null,css:"",enabled:!0,list:new OGX.List,display:null,key:null,list_mode:null},u={},o="mousedown";function c(t){var e,i=[];for(var s in t){e={title:d.group_mode?s:t[s][0].item[d.group_by],body:"",scopes:["public"],open:!0,items:[]};for(var r=0;r<t[s].length;r++)d.template?e.body+='<span class="ogx_grouped_list_item '+d.css+'" data-id="'+t[s][r].pos+'">'+OGX.Templater.templatize(t[s][r].item,d.template)+"</span>":(e.items.push(t[s][r].item),d.mode="dynamic");i.push(e)}return i}function f(t){t?"static"===d.mode?i.on(o,".ogx_grouped_list_item",function(){i.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(this).addClass("ogx_grouped_list_selected_item");var t=d.list[Number($(this).data("id"))];i.trigger(OGX.GroupedList.SELECT,t)}):i.on(OGX.DynamicList.SELECT,function(t,e){t.stopImmediatePropagation(),i.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(t.target).children(".ogx_dynamic_list_selected_item:first").addClass("ogx_grouped_list_selected_item"),i.trigger(OGX.GroupedList.SELECT,e),s.resetListSelection()}):"static"===d.mode?i.off(o,".ogx_grouped_list_item"):i.off(OGX.DynamicList.SELECT)}function m(t){if("object"==typeof u[t]){switch(u[t]._NAME_){case OGX.DynamicList.NAME:u[t].el.off(OGX.DynamicList.SELECT),u[t].el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:u[t].el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:u[t].el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:u[t].el.off(OGX.DynamicList.CHANGE);break;default:u[t].off("input")}d.list.removeFilter(t),delete u[t],n=d.list.filter(),a=!0,p()}return!0}function g(t,e){for(var i=u[t].getSelection(),s=[],r=0;r<i.length;r++)s.push(i[r][e]);return s}function p(){if(d.list){var t=d.list;return a&&(t=n),t=t.group(d.group_by,d.group_mode,d.group_param),s.setData(c(t)),!0}return!1}this._NAME_=OGX.GroupedList.NAME,this.el=null,this.val=function(t){if(void 0===t)return d.list;if(a)var e=d.list.getFilters();t.hasOwnProperty("insert")?d.list=t:d.list=new OGX.List(t),a?(d.list.setFilters(e),r=d.list.filter()):r=d.list,r=r.group(d.group_by,d.group_mode,d.group_param),s.setData(c(r))},this.bind=function(t,e,i,s){return!u.hasOwnProperty(t)&&function(i,t,s,r){null==s&&(s=i);null==r&&(r="eqjson");if("object"==typeof t)switch((u[i]=t)._NAME_){case OGX.DynamicList.NAME:d.list.removeFilter(i);var l=g(i,s);d.list.addFilter(i,r,l),u[i].el.on(OGX.DynamicList.SELECT,function(t,e){d.list.removeFilter(i),l=u[i].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||u[i].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?u[i].getSelection()[0][s]:g(i,s),d.list.addFilter(i,r,l),n=d.list.filter(),a=!0,p()}),u[i].el.on(OGX.DynamicList.UNSELECT,function(t,e){d.list.removeFilter(i),0<(l=u[i].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||u[i].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:g(i,s)).length&&d.list.addFilter(i,r,l),n=d.list.filter(),a=!0,p()});break;case OGX.TagManager.NAME:d.list.removeFilter(i),d.list.addFilter(i,r,t.getCurrentTags()),u[i].el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(t,e){d.list.removeFilter(i),d.list.addFilter(i,r,u[i].getCurrentTags()),n=d.list.filter(),a=!0,p()});break;case OGX.Switch.NAME:d.list.removeFilter(i),d.list.addFilter(i,r,t.val()),u[i].el.on(OGX.Switch.TOGGLE,function(t,e){d.list.removeFilter(i),d.list.addFilter(i,r,e),n=d.list.filter(),a=!0,p()});break;case OGX.SwitchMulti.NAME:d.list.removeFilter(i),d.list.addFilter(i,r,t.val()),u[i].el.on(OGX.DynamicList.CHANGE,function(t,e){d.list.removeFilter(i),d.list.addFilter(i,r,e),n=d.list.filter(),a=!0,p()})}else if("string"==typeof t){if(0===$(t).length)return!1;var e;switch(u[i]=$(t),$(t).attr("type").toLowerCase()){case"text":case"number":case"email":case"password":u[i].on("input",function(){e=$(this).val(),d.list.removeFilter(i),e.length&&d.list.addFilter(i,r,e),n=d.list.filter(),a=!0,p()});break;case"range":var o;u[i].on("input",function(){o=Number($(this).attr("min")),d.list.removeFilter(i),d.list.addFilter(i,r,[o,$(this).val()]),n=d.list.filter(),a=!0,p()})}}}(t,e,i,s)},this.unbind=function(t){return!!u.hasOwnProperty(t)&&m(t)},this.filter=function(){n=d.list.filter(),a=!0,p()},this.unfilter=function(){a=!1,p()},this.addFilter=function(t,e,i){return d.list.addFilter(t,e,i)},this.removeFilter=function(t,e,i){return d.list.removeFilter(t,e,i)},this.resetFilters=function(){return d.list.resetFilters()},this.getFilters=function(){return d.list.getFilters()},this.merge=function(t){t.hasOwnProperty("insert")||(t=new OGX.List(t));var e=t.group(d.group_by,d.group_mode,d.group_param);e=c(e),s.addData(e),d.list=new OGX.List(d.list.concat(t))},this.enable=function(){d.enabled||(f(d.enabled=!0),s.enable())},this.disable=function(){d.enabled&&(f(d.enabled=!1),s.disable())},this.render=function(){return p()},this.refresh=function(){var t=i.find(".ogx_grouped_list_selected_item:first");if(0<t.length){var e=t.data("id");t.html(OGX.Templater.templatize(d.list[e],d.template))}},this.getNested=function(){return s||!1},this.destroy=function(){!function(){for(var t in u)m(t)}(),f(!1),s.destroy()},function(){if("undefined"!=typeof moment)if(void 0!==OGX.List)if(void 0!==OGX.Templater)if(void 0!==OGX.NestedList){!function(){for(var t in l)d.hasOwnProperty(t)||(d[t]=l[t]);0<d.list.length&&!d.list.hasOwnProperty("insert")&&(d.list=new OGX.List(d.list)),void 0!==window.ontouchstart&&(o="touchstart"),e.el=i=$(d.container),i.addClass("ogx_grouped_list")}();var t=c(r=d.list.group(d.group_by,d.group_mode,d.group_param));d.display&&d.display.hasOwnProperty("css")&&(d.display.css+=" ogx_grouped_list_item"),i.on(OGX.NestedList.READY,function(){i.off(OGX.NestedList.READY),d.enabled&&f(!0)}),s=new OGX.NestedList({container:i,enabled:d.enabled,data:t,display:d.display,key:d.key})}else console.log("%c CRITICAL ERROR - OGX.NestedList not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - moment.js not found! ","background:#222; color: #FF0000")}()},OGX.GroupedList.NAME="OgxGroupedList",OGX.GroupedList.SELECT="GroupedListSelect";