if(void 0===OGX)var OGX=function(){};OGX.GroupedList=function(t){"use strict";var e,i,r,s,a,o=this,u=t,n={group_by:"name",group_mode:null,group_param:null,sort:null,template:"",css:"",enabled:!0,list:new OGX.List},d={},l="mousedown";function c(t){var e,i=[];for(var r in t){e={title:u.group_mode?r:t[r][0].item[u.group_by],body:"",scopes:["public"],open:!0};for(var o=0;o<t[r].length;o++)e.body+='<span class="ogx_grouped_list_item '+u.css+'" data-id="'+t[r][o].pos+'">'+OGX.Templater.templatize(t[r][o].item,u.template)+"</span>";i.push(e)}return i}function f(t){t?o.el.on(l,".ogx_grouped_list_item",function(){o.el.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(this).addClass("ogx_grouped_list_selected_item");var t=u.list[Number($(this).data("id"))];o.el.trigger(OGX.GroupedList.SELECT,t)}):o.el.off(l,".ogx_grouped_list_item")}function p(t){if("object"==typeof d[t]){switch(d[t].__proto__.constructor){case OGX.prototype.DynamicList:d[t].el.off(OGX.DynamicList.SELECT),d[t].el.off(OGX.DynamicList.UNSELECT);break;case OGX.prototype.TagManager:d[t].el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.prototype.Switch:d[t].el.off(OGX.Switch.TOGGLE);break;case OGX.prototype.SwitchMulti:d[t].el.off(OGX.DynamicList.CHANGE);break;default:d[t].off("input")}u.list.removeFilter(t),delete d[t],s=u.list.filter(),a=!0,m()}return!0}function g(t,e){for(var i=d[t].getSelection(),r=[],o=0;o<i.length;o++)r.push(i[o][e]);return r}function m(){if(u.list){var t=u.list;return a&&(t=s),t=t.group(u.group_by,u.group_mode,u.group_param),i.setData(c(t)),!0}return!1}this._NAME_=OGX.GroupedList.NAME,this.el=null,this.val=function(t){if(void 0===t)return u.list;t.hasOwnProperty("insert")?u.list=t:u.list=new OGX.List(t),r=u.list.group(u.group_by,u.group_mode,u.group_param),i.setData(c(r))},this.bind=function(t,e,i,r){return!d.hasOwnProperty(t)&&function(i,t,r,o){null==r&&(r=i);null==o&&(o="eqjson");if("object"==typeof t)switch((d[i]=t).__proto__.constructor){case OGX.prototype.DynamicList:u.list.removeFilter(i);var n=g(i,r);u.list.addFilter(i,o,n),d[i].el.on(OGX.DynamicList.SELECT,function(t,e){u.list.removeFilter(i),n=d[i].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||d[i].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?d[i].getSelection()[0][r]:g(i,r),u.list.addFilter(i,o,n),s=u.list.filter(),a=!0,m()}),d[i].el.on(OGX.DynamicList.UNSELECT,function(t,e){u.list.removeFilter(i),0<(n=d[i].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||d[i].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:g(i,r)).length&&u.list.addFilter(i,o,n),s=u.list.filter(),a=!0,m()});break;case OGX.prototype.TagManager:u.list.removeFilter(i),u.list.addFilter(i,o,t.getCurrentTags()),d[i].el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(t,e){u.list.removeFilter(i),u.list.addFilter(i,o,d[i].getCurrentTags()),s=u.list.filter(),a=!0,m()});break;case OGX.prototype.Switch:u.list.removeFilter(i),u.list.addFilter(i,o,t.val()),d[i].el.on(OGX.Switch.TOGGLE,function(t,e){u.list.removeFilter(i),u.list.addFilter(i,o,e),s=u.list.filter(),a=!0,m()});break;case OGX.prototype.SwitchMulti:u.list.removeFilter(i),u.list.addFilter(i,o,t.val()),d[i].el.on(OGX.DynamicList.CHANGE,function(t,e){u.list.removeFilter(i),u.list.addFilter(i,o,e),s=u.list.filter(),a=!0,m()})}else if("string"==typeof t){if(0===$(t).length)return!1;var e;switch(d[i]=$(t),$(t).attr("type").toLowerCase()){case"text":case"number":case"email":case"password":d[i].on("input",function(){e=$(this).val(),u.list.removeFilter(i),e.length&&u.list.addFilter(i,o,e),s=u.list.filter(),a=!0,m()});break;case"range":var l;d[i].on("input",function(){l=Number($(this).attr("min")),u.list.removeFilter(i),u.list.addFilter(i,o,[l,$(this).val()]),s=u.list.filter(),a=!0,m()})}}}(t,e,i,r)},this.unbind=function(t){return!!d.hasOwnProperty(t)&&p(t)},this.filter=function(){s=u.list.filter(),a=!0,m()},this.unfilter=function(){a=!1,m()},this.addFilter=function(t,e,i){return u.list.addFilter(t,e,i)},this.removeFilter=function(t,e,i){return u.list.removeFilter(t,e,i)},this.resetFilters=function(){return u.list.resetFilters()},this.getFilters=function(){return u.list.getFilters()},this.enable=function(){u.enabled||(f(u.enabled=!0),i.enable())},this.disable=function(){u.enabled&&(f(u.enabled=!1),i.disable())},this.render=function(){return m()},this.refresh=function(){var t=o.el.find(".ogx_grouped_list_selected_item:first");if(0<t.length){var e=t.data("id");t.html(OGX.Templater.templatize(u.list[e],u.template))}},this.getNested=function(){return i||!1},this.destroy=function(){!function(){for(var t in d)p(t)}(),f(!1),i.destroy()},function(){if("undefined"!=typeof moment)if(void 0!==OGX.List)if(void 0!==OGX.Templater)if(void 0!==OGX.NestedList){!function(){for(var t in n)u.hasOwnProperty(t)||(u[t]=n[t]);0<u.list.length&&!u.list.hasOwnProperty("insert")&&(u.list=new OGX.List(u.list)),void 0!==window.ontouchstart&&(l="touchstart"),o.el=e=$(u.container),e.addClass("ogx_grouped_list")}();var t=c(r=u.list.group(u.group_by,u.group_mode,u.group_param));i=new OGX.NestedList({container:u.container,enabled:u.enabled,data:t}),u.enabled&&f(!0)}else console.log("%c CRITICAL ERROR - OGX.NestedList not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - moment.js not found! ","background:#222; color: #FF0000")}()},OGX.GroupedList.NAME="OgxGroupedList",OGX.GroupedList.SELECT="GroupedListSelect";