if(void 0===OGX)var OGX=function(){};OGX.GroupedList=function(e){"use strict";var r,o,i,s,l,t=this,n=e,p={group_by:"name",group_mode:null,group_param:null,sort:null,mode:"static",template:null,css:"",enabled:!0,list:new OGX.List,display:null,key:null,list_mode:null},a={},c="mousedown";function d(e){var t,r=[];for(var o in e){t={title:n.group_mode?o:e[o][0].item[n.group_by],body:"",scopes:["public"],open:!0,items:[]};for(var i=0;i<e[o].length;i++)n.template?t.body+='<span class="ogx_grouped_list_item '+n.css+'" data-id="'+e[o][i].pos+'">'+OGX.Templater.templatize(e[o][i].item,n.template)+"</span>":(t.items.push(e[o][i].item),n.mode="dynamic");r.push(t)}return r}function u(e){e?"static"===n.mode?r.on(c,".ogx_grouped_list_item",function(){r.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(this).addClass("ogx_grouped_list_selected_item");var e=n.list[Number($(this).data("id"))];r.trigger(OGX.GroupedList.SELECT,e)}):r.on(OGX.DynamicList.SELECT,function(e,t){e.stopImmediatePropagation(),r.find(".ogx_grouped_list_selected_item").removeClass("ogx_grouped_list_selected_item"),$(e.target).children(".ogx_dynamic_list_selected_item:first").addClass("ogx_grouped_list_selected_item"),r.trigger(OGX.GroupedList.SELECT,t),o.resetListSelection()}):"static"===n.mode?r.off(c,".ogx_grouped_list_item"):r.off(OGX.DynamicList.SELECT)}function m(e){if("object"==typeof a[e].object){switch(a[e].object._NAME_){case OGX.DynamicList.NAME:a[e].object.el.off(OGX.DynamicList.SELECT),a[e].object.el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:a[e].object.el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:a[e].object.el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:a[e].object.el.off(OGX.SwitchMulti.CHANGE);break;default:a[e].object.off("input")}n.list.removeFilter(e),delete a[e],s=n.list.filter(),l=!0,setTimeout(f,0)}else a[e].object.off("input");return!0}function y(e,t){for(var r=a[e].getSelection(),o=[],i=0;i<r.length;i++)o.push(r[i][t]);return o}function f(){if(n.list){var e=n.list;return l&&(e=s),e=e.group(n.group_by,n.group_mode,n.group_param),o.setData(d(e)),!0}return!1}this._NAME_=OGX.GroupedList.NAME,this.el=null,this.val=function(e){if(void 0===e)return n.list;if(l)var t=n.list.getFilters();e.hasOwnProperty("insert")?n.list=e:n.list=new OGX.List(e),l?(n.list.setFilters(t),i=n.list.filter()):i=n.list,i=i.group(n.group_by,n.group_mode,n.group_param),o.setData(d(i))},this.bind=function(e){return!a.hasOwnProperty(e.property)&&function(r){r.hasOwnProperty("mode")||(r.mode="eqjson");if("object"==typeof r.object)switch((a[r.property]=r).object._NAME_){case OGX.DynamicList.NAME:n.list.removeFilter(r.property);var o=y(r.property,r.remote_property);n.list.addFilter(r.property,r.mode,o),a[r.property].object.el.on(OGX.DynamicList.SELECT,function(e,t){return n.list.removeFilter(r.property),o=a[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||a[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?a[r.property].object.getSelection()[0][__object.remote_property]:y(r.property,r.remote_property),n.list.addFilter(r.property,r.mode,o),s=n.list.filter(),l=!0,setTimeout(f,0),!1}),a[r.property].object.el.on(OGX.DynamicList.UNSELECT,function(e,t){return n.list.removeFilter(r.property),0<(o=a[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||a[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:y(r.property,r.remote_property)).length&&n.list.addFilter(r.property,r.mode,o),s=n.list.filter(),l=!0,setTimeout(f,0),!1});break;case OGX.TagManager.NAME:n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,r.object.getCurrentTags()),a[r.property].object.el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(e,t){return n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,a[r.property].object.getCurrentTags()),s=n.list.filter(),l=!0,setTimeout(f,0),!1});break;case OGX.Switch.NAME:n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,r.object.val()),a[r.property].object.el.on(OGX.Switch.TOGGLE,function(e,t){return n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,t),s=n.list.filter(),l=!0,setTimeout(f,0),!1});break;case OGX.SwitchMulti.NAME:n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,r.object.val()),a[r.property].object.el.on(OGX.SwitchMulti.CHANGE,function(e,t){return n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,t),s=n.list.filter(),l=!0,setTimeout(f,0),!1})}else if("string"==typeof r.object){if(0===$(r.object).length)return!1;r.object=$(r.object);var e=(a[r.property]=r).object.val();switch(n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,r.object.val()),a[r.property].hasOwnProperty("min_length")&&(a[r.property].last_val=r.object.val()),r.object.attr("type").toLowerCase()){case"text":case"number":case"email":case"password":case"tel":a[r.property].object.on("input",function(){return e=$(this).val(),n.list.removeFilter(r.property),a[r.property].hasOwnProperty("min_length")?e.length<a[r.property].min_length&&a[r.property].last_val.length>=a[r.property].min_length||e.length>=a[r.property].min_length?(e.length>=a[r.property].min_length&&n.list.addFilter(r.property,r.mode,e),s=n.list.filter(),l=!0,a[r.property].last_val=e,setTimeout(f,0)):a[r.property].last_val=e:(e.length&&n.list.addFilter(r.property,r.mode,e),s=n.list.filter(),l=!0,setTimeout(f,0)),!1});break;case"range":var t;a[r.property].object.on("input",function(){return t=Number($(this).attr("min")),n.list.removeFilter(r.property),n.list.addFilter(r.property,r.mode,[t,$(this).val()]),s=n.list.filter(),l=!0,setTimeout(f,0),!1})}}return!0}(e)},this.unbind=function(e){return!!a.hasOwnProperty(e)&&m(e)},this.filter=function(){return s=n.list.filter(),l=!0,setTimeout(f,0),!0},this.unfilter=function(){return l=!1,setTimeout(f,0),!0},this.addFilter=function(e,t,r){return n.list.addFilter(e,t,r)},this.removeFilter=function(e,t,r){return n.list.removeFilter(e,t,r)},this.resetFilters=function(){return n.list.resetFilters()},this.getFilters=function(){return n.list.getFilters()},this.merge=function(e){e.hasOwnProperty("insert")||(e=new OGX.List(e)),l&&(e.setFilters(n.list.getFilters()),e=e.filter());var t=e.group(n.group_by,n.group_mode,n.group_param);t=d(t),o.addData(t),n.list=new OGX.List(n.list.concat(e))},this.enable=function(){n.enabled||(u(n.enabled=!0),o.enable())},this.disable=function(){n.enabled&&(u(n.enabled=!1),o.disable())},this.render=function(){return setTimeout(f,0),!0},this.refresh=function(){var e=r.find(".ogx_grouped_list_selected_item:first");if(0<e.length){var t=e.data("id");e.html(OGX.Templater.templatize(n.list[t],n.template))}},this.getNested=function(){return o||!1},this.destroy=function(){!function(){for(var e in a)m(e)}(),u(!1),o.destroy()},function(){if("undefined"!=typeof moment)if(void 0!==OGX.List)if(void 0!==OGX.Templater)if(void 0!==OGX.NestedList){!function(){for(var e in p)n.hasOwnProperty(e)||(n[e]=p[e]);0<n.list.length&&!n.list.hasOwnProperty("insert")&&(n.list=new OGX.List(n.list)),void 0!==window.ontouchstart&&(c="touchstart"),t.el=r=$(n.container),r.addClass("ogx_grouped_list")}();var e=d(i=n.list.group(n.group_by,n.group_mode,n.group_param));n.display&&n.display.hasOwnProperty("css")&&(n.display.css+=" ogx_grouped_list_item"),r.on(OGX.NestedList.READY,function(){r.off(OGX.NestedList.READY),n.enabled&&u(!0)}),o=new OGX.NestedList({container:r,enabled:n.enabled,data:e,display:n.display,key:n.key})}else console.log("%c CRITICAL ERROR - OGX.NestedList not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000");else console.log("%c CRITICAL ERROR - moment.js not found! ","background:#222; color: #FF0000")}()},OGX.GroupedList.NAME="OgxGroupedList",OGX.GroupedList.SELECT="GroupedListSelect";