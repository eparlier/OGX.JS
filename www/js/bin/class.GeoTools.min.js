if(void 0===OGX)var OGX=function(){};OGX.GeoTools=function(t){"use strict";var r,o,e,s=this,a={map:null,markers:[],icon:"",browser_loc:null},c=t;function i(t,o){for(var e,a={},n=0;n<t.length;n++){e=!1;for(var r=0;r<o.length;r++){for(var i=0;i<o[r].address_components.length;i++)if(-1!==o[r].address_components[i].types.indexOf(t[n][0])){a[t[n][1]]=o[r].address_components[i].short_name,e=!0;break}if(e)break}}return a=s.clean(a)}function l(t){return t*(Math.PI/180)}function u(t){return Array.isArray(t)?new google.maps.LatLng(t[0],t[1]):"function"!=typeof t.lat?new google.maps.LatLng(t.lat,t.lng):t}function n(t){var o={gmap:new google.maps.LatLng(t.coords.latitude,t.coords.longitude),raw:{lat:t.coords.latitude,lng:t.coords.longitude}};e?(e(o),e=null):$(document).trigger(OGX.GeoTools.BROWSER_LOC_SUCCESS,o)}function d(t){$(document).trigger(OGX.GeoTools.BROWSER_LOC_ERROR,t)}this._NAME_=OGX.GeoTools.NAME,this.setMap=function(t){c.map=t,google.maps.event.addListenerOnce(c.map,"tilesloaded",function(){$(document).trigger(OGX.GeoTools.MAP_LOADED)})},this.getMap=function(){return c.map},this.getMapRadius=function(){return!!c.map&&function(){if(c.map){var t=c.map.getBounds(),o=t.getCenter(),e=t.getNorthEast(),a=o.lat()/57.2958,n=o.lng()/57.2958,r=e.lat()/57.2958,i=e.lng()/57.2958,s=3963*Math.acos(Math.sin(a)*Math.sin(r)+Math.cos(a)*Math.cos(r)*Math.cos(i-n));return s}return!1}()},this.getCurrentLocation=function(){return!!c.map&&(t=c.map.getCenter(),new google.maps.LatLng(t.lat(),t.lng()));var t},this.getBrowserLocation=function(t){e=void 0===t?null:t,navigator.geolocation.getCurrentPosition(n,d,{maximumAge:0,timeout:1e4,enableHighAccuracy:!0})},this.getDistance=function(t,o,e,a){var n=l(e-t),r=l(a-o),i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(l(t))*Math.cos(l(e))*Math.sin(r/2)*Math.sin(r/2),s=6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)));return Math.round(s/1e3*100)/100},this.addressToLatLng=function(t,e,a){r.geocode({address:t},function(t,o){o==google.maps.GeocoderStatus.OK?e(t[0].geometry.location,a):e(!1,a)})},this.getCityBoundaries=function(t,o,e,a,n){r.geocode({address:t+", "+o+", "+e},function(t,o){o==google.maps.GeocoderStatus.OK?a(t[0].geometry,n):a(!1,n)})},this.latLngToZip=function(t,a,o){t=u(t),r.geocode({location:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e=i([["postal_code","zip"]],t);a(e)}})},this.latLngToCountryStateCity=function(t,a,n){t=u(t),r.geocode({location:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e=i([["country","country"],["administrative_area_level_1","state"],["locality","city"]],t);a(e,n)}else a(!1,n)})},this.partialAddressToCountryStateCity=function(t,a,n){r.geocode({address:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e=i([["country","country"],["administrative_area_level_1","state"],["locality","city"],["administrative_area_level_2","city"]],t);a(e,n)}else a(!1,n)})},this.latLngToAddress=function(t,a,n){t=u(t),r.geocode({location:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e=i([["street_number","number"],["route","street"],["country","country"],["administrative_area_level_1","state"],["locality","city"]],t);t[0].hasOwnProperty("formatted_address")&&(e.formatted=t[0].formatted_address),a(e,n)}else a(!1,n)})},this.partialAddressToAddress=function(t,a,n){r.geocode({address:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e=i([["street_number","number"],["route","street"],["country","country"],["administrative_area_level_1","state"],["locality","city"]],t);t[0].hasOwnProperty("formatted_address")&&(e.formatted=t[0].formatted_address),a(e,n)}else a(!1,n)})},this.zipToAddress=function(t,o,e){this.partialAddressToAddress(zip,o,e)},this.zipToLatLng=function(t,a,n){r.geocode({address:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e={};e.lat=t[0].geometry.location.lat(),e.lng=t[0].geometry.location.lng(),a(e,n)}else a(!1,n)})},this.getRoute=function(e){var t={start:!1,end:!1,waypoints:!1,optimize:!0,mode:OGX.GeoTools.TRAVEL_MODE_CAR,callback:!1,params:!1};for(var o in t)e.hasOwnProperty(o)||(e[o]=t[o]);var a=new google.maps.DirectionsService,n={origin:e.start,destination:e.end,travelMode:e.mode};e.waypoints&&(n.waypoints=e.waypoints,e.optimize&&(n.optimizeWaypoints=!0)),a.route(n,function(t,o){o===google.maps.DirectionsStatus.OK?e.callback(t,e.params):e.callback(!1,e.params)})},this.calcRouteMinutes=function(t){for(var o=0,e=0;e<t.legs.length;e++)o+=t.legs[e].duration.value;return o=Math.round(o/60)},this.drawRoute=function(t){o||(o=new google.maps.DirectionsRenderer),o.setMap(c.map),o.setDirections(t)},this.clearMap=function(){c.map&&o&&o.setMap(null)},this.latLngToLoc=function(t,o){return new google.maps.LatLng(t,o)},this.clean=function(t,o){if(void 0===o&&(o=!1),t.hasOwnProperty("city")&&t.hasOwnProperty("vicinity")){var e=new RegExp(", "+t.city+"$","gi");t.vicinity=t.vicinity.replace(e,"")}if(o)for(var a in t)-1===o.indexOf(a)&&delete t[a];return t},"undefined"!=typeof google&&void 0!==google.maps?(r=new google.maps.Geocoder,c||(c={}),function(){for(var t in a)c.hasOwnProperty(t)||(c[t]=a[t])}(),c.map&&c.markers.length):$(document).trigger(OGX.GeoTools.ERROR_GMAP)},OGX.GeoTools.NAME="OgxGeoTools",OGX.GeoTools.ERROR="GEOTOOLS_error",OGX.GeoTools.ERROR_GMAP="GEOTOOLS_GMAP_ERROR",OGX.GeoTools.TRAVEL_MODE_CAR="DRIVING",OGX.GeoTools.TRAVEL_MODE_TRANSIT="TRANSIT",OGX.GeoTools.TRAVEL_MODE_WALK="WALKING",OGX.GeoTools.TRAVEL_MODE_BIKE="BICYCLING",OGX.GeoTools.BROWSER_LOC_SUCCESS="GEOTOOLS_BROWSER_LOC_SUCCESS",OGX.GeoTools.BROWSER_LOC_ERROR="GEOTOOLS_BROWSER_LOC_ERROR",OGX.GeoTools.MAP_LOADED="GEOTOOLS_MAP_LOADED";