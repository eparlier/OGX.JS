if(void 0===OGX)var OGX=function(){};OGX.GeoTools=function(t){"use strict";var i,o,e,a={map:null,markers:[],icon:"",browser_loc:null},d=t;function c(t){return t*(Math.PI/180)}function n(t){var o={gmap:new google.maps.LatLng(t.coords.latitude,t.coords.longitude),raw:{lat:t.coords.latitude,lng:t.coords.longitude}};e?(e(o),e=null):$(document).trigger(OGX.GeoTools.BROWSER_LOC_SUCCESS,o)}function s(t){$(document).trigger(OGX.GeoTools.BROWSER_LOC_ERROR,t)}this.setMap=function(t){d.map=t,google.maps.event.addListenerOnce(d.map,"tilesloaded",function(){$(document).trigger(OGX.GeoTools.MAP_LOADED)})},this.getMap=function(){return d.map},this.getMapRadius=function(){return!!d.map&&function(){if(d.map){var t=d.map.getBounds(),o=t.getCenter(),e=t.getNorthEast(),a=o.lat()/57.2958,n=o.lng()/57.2958,s=e.lat()/57.2958,r=e.lng()/57.2958,i=3963*Math.acos(Math.sin(a)*Math.sin(s)+Math.cos(a)*Math.cos(s)*Math.cos(r-n));return i}return!1}()},this.getCurrentLocation=function(){return!!d.map&&(t=d.map.getCenter(),new google.maps.LatLng(t.lat(),t.lng()));var t},this.getBrowserLocation=function(t){e=void 0===t?null:t,navigator.geolocation.getCurrentPosition(n,s,{maximumAge:0,timeout:1e4,enableHighAccuracy:!0})},this.getDistance=function(t,o,e,a){var n=c(e-t),s=c(a-o),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(c(t))*Math.cos(c(e))*Math.sin(s/2)*Math.sin(s/2),i=6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)));return Math.round(i/1e3*100)/100},this.addressToLatLng=function(t,e,a){i.geocode({address:t},function(t,o){o==google.maps.GeocoderStatus.OK?e(t[0].geometry.location,a):e(!1,a)})},this.getCityBoundaries=function(t,o,e,a,n){i.geocode({address:t+", "+o+", "+e},function(t,o){o==google.maps.GeocoderStatus.OK?a(t[0].geometry,n):a(!1,n)})},this.latLngToZip=function(t,a,n){i.geocode({location:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e=t[0].formatted_address.match(/([a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|([0-9]{2}[ ]?[0-9]{3})/);a(e?e[0]:null,n)}else a(!1,n)})},this.latLngToCountryStateCity=function(t,n,s){i.geocode({location:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){for(var e={},a=0;a<t[0].address_components.length;a++)-1!==t[0].address_components[a].types.indexOf("locality")&&(e.city=t[0].address_components[a].short_name),-1!==t[0].address_components[a].types.indexOf("administrative_area_level_1")&&(e.state=t[0].address_components[a].short_name),-1!==t[0].address_components[a].types.indexOf("country")&&(e.country=t[0].address_components[a].short_name);n(e,s)}else n(!1,s)})},this.partialAddressToCountryStateCity=function(t,n,s){i.geocode({address:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){for(var e={},a=0;a<t[0].address_components.length;a++)-1!==t[0].address_components[a].types.indexOf("locality")&&(e.city=t[0].address_components[a].short_name),-1!==t[0].address_components[a].types.indexOf("administrative_area_level_1")&&(e.state=t[0].address_components[a].short_name),-1!==t[0].address_components[a].types.indexOf("country")&&(e.country=t[0].address_components[a].short_name);n(e,s)}else n(!1,s)})},this.latLngToAddress=function(n,s,r){i.geocode({location:n},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e,a={};(e=t[0].formatted_address.match(/([a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|([0-9]{2}[ ]?[0-9]{3})/))&&(a.zip=e[0]),(e=t[0].formatted_address.match(/[ ]([a-zA-Z]+)$/))&&(a.country=e[1]),(e=t[0].formatted_address.match(/[ ]([A-Z]{2})[ ](?:[a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|(?:[0-9]{2}[ ]?[0-9]{3})/))&&(a.state=e[1]),(e=t[0].formatted_address.match(/(?:[, ]+)?(['a-zA-Z]+[\- ]?[a-zA-Z]+)[,](?:[ ][A-Z]{2}[ ])/))&&(a.city=e[1]),(e=t[0].formatted_address.match(/^([0-9]+)[ ]([a-zA-Z' ]+)[, ]/))&&(a.number=e[1],a.street=e[2]),a.formatted=t[0].formatted_address,a.lat=n.lat,a.lng=n.lng,s(a,r)}else s(!1,r)})},this.zipToAddress=function(t,n,s){i.geocode({address:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e,a={};(e=t[0].formatted_address.match(/([a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|([0-9]{2}[ ]?[0-9]{3})/))&&(a.zip=e[0]),(e=t[0].formatted_address.match(/[ ]([a-zA-Z]+)$/))&&(a.country=e[1]),(e=t[0].formatted_address.match(/[ ]([A-Z]{2})[ ](?:[a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|(?:[0-9]{2}[ ]?[0-9]{3})/))&&(a.state=e[1]),(e=t[0].formatted_address.match(/(?:[, ]+)?(['a-zA-Z]+[\- ]?[a-zA-Z]+)[,](?:[ ][A-Z]{2}[ ])/))&&(a.city=e[1]),(e=t[0].formatted_address.match(/^([0-9]+)[ ]([a-zA-Z' ]+)[, ]/))&&(a.number=e[1],a.street=e[2]),a.formatted=t[0].formatted_address,a.lat=t[0].geometry.location.lat(),a.lng=t[0].geometry.location.lng(),n(a,s)}else n(!1,s)})},this.zipToLatLng=function(t,a,n){i.geocode({address:t},function(t,o){if(o===google.maps.GeocoderStatus.OK){var e={};e.lat=t[0].geometry.location.lat(),e.lng=t[0].geometry.location.lng(),a(e,n)}else a(!1,n)})},this.getRoute=function(t,o,e,a,n){if(void 0===e)e=OGX.GeoTools.TRAVEL_MODE_CAR;var s={origin:t,destination:o,travelMode:e};(new google.maps.DirectionsService).route(s,function(t,o){o===google.maps.DirectionsStatus.OK?a(t,n):a(!1,n)})},this.calcRouteMinutes=function(t){for(var o=0,e=0;e<t.legs.length;e++)o+=t.legs[e].duration.value;return o=Math.round(o/60)},this.drawRoute=function(t){o||(o=new google.maps.DirectionsRenderer),o.setMap(d.map),o.setDirections(t)},this.clearMap=function(){d.map&&o&&o.setMap(null)},"undefined"!=typeof google&&void 0!==google.maps?(i=new google.maps.Geocoder,d||(d={}),function(){for(var t in a)d.hasOwnProperty(t)||(d[t]=a[t])}(),d.map&&d.markers.length):$(document).trigger(OGX.GeoTools.ERROR_GMAP)},OGX.GeoTools.ERROR="GEOTOOLS_error",OGX.GeoTools.ERROR_GMAP="GEOTOOLS_GMAP_ERROR",OGX.GeoTools.TRAVEL_MODE_CAR="GEOTOOLS_DRIVING",OGX.GeoTools.TRAVEL_MODE_TRANSIT="GEOTOOLS_TRANSIT",OGX.GeoTools.TRAVEL_MODE_WALK="GEOTOOLS_WALKING",OGX.GeoTools.TRAVEL_MODE_BIKE="GEOTOOLS_BICYCLING",OGX.GeoTools.BROWSER_LOC_SUCCESS="GEOTOOLS_BROWSER_LOC_SUCCESS",OGX.GeoTools.BROWSER_LOC_ERROR="GEOTOOLS_BROWSER_LOC_ERROR",OGX.GeoTools.MAP_LOADED="GEOTOOLS_MAP_LOADED";