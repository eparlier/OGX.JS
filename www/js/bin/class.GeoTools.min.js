if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.GeoTools=function(o){"use strict";function e(o){var e=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),t={gmap:e,raw:{lat:o.coords.latitude,lng:o.coords.longitude}};l?(l(t),l=null):$(document).trigger(OGX.GeoTools.BROWSER_LOC_SUCCESS,t)}function t(o){$(document).trigger(OGX.GeoTools.BROWSER_LOC_ERROR,o)}function a(){if(g.map){var o=g.map.getBounds(),e=o.getCenter(),t=o.getNorthEast(),a=3963,n=e.lat()/57.2958,s=e.lng()/57.2958,r=t.lat()/57.2958,d=t.lng()/57.2958,i=a*Math.acos(Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(d-s));return i}return!1}function n(){var o=g.map.getCenter(),e=new google.maps.LatLng(o.lat(),o.lng());return e}function s(){for(var o in u)g.hasOwnProperty(o)||(g[o]=u[o])}function r(){return"undefined"==typeof google||"undefined"==typeof google.maps?void $(document).trigger(OGX.GeoTools.ERROR_GMAP):(d=new google.maps.Geocoder,g||(g={}),s(),void(g.map&&g.markers.length>0))}var d,i,c,l,u={map:null,markers:[],icon:"",browser_loc:null},g=o;this.setMap=function(o){g.map=o,google.maps.event.addListenerOnce(g.map,"tilesloaded",function(){$(document).trigger(OGX.GeoTools.MAP_LOADED)})},this.getMap=function(){return g.map},this.getMapRadius=function(){return!!g.map&&a()},this.getCurrentLocation=function(){return!!g.map&&n()},this.getBrowserLocation=function(o){l="undefined"==typeof o?null:o,c=navigator.geolocation.getCurrentPosition(e,t,{maximumAge:0,timeout:1e4,enableHighAccuracy:!0})},this.addressToLatLng=function(o,e,t){d.geocode({address:o},function(o,a){a==google.maps.GeocoderStatus.OK?e(o[0].geometry.location,t):e(!1,t)})},this.getCityBoundaries=function(o,e,t,a,n){d.geocode({address:o+", "+e+", "+t},function(o,e){e==google.maps.GeocoderStatus.OK?a(o[0].geometry,n):a(!1,n)})},this.latLngToZip=function(o,e,t){d.geocode({location:o},function(o,a){if(a===google.maps.GeocoderStatus.OK){var n=o[0].formatted_address.match(/([a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|([0-9]{2}[ ]?[0-9]{3})/);n?e(n[0],t):e(null,t)}else e(!1,t)})},this.latLngToCountryStateCity=function(o,e,t){d.geocode({location:o},function(o,a){if(a===google.maps.GeocoderStatus.OK){for(var n={},s=0;s<o[0].address_components.length;s++)o[0].address_components[s].types.indexOf("locality")!==-1&&(n.city=o[0].address_components[s].short_name),o[0].address_components[s].types.indexOf("administrative_area_level_1")!==-1&&(n.state=o[0].address_components[s].short_name),o[0].address_components[s].types.indexOf("country")!==-1&&(n.country=o[0].address_components[s].short_name);e(n,t)}else e(!1,t)})},this.partialAddressToCountryStateCity=function(o,e,t){d.geocode({address:o},function(o,a){if(a===google.maps.GeocoderStatus.OK){for(var n={},s=0;s<o[0].address_components.length;s++)o[0].address_components[s].types.indexOf("locality")!==-1&&(n.city=o[0].address_components[s].short_name),o[0].address_components[s].types.indexOf("administrative_area_level_1")!==-1&&(n.state=o[0].address_components[s].short_name),o[0].address_components[s].types.indexOf("country")!==-1&&(n.country=o[0].address_components[s].short_name);e(n,t)}else e(!1,t)})},this.latLngToAddress=function(o,e,t){d.geocode({location:o},function(a,n){if(n===google.maps.GeocoderStatus.OK){var s={},r=a[0].formatted_address.match(/([a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|([0-9]{2}[ ]?[0-9]{3})/);r&&(s.zip=r[0]);var r=a[0].formatted_address.match(/[ ]([a-zA-Z]+)$/);r&&(s.country=r[1]);var r=a[0].formatted_address.match(/[ ]([A-Z]{2})[ ](?:[a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|(?:[0-9]{2}[ ]?[0-9]{3})/);r&&(s.state=r[1]);var r=a[0].formatted_address.match(/(?:[, ]+)?(['a-zA-Z]+[\- ]?[a-zA-Z]+)[,](?:[ ][A-Z]{2}[ ])/);r&&(s.city=r[1]);var r=a[0].formatted_address.match(/^([0-9]+)[ ]([a-zA-Z' ]+)[, ]/);r&&(s.number=r[1],s.street=r[2]),s.formatted=a[0].formatted_address,s.lat=o.lat,s.lng=o.lng,e(s,t)}else e(!1,t)})},this.zipToAddress=function(o,e,t){d.geocode({address:o},function(o,a){if(a===google.maps.GeocoderStatus.OK){var n={},s=o[0].formatted_address.match(/([a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|([0-9]{2}[ ]?[0-9]{3})/);s&&(n.zip=s[0]);var s=o[0].formatted_address.match(/[ ]([a-zA-Z]+)$/);s&&(n.country=s[1]);var s=o[0].formatted_address.match(/[ ]([A-Z]{2})[ ](?:[a-zA-Z][0-9][a-zA-Z][ -]?[0-9][a-zA-Z][0-9])|(?:[0-9]{2}[ ]?[0-9]{3})/);s&&(n.state=s[1]);var s=o[0].formatted_address.match(/(?:[, ]+)?(['a-zA-Z]+[\- ]?[a-zA-Z]+)[,](?:[ ][A-Z]{2}[ ])/);s&&(n.city=s[1]);var s=o[0].formatted_address.match(/^([0-9]+)[ ]([a-zA-Z' ]+)[, ]/);s&&(n.number=s[1],n.street=s[2]),n.formatted=o[0].formatted_address,n.lat=o[0].geometry.location.lat(),n.lng=o[0].geometry.location.lng(),e(n,t)}else e(!1,t)})},this.zipToLatLng=function(o,e,t){d.geocode({address:o},function(o,a){if(a===google.maps.GeocoderStatus.OK){var n={};n.lat=o[0].geometry.location.lat(),n.lng=o[0].geometry.location.lng(),e(n,t)}else e(!1,t)})},this.getRoute=function(o,e,t,a,n){if("undefined"==typeof t)var t=OGX.GeoTools.TRAVEL_MODE_CAR;var s=new google.maps.DirectionsService,r={origin:o,destination:e,travelMode:t};s.route(r,function(o,e){e===google.maps.DirectionsStatus.OK?a(o,n):a(!1,n)})},this.calcRouteMinutes=function(o){for(var e=0,t=0;t<o.legs.length;t++)e+=o.legs[t].duration.value;return e=Math.round(e/60)},this.drawRoute=function(o){i||(i=new google.maps.DirectionsRenderer),i.setMap(g.map),i.setDirections(o)},this.clearMap=function(){g.map&&i&&i.setMap(null)},r()},OGX.GeoTools=function(o){"use strict";return new OGX.prototype.GeoTools(o)},OGX.GeoTools.ERROR="GEOTOOLS_error",OGX.GeoTools.ERROR_GMAP="GEOTOOLS_GMAP_ERROR",OGX.GeoTools.TRAVEL_MODE_CAR="GEOTOOLS_DRIVING",OGX.GeoTools.TRAVEL_MODE_TRANSIT="GEOTOOLS_TRANSIT",OGX.GeoTools.TRAVEL_MODE_WALK="GEOTOOLS_WALKING",OGX.GeoTools.TRAVEL_MODE_BIKE="GEOTOOLS_BICYCLING",OGX.GeoTools.BROWSER_LOC_SUCCESS="GEOTOOLS_BROWSER_LOC_SUCCESS",OGX.GeoTools.BROWSER_LOC_ERROR="GEOTOOLS_BROWSER_LOC_ERROR",OGX.GeoTools.MAP_LOADED="GEOTOOLS_MAP_LOADED";