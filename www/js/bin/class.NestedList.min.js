if(void 0===OGX)var OGX=function(){};OGX.NestedList=function(t){"use strict";var l,e=this,s={core:!1,scopes:["public"],enabled:!0,template:'<div class="ogx_nested_list_item {{$dsp}}" data-id="{{$nest_id}}"><div class="ogx_nested_list_item_head {{$css}}"><span class="ogx_nested_list_item_title">{{$title}}</span></div><div class="ogx_nested_list_item_body"><div class="ogx_nested_list_item_content">{{$body}}</div></div></div>',list:new OGX.List,item_default:!1,map:{title:"title",body:"body"}},a={title:"",body:"",scopes:[],open:!0,key:null,view:null,list:null,_type:"",_height:0,_nest_id:0,_hidden:!1,_list:null},o=t,r=(new Date).getTime()+""+Math.round(1e3*Math.random()),d=!1,n=0,_=0,c=1,m={y:0,h:0,way:1};function h(t){switch(t._type){case"list":t._list.destroy(),t._list=null;break;case"view":app.removeFromStage(t.view.container),t.view=null}}function p(t){t?l.on("click",".ogx_nested_list_item_head",g):l.off("click",".ogx_nested_list_item_head",g)}function g(t){if(!d){d=!0;var e=$(this),i=e.parent(0).data("id"),s=!1;e.hasClass("ogx_nested_list_item_head_closed")?(m.way=1,e.addClass("ogx_nested_list_item_head_open").removeClass("ogx_nested_list_item_head_closed"),o.list.findUpdate("_nest_id",i,{open:!0},!1,1),s=!0):(m.way=0,e.removeClass("ogx_nested_list_item_head_open").addClass("ogx_nested_list_item_head_closed"),o.list.findUpdate("_nest_id",i,{open:!1},!1,1));var n=o.list.find("_nest_id",i,1);s?l.trigger(OGX.NestedList.OPEN,n):l.trigger(OGX.NestedList.CLOSE,n),setTimeout(u,0)}}function f(t){if(t.hasOwnProperty("scopes"))for(var e=0;e<t.scopes.length;e++)if(-1!==o.scopes.indexOf(t.scopes[e]))return!0;return!1}function u(){var t;!function(){var t=0;_=0,m.y=0;for(var e=m.h=0;e<o.list.length;e++)o.list[e].y=t,o.list[e]._hidden||(n||(n=l.children(".ogx_nested_list_item:eq("+e+")").children(".ogx_nested_list_item_head").outerHeight(!0)),_+=n,m.y=t,o.list[e].open&&(m.y+=o.list[e]._height,t+=o.list[e]._height,_+=o.list[e]._height),m.h=o.list[e]._height);_-=m.h}();for(var e=l.children(".ogx_nested_list_mask:first"),i=0;i<o.list.length;i++)(t=l.children(".ogx_nested_list_item:eq("+i+")")).removeClass("ogx_nested_list_item_noanim"),t.css("transform","translateY("+o.list[i].y+"px)");e.on("transitionend",function(){e.off("transitionend"),m.way||l.css("height",_+m.h),d=!1}),m.way&&l.css("height",_+m.h),setTimeout(function(){e.css({transform:"translateY("+m.y+"px)"})},0)}function v(t){var e,i,s={css:"",dsp:"ogx_nested_list_prep",nest_id:c};switch(s[o.map.title]=t[o.map.title],s[o.map.body]=t[o.map.body],t._nest_id=c,c++,t._hidden=!1,f(t)||(t._hidden=!0),t.open?s.css="ogx_nested_list_item_head_open":s.css="ogx_nested_list_item_head_closed",(i=t).hasOwnProperty("list")&&i.list?i._type="list":i.hasOwnProperty("view")&&i.view?i._type="view":i.hasOwnProperty("display")&&(i._type="display"),t._type){case"list":s[o.map.body]="";break;case"view":e=new OGX.DisplayObject(__data.view),__data.view.hasOwnProperty("data")?s[o.map.body]=e.html(__data.view.data):s[o.map.body]=e.html();break;case"display":e=new OGX.DisplayObject(t.display),s[o.map.body]=e.html(t.data)}return OGX.Templater.templatize(s,o.template)}function y(e,i){O(a,e);var s=e._hidden,t=v(e);switch(e._hidden=!1,l.children(".ogx_nested_list_mask:first").before(t),e._type){case"view":e.view.container='.ogx_nested_list[data-ogx-nested-list="'+r+'"] .ogx_nested_list_item[data-id="'+e._nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first',o.core.addToStage(e.view);break;case"list":e.container='.ogx_nested_list[data-ogx-nested-list="'+r+'"] .ogx_nested_list_item[data-id="'+e._nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first',e._list=new OGX.DynamicList(e)}setTimeout(function(){x(e),i&&o.list.push(e);var t=$('.ogx_nested_list[data-ogx-nested-list="'+r+'"] .ogx_nested_list_item[data-id="'+e._nest_id+'"]');e._hidden=s,e._hidden&&t.addClass("ogx_nested_list_item_hidden"),t.removeClass("ogx_nested_list_prep"),u()},0)}function x(t){var e=$('.ogx_nested_list[data-ogx-nested-list="'+r+'"] .ogx_nested_list_item[data-id="'+t._nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first').outerHeight(!0);t._height=e}function w(){l.empty();l.html('<div class="ogx_nested_list_mask"></div>');for(var t=0;t<o.list.length;t++)y(o.list[t],!1);setTimeout(u,0)}function O(t,e,i){for(var s in void 0===i&&(i=!1),t)e.hasOwnProperty(s)?i&&(e[s]=t[s]):e[s]=t[s]}function b(){o.list.hasOwnProperty("insert")||(o.list=new OGX.List(o.list));for(var t=0;t<o.list.length;t++)o.item_default?O(o.item_default,o.list[t]):O(a,o.list[t])}this._NAME_=OGX.NestedList.NAME,this.el=null,this.setScopes=function(t){o.scopes=t,function(){for(var t,e=0;e<o.list.length;e++)(t=l.children('.ogx_nested_list_item[data-id="'+o.list[e]._nest_id+'"]')).addClass("ogx_nested_list_item_noanim"),f(o.list[e])?(o.list[e]._hidden=!1,t.removeClass("ogx_nested_list_item_hidden")):(o.list[e]._hidden=!0,t.addClass("ogx_nested_list_item_hidden"));setTimeout(u,0)}()},this.getScopes=function(){return o.scopes},this.setData=function(t){o.list=t,b(),setTimeout(w,0)},this.getData=function(){return o.list},this.addItems=function(t){for(var e=0;e<t.length;e++)y(t,!0)},this.addItem=function(t){y(t,!0)},this.replaceItem=function(t,e){O(a,e);var s=o.list.find(o.map.title,t,1);if(!s)return!1;e._nest_id=s._nest_id;var n=l.children('.ogx_nested_list[data-ogx-nested-list="'+r+'"]');switch(s._type){case"list":s._list.destroy();break;case"view":o.core.removeFromStage(s.view.container)}var d='.ogx_nested_list_item[data-id="'+e._nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first';n.children(".ogx_nested_list_item_head:first").children(".ogx_nested_list_item_title:first").html(e[o.map.title]);var _=v(e);switch(n.replaceWith(_),e._type){case"view":e.view.container=d,o.core.addToStage(e.view);break;case"list":e._list=new OGX.DynamicList({container:d,display:e.display,key:e.key,swipe:e.swipe,reorder:e.reorder,mode:e.list_mode,list:e.list[i].list})}o.list.findReplace(o.map.title,e.title,s,1),setTimeout(function(){x(e),u()},0)},this.removeItem=function(t){return function(t){switch(t._type){case"list":t._list.destroy();break;case"view":core.app.removeFromStage(t.view.container)}return l.children('.ogx_nested_list_item[data-id="'+t._nest_id+'"]').remove(),o.list.findDelete("_nest_id",t._nest_id,1)}(o.list.find(o.map.title,t,1))},this.updateItemHeight=function(t){var e=o.list.find(o.map.title,t,1);setTimeout(function(){x(e),u()},0)},this.getView=function(t){var e=views.find(o.map.title,t,1);if(e){var i=o.core.getCurrentStage();return o.core.getView(i,e.view.container)}},this.getList=function(t){var e=o.list.find(o.map.title,t,1);return!!e&&e._list},this.enable=function(){o.enabled||p(o.enabled=!0)},this.disable=function(){o.enabled&&p(o.enabled=!1)},this.resetListSelection=function(){if(lists.length)for(var t=0;t<lists.length;t++)lists[t].resetSelection()},this.destroy=function(){o.enabled&&p(!0),function(){for(var t=0;t<o.list.length;t++)h(o.list[t])}()},void 0!==OGX.DisplayObject?void 0!==OGX.Templater?(O(s,o),b(),o.template=o.template.replace("{{$title}}","{{$"+o.map.title+"}}"),o.template=o.template.replace("{{$body}}","{{$"+o.map.body+"}}"),o.mode!==OGX.NestedList.MODE_DYNAMIC||void 0!==OGX.DynamicList?(e.el=l=$(o.container),l.addClass("ogx_nested_list"),l.attr("data-ogx-nested-list",r),setTimeout(w,0),o.enabled&&p(!0)):console.log("%c CRITICAL ERROR - OGX.DynamicList not found! ","background:#222; color: #FF0000")):console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000"):console.log("%c CRITICAL ERROR - OGX.DisplayObject not found! ","background:#222; color: #FF0000")},OGX.NestedList.NAME="OgxNestedList",OGX.NestedList.OPEN="NestedListOpen",OGX.NestedList.CLOSE="NestedListClose",OGX.NestedList.READY="NestedListReady";