if(void 0===OGX)var OGX=function(){};OGX.NestedList=function(t){"use strict";var _,e=this,s={core:!1,scopes:["public"],enabled:!0,template:'<div class="ogx_nested_list_item {{$dsp}}" data-id="{{$nest_id}}"><div class="ogx_nested_list_item_head {{$css}}"><span class="ogx_nested_list_item_title">{{$title}}</span></div><div class="ogx_nested_list_item_body"><div class="ogx_nested_list_item_content">{{$body}}</div></div></div>',list:new OGX.List,item_default:!1,map:{title:"title",body:"body"},order:!1},o={title:"",body:"",scopes:[],open:!0,key:null,view:null,list:null,_type:"",_height:0,_nest_id:0,_hidden:!1,_list:null},a=t,d=(new Date).getTime()+""+Math.round(1e3*Math.random()),l=!1,n=0,r=0,c=1,m={y:0,h:0,way:1};function h(t){switch(t._type){case"list":t._list.destroy(),t._list=null;break;case"view":app.removeFromStage(t.view.container),t.view=null}}function p(t){t?_.on("click",".ogx_nested_list_item_head",g):_.off("click",".ogx_nested_list_item_head",g)}function g(t){if(!l){l=!0;var e=$(this),i=e.parent(0).data("id"),s=!1;e.hasClass("ogx_nested_list_item_head_closed")?(m.way=1,e.addClass("ogx_nested_list_item_head_open").removeClass("ogx_nested_list_item_head_closed"),a.list.findUpdate("_nest_id",i,{open:!0},!1,1),s=!0):(m.way=0,e.removeClass("ogx_nested_list_item_head_open").addClass("ogx_nested_list_item_head_closed"),a.list.findUpdate("_nest_id",i,{open:!1},!1,1));var n=a.list.find("_nest_id",i,1);s?_.trigger(OGX.NestedList.OPEN,n):_.trigger(OGX.NestedList.CLOSE,n),setTimeout(u,0)}}function f(t){if(t.hasOwnProperty("scopes"))for(var e=0;e<t.scopes.length;e++)if(-1!==a.scopes.indexOf(t.scopes[e]))return!0;return!1}function u(){var t;!function(){var t=0;r=0,m.y=0;for(var e=m.h=0;e<a.list.length;e++)a.list[e].y=t,a.list[e]._hidden||(n||(n=_.children(".ogx_nested_list_item:eq("+e+")").children(".ogx_nested_list_item_head").outerHeight(!0)),r+=n,m.y=t,a.list[e].open&&(m.y+=a.list[e]._height,t+=a.list[e]._height,r+=a.list[e]._height),m.h=a.list[e]._height);r-=m.h}();for(var e=_.children(".ogx_nested_list_mask:first"),i=0;i<a.list.length;i++)(t=_.children('.ogx_nested_list_item[data-id="'+a.list[i]._nest_id+'"]')).removeClass("ogx_nested_list_item_noanim"),t.css("transform","translateY("+a.list[i].y+"px)");e.on("transitionend",function(){e.off("transitionend"),m.way||_.css("height",r+m.h),l=!1}),m.way&&_.css("height",r+m.h),setTimeout(function(){e.css({transform:"translateY("+m.y+"px)"})},0)}function v(t){var e,i,s={css:"",dsp:"ogx_nested_list_prep",nest_id:c};switch(s[a.map.title]=t[a.map.title],s[a.map.body]=t[a.map.body],t._nest_id=c,c++,t._hidden=!1,f(t)||(t._hidden=!0),t.open?s.css="ogx_nested_list_item_head_open":s.css="ogx_nested_list_item_head_closed",(i=t).hasOwnProperty("list")&&i.list?i._type="list":i.hasOwnProperty("view")&&i.view?i._type="view":i.hasOwnProperty("display")&&(i._type="display"),t._type){case"list":s[a.map.body]="";break;case"view":e=new OGX.DisplayObject(__data.view),__data.view.hasOwnProperty("data")?s[a.map.body]=e.html(__data.view.data):s[a.map.body]=e.html();break;case"display":e=new OGX.DisplayObject(t.display),s[a.map.body]=e.html(t.data)}return OGX.Templater.templatize(s,a.template)}function y(e,i,s){O(o,e);var n=e._hidden,t=v(e);switch(e._hidden=!1,void 0!==s&&s<a.list.length-1&&0<s?_.children(".ogx_nested_list_item:eq("+s+")").before(t):_.children(".ogx_nested_list_mask:first").before(t),e._type){case"view":e.view.container='.ogx_nested_list[data-ogx-nested-list="'+d+'"] .ogx_nested_list_item[data-id="'+e._nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first',a.core.addToStage(e.view);break;case"list":e.container='.ogx_nested_list[data-ogx-nested-list="'+d+'"] .ogx_nested_list_item[data-id="'+e._nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first',e._list=new OGX.DynamicList(e)}setTimeout(function(){x(e),i&&(void 0!==s?a.list.insert(e,s):a.list.push(e));var t=$('.ogx_nested_list[data-ogx-nested-list="'+d+'"] .ogx_nested_list_item[data-id="'+e._nest_id+'"]');e._hidden=n,e._hidden&&t.addClass("ogx_nested_list_item_hidden"),t.removeClass("ogx_nested_list_prep"),u()},0)}function x(t){var e=$('.ogx_nested_list[data-ogx-nested-list="'+d+'"] .ogx_nested_list_item[data-id="'+t._nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first').outerHeight(!0);t._height=e}function w(){_.empty();_.html('<div class="ogx_nested_list_mask"></div>');for(var t=0;t<a.list.length;t++)y(a.list[t],!1);setTimeout(u,0)}function O(t,e,i){for(var s in void 0===i&&(i=!1),t)e.hasOwnProperty(s)?i&&(e[s]=t[s]):e[s]=t[s]}function b(){a.list.hasOwnProperty("insert")||(a.list=new OGX.List(a.list));for(var t=0;t<a.list.length;t++)a.item_default?O(a.item_default,a.list[t]):O(o,a.list[t]);if(a.order){var e,i=[],s=[];for(t=0;t<a.list.length;t++)-1!==(e=a.order.indexOf(a.list[t][a.map.title]))?i[e]=a.list[t]:s.push(a.list[t]);for(t=0;t<i.length;t++)i[t]||(i.splice(t,1),t--);a.list=new OGX.List(i.concat(s))}}this._NAME_=OGX.NestedList.NAME,this.el=null,this.setScopes=function(t){a.scopes=t,function(){for(var t,e=0;e<a.list.length;e++)(t=_.children('.ogx_nested_list_item[data-id="'+a.list[e]._nest_id+'"]')).addClass("ogx_nested_list_item_noanim"),f(a.list[e])?(a.list[e]._hidden=!1,t.removeClass("ogx_nested_list_item_hidden")):(a.list[e]._hidden=!0,t.addClass("ogx_nested_list_item_hidden"));setTimeout(u,0)}()},this.getScopes=function(){return a.scopes},this.setData=function(t){a.list=t,b(),setTimeout(w,0)},this.getData=function(){return a.list},this.addItems=function(t){for(var e=0;e<t.length;e++)y(t,!0)},this.addItem=function(t){if(a.order){var e=a.order.indexOf(t[a.map.title]);if(-1!==e)return void y(t,!0,e)}y(t,!0)},this.addItemAt=function(t,e){y(t,!0,e)},this.replaceItem=function(t,e){O(o,e);var s=a.list.find(a.map.title,t,1);if(!s)return!1;e._nest_id=s._nest_id;var n=_.children('.ogx_nested_list[data-id="'+_nest_id+'"]');switch(s._type){case"list":s._list.destroy();break;case"view":a.core.removeFromStage(s.view.container)}var d='.ogx_nested_list[data-id="'+_nest_id+'"] .ogx_nested_list_item_body:first .ogx_nested_list_item_content:first';n.children(".ogx_nested_list_item_head:first").children(".ogx_nested_list_item_title:first").html(e[a.map.title]);var l=v(e);switch(n.replaceWith(l),e._type){case"view":e.view.container=d,a.core.addToStage(e.view);break;case"list":e._list=new OGX.DynamicList({container:d,display:e.display,key:e.key,swipe:e.swipe,reorder:e.reorder,mode:e.list_mode,list:e.list[i].list})}a.list.findReplace(a.map.title,e[a.map.title],s,1),setTimeout(function(){x(e),u()},0)},this.removeItem=function(t){var e=function(t){switch(t._type){case"list":t._list.destroy();break;case"view":core.app.removeFromStage(t.view.container)}return _.children('.ogx_nested_list_item[data-id="'+t._nest_id+'"]').remove(),a.list.findDelete("_nest_id",t._nest_id,1)}(a.list.find(a.map.title,t,1));return setTimeout(u,0),e},this.updateItemHeight=function(t){var e=a.list.find(a.map.title,t,1);setTimeout(function(){x(e),u()},0)},this.getView=function(t){var e=views.find(a.map.title,t,1);if(e){var i=a.core.getCurrentStage();return a.core.getView(i,e.view.container)}},this.getList=function(t){var e=a.list.find(a.map.title,t,1);return!!e&&e._list},this.enable=function(){a.enabled||p(a.enabled=!0)},this.disable=function(){a.enabled&&p(a.enabled=!1)},this.resetListSelection=function(){if(lists.length)for(var t=0;t<lists.length;t++)lists[t].resetSelection()},this.destroy=function(){a.enabled&&p(!0),function(){for(var t=0;t<a.list.length;t++)h(a.list[t])}()},void 0!==OGX.DisplayObject?void 0!==OGX.Templater?(O(s,a),b(),a.template=a.template.replace("{{$title}}","{{$"+a.map.title+"}}"),a.template=a.template.replace("{{$body}}","{{$"+a.map.body+"}}"),a.mode!==OGX.NestedList.MODE_DYNAMIC||void 0!==OGX.DynamicList?(e.el=_=$(a.container),_.addClass("ogx_nested_list"),_.attr("data-ogx-nested-list",d),setTimeout(w,0),a.enabled&&p(!0)):console.log("%c CRITICAL ERROR - OGX.DynamicList not found! ","background:#222; color: #FF0000")):console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000"):console.log("%c CRITICAL ERROR - OGX.DisplayObject not found! ","background:#222; color: #FF0000")},OGX.NestedList.NAME="OgxNestedList",OGX.NestedList.OPEN="NestedListOpen",OGX.NestedList.CLOSE="NestedListClose",OGX.NestedList.READY="NestedListReady";