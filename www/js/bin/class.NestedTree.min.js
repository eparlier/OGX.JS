if(void 0===OGX)var OGX=function(){};OGX.NestedTree=function(e){var o,_,r,n,a,d,i,s,f,l,g=this,p={scopes:["public"],padding:20,edit:!0,dragAfter:1e3,openOnDrag:!0,midThres:7,mode:OGX.NestedTree.MODE_MOBILE},m=e,c={x:0,y:0},h=!1,x=!1,v={};function u(e){return e.hasOwnProperty("originalEvent")?e.originalEvent.changedTouches[0]:e}function w(){var r,e,s,_,t,n;if(v={y:0,after:null,over:null},o.find(".ogx_nested_tree_item:visible").each(function(e,t){if(!$(t).hasClass("ogx_nested_tree_item_drag")){if(s=$(t).find(".ogx_nested_tree_item_head:first"),_=s.find(".ogx_nested_tree_item_arrow:first"),r=$(t).position().top+s.height(),Math.abs(i-(r-s.height()/2))<m.midThres)return v.over=$(t),v.after=!1,_.hasClass("ogx_nested_tree_item_arrow_closed")&&G($(t)),!0;r<i&&r>v.y&&(v.y=r,v.after=$(t))}}),(v.over||v.after)&&o.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select"),v.over)O(!1),$(v.over).find(".ogx_nested_tree_item_head:first").addClass("ogx_nested_tree_item_head_select");else if(v.after){x?(t=v.after.find(".ogx_nested_tree_item_head:first"),n=o.find(".ogx_nested_tree_bar:first").detach(),t.after(n[0]),x=o.find(".ogx_nested_tree_bar:first")):O(!0,v.after),e=x.width();var d=v.after.data("path").split("_");x.find(".ogx_nested_tree_bar_line:first").css("width",e-m.padding*(d.length-2)+"px")}}function O(e,t){if(e){t.after('<div class="ogx_nested_tree_bar"><span class="ogx_nested_tree_bar_line"></span></div>'),x=o.find(".ogx_nested_tree_bar:first")}else o.find(".ogx_nested_tree_bar:first").remove(),x=!1}function t(){if((v.over||v.after)&&((a=o.find(".ogx_nested_tree_item_drag:first").detach()).removeClass("ogx_nested_tree_item_drag"),a.css("position","static"),a.css("width","auto"),a.css("left",""),a.css("top",""),O(!1)),v.over){o.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select");var e=(d=v.over.find(".ogx_nested_tree_item_grip:first").css("margin-left"),i=d.split("px"),parseInt(i[0])),t=v.over.find(".ogx_nested_tree_item_head:first"),r=v.over.find(".ogx_nested_tree_item_body:first"),s=t.find(".ogx_nested_tree_item_noarrow:first");0<s.length&&s.removeClass("ogx_nested_tree_item_noarrow").addClass("ogx_nested_tree_item_arrow");var _=v.over.find(".ogx_nested_tree_item_arrow:first");a.find(".ogx_nested_tree_item_grip:first").css("margin-left",e+m.padding+"px"),r.append(a[0]),_.removeClass("ogx_nested_tree_item_arrow_opened"),_.addClass("ogx_nested_tree_item_arrow_closed"),r.addClass("ogx_nested_tree_body_hidden");b(a.data("path"),v.over.data("path"));v.over.find(".ogx_nested_tree_item_arrow:first").hasClass("ogx_nested_tree_item_arrow_opened")||G(v.over)}else if(v.after){r=v.after.parent(0);var n=v.after.data("path").split("_");n.pop();n.length;n=n.join("_");b(a.data("path"),n,v.after.index());a.data("path").slice(0,-2)===n&&r.children(".ogx_nested_tree_item").length===v.after.index()+1?r.append(a[0]):r.find(".ogx_nested_tree_item:eq("+v.after.index()+")").after(a[0])}var d,i;a.addClass("ogx_nested_tree_item"),y(),v.over=null,v.after=null,a=null,o.trigger(OGX.NestedTree.DRAG_END)}function y(){!function r(e,s){var _,n,d,i,o=0;e.children(".ogx_nested_tree_item").each(function(e,t){$(t).hasClass("ogx_nested_tree_item_drag")||($(t).attr("data-path",s+"_"+o),n=(n=(n=s+"_"+o).split("_")).length-2,$(t).find(".ogx_nested_tree_item_grip:first").css("margin-left",m.padding*n),_=$(t).find(".ogx_nested_tree_item_body:first"),d=$(t).find(".ogx_nested_tree_item_head:first"),i=d.find(".ogx_nested_tree_item_arrow:first"),0<_.children(".ogx_nested_tree_item").length?(i.removeClass("ogx_nested_tree_item_arrow_none"),i.addClass("ogx_nested_tree_item_arrow_closed"),r(_,s+"_"+o)):(i.addClass("ogx_nested_tree_item_arrow_none"),i.removeClass("ogx_nested_tree_item_arrow_opened"),i.removeClass("ogx_nested_tree_item_arrow_closed")),o++)})}(o,"0")}function b(e,t,r){void 0===r&&(r=!1);var s=N(e),_=e.split("_"),n=_.pop(),d=N(_=_.join("_")),i=N(t);if(d&&i)return i.hasOwnProperty("items")||(i.items=[]),r?i.items.splice(r+1,0,s):i.items.push(s),d.items.splice(n,1),i;console.log("bug: obj not found!")}function C(e){e?$("body").on(l,function(e){e=u(e);var t=a.height();a.css("top",e.pageY-t+g.el.parent(0).scrollTop()+"px"),i=e.pageY-t+o.parent(0).scrollTop(),w()}):$("body").off(l)}function T(e,t){e?({path:(d=t).data("path").split("_"),body:t.parent(0)}.path.pop(),n=!(h=!1),_=(new Date).getTime(),r=setInterval(function(){if(n){var e=(new Date).getTime();if(e-_>=m.dragAfter&&!h){h=!0,o.trigger(OGX.NestedTree.DRAG_START);var t=d.position().left,r=d.width(),s=d.height();(a=d.detach()).removeClass("ogx_nested_tree_item"),a.addClass("ogx_nested_tree_item_drag"),a.css("left",t+1+"px"),a.css("top",c.y-s+"px"),a.css("width",r+"px"),o.prepend(a),C(!0),y()}}},20)):(n=!1,clearInterval(r),r=null,C(!1))}function E(e){e?(o.on(s,".ogx_nested_tree_item_arrow",function(){G($(this).parent(0).parent(0))}),o.on(s,".ogx_nested_tree_item_grip",function(e){e=u(e),c={x:e.pageX,y:e.pageY+o.parent(0).scrollTop()},T(!0,$(this).parent(0).parent(0)),$("body").on(f,function(e){e=u(e),T(!1),h?(h=!1,t()):d=null,$("body").off(f)})})):(o.off(s,".ogx_nested_tree_item_arrow"),$("body").off(f))}function G(e){var t=e.find(".ogx_nested_tree_item_body:first"),r=N(e.data("path"));if(0<t.children().length){var s=e.find(".ogx_nested_tree_item_arrow:first");t.hasClass("ogx_nested_tree_body_hidden")?(s.removeClass("ogx_nested_tree_item_arrow_closed"),s.addClass("ogx_nested_tree_item_arrow_opened"),t.removeClass("ogx_nested_tree_body_hidden"),r.opened=!0,o.trigger(OGX.NestedTree.OPEN,r)):(s.removeClass("ogx_nested_tree_item_arrow_opened"),s.addClass("ogx_nested_tree_item_arrow_closed"),t.addClass("ogx_nested_tree_body_hidden"),r.opened=!1,o.trigger(OGX.NestedTree.CLOSE,r))}else{delete r.opened;var _=OGX.NestedTree.SELECT;e.data("event")&&(_=e.data("event")),o.trigger(_,r)}}function N(e){var t=e.split("_"),r=m.data,s=t.slice();for(s.shift();0<s.length;)r.hasOwnProperty("items")&&(r=r.items[s[0]]),s.shift();return r}function D(){!function e(t,r,s,_){r.empty();var n,d,i,o,a,f,l,g;if(t.hasOwnProperty("items")&&t.items){a=s*m.padding;for(var p=0;p<t.items.length;p++)o=" ogx_nested_tree_body_hidden",l=!(f="ogx_nested_tree_item_noarrow"),g=_+"_"+p,"",t.items[p].hasOwnProperty("opened")&&t.items[p].opened?l=!(o=""):t.items[p].opened=!1,X(t.items[p])&&(d=!1,t.items[p].hasOwnProperty("items")&&0<t.items[p].items.length?(d=!0,f="ogx_nested_tree_item_arrow",f+=l?" ogx_nested_tree_item_arrow_opened":" ogx_nested_tree_item_arrow_closed"):delete t.items[p].opened,n='<div class="ogx_nested_tree_item" data-path="'+g+'"><div class="ogx_nested_tree_item_head">',m.edit?n+='<span class="ogx_nested_tree_item_grip" style="margin-left:'+a+'px;"></span><span class="ogx_nested_tree_item_label">':n+='<span class="ogx_nested_tree_item_label" style="margin-left:'+a+'px;">',n+=t.items[p].label+'</span><span class="'+f+'"></span></div><div class="ogx_nested_tree_item_body'+o+'"></div></div>',r.append(n),i=r.find(".ogx_nested_tree_item:last").find(".ogx_nested_tree_item_body:first"),d&&e(t.items[p],i,s+1,g))}}(m.data,o,0,"0")}function X(e){if(e.hasOwnProperty("scopes"))for(var t=0;t<e.scopes.length;t++)if(-1!==m.scopes.indexOf(e.scopes[t]))return!0;return!1}this.el=null,this.setScopes=function(e){m.scopes=e},this.getData=function(){return m.data},this.setData=function(e){m.data=e,D()},this.destroy=function(){E(!1)},function(){for(var e in p)m.hasOwnProperty(e)||(m[e]=p[e]);var t=m.data.slice();switch(m.data={items:t},g.el=o=$(m.container),o.addClass("ogx_nested_tree"),m.mode){case OGX.NestedTree.MODE_MOBILE:s="touchstart",f="touchend",l="touchmove";break;case OGX.NestedTree.MODE_DESKTOP:s="mousedown",f="mouseup",l="mousemove"}m.edit||(s="click")}(),D(),E(!0)},OGX.NestedTree.SELECT="select",OGX.NestedTree.OPEN="open",OGX.NestedTree.CLOSE="close",OGX.NestedTree.DRAG_START="dragStart",OGX.NestedTree.DRAG_END="dragEnd",OGX.NestedTree.MODE_MOBILE="modeMobile",OGX.NestedTree.MODE_DESKTOP="modeDesktop";