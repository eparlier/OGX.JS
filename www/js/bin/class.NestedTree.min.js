if(void 0===OGX)var OGX=function(){};OGX.NestedTree=function(e){var o,_,r,n,a,i,d,s=this,f={scopes:["public"],padding:20,edit:!0,dragAfter:1e3,openOnDrag:!0,midThres:7},m=e,g={x:0,y:0},l=!1,p=!1,c={},h="mousedown",x="mouseup",v="mousemove";function u(e){return e.hasOwnProperty("originalEvent")&&void 0!==e.originalEvent.changedTouches?e.originalEvent.changedTouches[0]:e}function w(){var r,e,s,_,t,n;if(c={y:0,after:null,over:null},o.find(".ogx_nested_tree_item:visible").each(function(e,t){if(!$(t).hasClass("ogx_nested_tree_item_drag")){if(s=$(t).find(".ogx_nested_tree_item_head:first"),_=s.find(".ogx_nested_tree_item_arrow:first"),r=$(t).position().top+s.height(),Math.abs(d-(r-s.height()/2))<m.midThres)return c.over=$(t),c.after=!1,_.hasClass("ogx_nested_tree_item_arrow_closed")&&G($(t)),!0;r<d&&r>c.y&&(c.y=r,c.after=$(t))}}),(c.over||c.after)&&o.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select"),c.over)y(!1),$(c.over).find(".ogx_nested_tree_item_head:first").addClass("ogx_nested_tree_item_head_select");else if(c.after){p?(t=c.after.find(".ogx_nested_tree_item_head:first"),n=o.find(".ogx_nested_tree_bar:first").detach(),t.after(n[0]),p=o.find(".ogx_nested_tree_bar:first")):y(!0,c.after),e=p.width();var i=c.after.data("path").split("_");p.find(".ogx_nested_tree_bar_line:first").css("width",e-m.padding*(i.length-2)+"px")}}function y(e,t){if(e){t.after('<div class="ogx_nested_tree_bar"><span class="ogx_nested_tree_bar_line"></span></div>'),p=o.find(".ogx_nested_tree_bar:first")}else o.find(".ogx_nested_tree_bar:first").remove(),p=!1}function t(){if((c.over||c.after)&&((a=o.find(".ogx_nested_tree_item_drag:first").detach()).removeClass("ogx_nested_tree_item_drag"),a.css("position","static"),a.css("width","auto"),a.css("left",""),a.css("top",""),y(!1)),c.over){o.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select");var e=(i=c.over.find(".ogx_nested_tree_item_grip:first").css("margin-left"),d=i.split("px"),parseInt(d[0])),t=c.over.find(".ogx_nested_tree_item_head:first"),r=c.over.find(".ogx_nested_tree_item_body:first"),s=t.find(".ogx_nested_tree_item_noarrow:first");0<s.length&&s.removeClass("ogx_nested_tree_item_noarrow").addClass("ogx_nested_tree_item_arrow");var _=c.over.find(".ogx_nested_tree_item_arrow:first");a.find(".ogx_nested_tree_item_grip:first").css("margin-left",e+m.padding+"px"),r.append(a[0]),_.removeClass("ogx_nested_tree_item_arrow_opened"),_.addClass("ogx_nested_tree_item_arrow_closed"),r.addClass("ogx_nested_tree_body_hidden");T(a.data("path"),c.over.data("path"));c.over.find(".ogx_nested_tree_item_arrow:first").hasClass("ogx_nested_tree_item_arrow_opened")||G(c.over)}else if(c.after){r=c.after.parent(0);var n=c.after.data("path").split("_");n.pop();n.length;n=n.join("_");T(a.data("path"),n,c.after.index());a.data("path").slice(0,-2)===n&&r.children(".ogx_nested_tree_item").length===c.after.index()+1?r.append(a[0]):r.find(".ogx_nested_tree_item:eq("+c.after.index()+")").after(a[0])}var i,d;a.addClass("ogx_nested_tree_item"),C(),c.over=null,c.after=null,a=null,o.trigger(OGX.NestedTree.DRAG_END)}function C(){!function r(e,s){var _,n,i,d,o=0;e.children(".ogx_nested_tree_item").each(function(e,t){$(t).hasClass("ogx_nested_tree_item_drag")||($(t).attr("data-path",s+"_"+o),n=(n=(n=s+"_"+o).split("_")).length-2,$(t).find(".ogx_nested_tree_item_grip:first").css("margin-left",m.padding*n),_=$(t).find(".ogx_nested_tree_item_body:first"),i=$(t).find(".ogx_nested_tree_item_head:first"),d=i.find(".ogx_nested_tree_item_arrow:first"),0<_.children(".ogx_nested_tree_item").length?(d.removeClass("ogx_nested_tree_item_arrow_none"),d.addClass("ogx_nested_tree_item_arrow_closed"),r(_,s+"_"+o)):(d.addClass("ogx_nested_tree_item_arrow_none"),d.removeClass("ogx_nested_tree_item_arrow_opened"),d.removeClass("ogx_nested_tree_item_arrow_closed")),o++)})}(o,"0")}function T(e,t,r){void 0===r&&(r=!1);var s=E(e),_=e.split("_"),n=_.pop(),i=E(_=_.join("_")),d=E(t);if(i&&d)return d.hasOwnProperty("items")||(d.items=[]),r?d.items.splice(r+1,0,s):d.items.push(s),i.items.splice(n,1),d;console.log("bug: obj not found!")}function b(e){e?$("body").on(v,function(e){e=u(e);var t=a.height();a.css("top",e.pageY-t+s.el.parent(0).scrollTop()+"px"),d=e.pageY-t+o.parent(0).scrollTop(),w()}):$("body").off(v)}function O(e,t){e?({path:(i=t).data("path").split("_"),body:t.parent(0)}.path.pop(),n=!(l=!1),_=(new Date).getTime(),r=setInterval(function(){if(n){var e=(new Date).getTime();if(e-_>=m.dragAfter&&!l){l=!0,o.trigger(OGX.NestedTree.DRAG_START);var t=i.position().left,r=i.width(),s=i.height();(a=i.detach()).removeClass("ogx_nested_tree_item"),a.addClass("ogx_nested_tree_item_drag"),a.css("left",t+1+"px"),a.css("top",g.y-s+"px"),a.css("width",r+"px"),o.prepend(a),b(!0),C()}}},20)):(n=!1,clearInterval(r),r=null,b(!1))}function N(e){e?(o.on(h,".ogx_nested_tree_item_arrow",function(){G($(this).parent(0).parent(0))}),o.on(h,".ogx_nested_tree_item_grip",function(e){e=u(e),g={x:e.pageX,y:e.pageY+o.parent(0).scrollTop()},O(!0,$(this).parent(0).parent(0)),$("body").on(x,function(e){e=u(e),O(!1),l?(l=!1,t()):i=null,$("body").off(x)})})):(o.off(h,".ogx_nested_tree_item_arrow"),$("body").off(x))}function G(e){var t=e.find(".ogx_nested_tree_item_body:first"),r=E(e.data("path"));if(0<t.children().length){var s=e.find(".ogx_nested_tree_item_arrow:first");t.hasClass("ogx_nested_tree_body_hidden")?(s.removeClass("ogx_nested_tree_item_arrow_closed"),s.addClass("ogx_nested_tree_item_arrow_opened"),t.removeClass("ogx_nested_tree_body_hidden"),r.opened=!0,o.trigger(OGX.NestedTree.OPEN,r)):(s.removeClass("ogx_nested_tree_item_arrow_opened"),s.addClass("ogx_nested_tree_item_arrow_closed"),t.addClass("ogx_nested_tree_body_hidden"),r.opened=!1,o.trigger(OGX.NestedTree.CLOSE,r))}else{delete r.opened;var _=OGX.NestedTree.SELECT;e.data("event")&&(_=e.data("event")),o.trigger(_,r)}}function E(e){var t=e.split("_"),r=m.data,s=t.slice();for(s.shift();0<s.length;)r.hasOwnProperty("items")&&(r=r.items[s[0]]),s.shift();return r}function X(){!function e(t,r,s,_){r.empty();var n,i,d,o,a,f,g,l;if(t.hasOwnProperty("items")&&t.items){a=s*m.padding;for(var p=0;p<t.items.length;p++)o=" ogx_nested_tree_body_hidden",g=!(f="ogx_nested_tree_item_noarrow"),l=_+"_"+p,"",t.items[p].hasOwnProperty("opened")&&t.items[p].opened?g=!(o=""):t.items[p].opened=!1,D(t.items[p])&&(i=!1,t.items[p].hasOwnProperty("items")&&0<t.items[p].items.length?(i=!0,f="ogx_nested_tree_item_arrow",f+=g?" ogx_nested_tree_item_arrow_opened":" ogx_nested_tree_item_arrow_closed"):delete t.items[p].opened,n='<div class="ogx_nested_tree_item" data-path="'+l+'"><div class="ogx_nested_tree_item_head">',m.edit?n+='<span class="ogx_nested_tree_item_grip" style="margin-left:'+a+'px;"></span><span class="ogx_nested_tree_item_label">':n+='<span class="ogx_nested_tree_item_label" style="margin-left:'+a+'px;">',n+=t.items[p].label+'</span><span class="'+f+'"></span></div><div class="ogx_nested_tree_item_body'+o+'"></div></div>',r.append(n),d=r.find(".ogx_nested_tree_item:last").find(".ogx_nested_tree_item_body:first"),i&&e(t.items[p],d,s+1,l))}}(m.data,o,0,"0")}function D(e){if(e.hasOwnProperty("scopes"))for(var t=0;t<e.scopes.length;t++)if(-1!==m.scopes.indexOf(e.scopes[t]))return!0;return!1}this._NAME_=OGX.NestedTree.NAME,this.el=null,this.setScopes=function(e){m.scopes=e},this.getData=function(){return m.data},this.setData=function(e){m.data=e,X()},this.destroy=function(){N(!1)},function(){for(var e in f)m.hasOwnProperty(e)||(m[e]=f[e]);var t=m.data.slice();m.data={items:t},s.el=o=$(m.container),o.addClass("ogx_nested_tree"),void 0!==window.ontouchstart&&(h="touchstart",v="touchmove",x="touchend"),m.edit||(h="click")}(),X(),N(!0)},OGX.NestedTree.NAME="OgxNestedTree",OGX.NestedTree.SELECT="NestedTreeSelect",OGX.NestedTree.OPEN="NestedTreeOpen",OGX.NestedTree.CLOSE="NestedTreeClose",OGX.NestedTree.DRAG_START="NestedTreeDragStart",OGX.NestedTree.DRAG_END="NestedTreeDragEnd";