if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.ChatRoom=function(e){"use strict";function o(){if(X.messages.length>0){for(var e=0;e<X.messages.length;e++)t(X.messages[e]);b.update(),b.bottom()}}function t(e){var o=X.users.find("_id",e.user);e.letter=o[0].first_name.substr(0,1).toUpperCase()+o[0].last_name.substr(0,1).toUpperCase();var t=OGX.Templater.templatize(e,i(e));O.append(t);var a=O.children(".ogx_chatroom_message:last");setTimeout(function(){a.addClass("ogx_chatroom_message_anim"),b.update(),b.bottom()},100)}function a(e){S[e]=!0;var o='<div class="ogx_chatroom_typing" data-user="'+e+'"><span class="ogx_chatroom_typing_body">.</div></div>';O.append(o),n(!0)}function s(e){S[e]=!1,O.find('.ogx_chatroom_typing[data-user="'+e+'"]').remove(),0===O.find(".ogx_chatroom_typing").length&&n(!1)}function n(e){e?k||(k=setInterval(r,X.dot_speed)):(clearInterval(k),k=null)}function r(){T+=".",T.length>3?T=".":null,O.find(".ogx_chatroom_typing_body").html(T)}function i(e){return e.user===X.user?X.template_right:X.template_left}function c(){var e=G.find("textarea:first").val(),o=new Date;if(e.length>0){e=e.replace(/[\r\n]/g,"<br>");var a={from:X.users.current,to:X.users.remote,message:e,date:o.toISOString().split("T").shift()};t(a),G.find("textarea:first").val(""),R.el.trigger(OGX.ChatRoom.SEND_MSG,a)}}function d(e){w=x.height(),x.height(x.height()-e.keyboardHeight),_()}function l(){x.height(w),_()}function _(){setTimeout(function(){b.update(),b.bottom()},X.on_keyb_update_delay)}function m(e){e?(window.addEventListener("native.keyboardshow",d),window.addEventListener("native.keyboardhide",l)):(window.removeEventListener("native.keyboardshow",d),window.removeEventListener("native.keyboardhide",l))}function u(e){e?G.on("keyup","textarea",function(e){13===e.which&&(c(),X.hide_keyboard_on_send&&l())}):G.off("keyup","textarea")}function h(e){e?G.on("click",".ogx_chatroom_composer_send",function(){c(),X.hide_keyboard_on_send&&l()}):G.off("click",".ogx_chatroom_composer_send")}function p(){b=new OGX.Scroller({container:R.el.find(".ogx_chatroom_messages:first")[0],initDelay:100,autoScroll:!0,naturalScroll:X.natural_scroll}),R.el.on(OGX.Scroller.READY,function(){R.el.off(OGX.Scroller.READY),O=b.getInner(),O=$(O),O.addClass("ogx_chatroom_messages_inner"),b.update(),o()})}function g(){var e='<div class="ogx_chatroom_messages"></div><div class="ogx_chatroom_composer">';e+='<span class="ogx_chatroom_composer_input"><textarea placeholder="'+X.placeholder+'">',e+='</textarea></span><span class="ogx_chatroom_composer_send"></span></div>',x.append(e),G=x.find(".ogx_chatroom_composer:first")}function f(){for(var e in X.users)S[e]=!1}function v(){for(var e in E)X.hasOwnProperty(e)||(X[e]=E[e]);X.users.hasOwnProperty("find")||(X.users=new OGX.List(X.users)),R.el=x=$(X.container),x.addClass("ogx_chatroom")}function y(){return"undefined"==typeof OGX.Scroller?void console.log("%c CRITICAL ERROR - OGX.Scroller not found! ","background:#222; color: #FF0000"):"undefined"==typeof OGX.Templater?void console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000"):(v(),g(),f(),p(),X.handle_keyboard&&m(!0),h(!0),u(!0),void(C=$(window).height()))}var x,O,b,G,k,w,C,R=this,X=e,E={placeholder:"Type a message",dot_speed:600,on_keyb_update_delay:200,messages:[],natural_scroll:!0,handle_keyboard:!0,hide_keyboard_on_send:!1,mode:OGX.ChatRoom.MODE_DESKTOP,template_left:'<div class="ogx_chatroom_message ogx_chatroom_message_left" data-user="$user"><span class="ogx_chatroom_message_icon"><span>$letter</span></span><span class="ogx_chatroom_message_container"><span class="ogx_chatroom_message_body">$body</span><span class="ogx_chatroom_message_date">$date</span><span style="clear:both"></span></span></div>',template_right:'<div class="ogx_chatroom_message ogx_chatroom_message_right" data-user="$user"><span class="ogx_chatroom_message_container"><span class="ogx_chatroom_message_body">$body</span><span class="ogx_chatroom_message_date">$date $time</span><span style="clear:both"></span></span></div>',key:"_id",users:[],user:!1},S={},T=".";this.el=null,this.setUsers=function(e){X.users=e},this.setUser=function(e){X.user=e},this.addMessage=function(e){t(e)},this.setMessages=function(e){X.messages=e,o()},this.userTyping=function(e,o){e&&!S[o]?a(o):!e&&S[o]&&s(o)},this.setCompose=function(e){G.find("textarea:first").val(e)},this.clear=function(){O.empty()},this.destroy=function(){m(!1),u(!1),h(!1)},y()},OGX.ChatRoom=function(e){"use strict";return new OGX.prototype.ChatRoom(e)},OGX.ChatRoom.MODE_DESKTOP="desktop",OGX.ChatRoom.MODE_MOBILE="mobile",OGX.ChatRoom.SEND_MSG="ChatRoomSend";