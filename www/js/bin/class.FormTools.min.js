if(void 0===OGX)var OGX=function(){};OGX.FormTools=function(){"use strict";var l=this,o={container:!1,allowed:!1,forbidden:!1,change_cb:!1,submit_cb:!1,validate:!1,elem_types:["input","textarea"],wait:1e3},t={container:!1,allowed:/^[a-z0-9\\!\\.\\?\\#\\@\\$\\-\\:\\(\\)\\/_,;%'"â€™ ]$/gi,forbidden:!1,mask:!1,mask_char:"%",paste:!0,autocomplete:null,multiline:!1,input_cb:!1,change_cb:!1,val:null,changing:!1,wait:1e3,intv:null,max:2500,type:"string",params:null},u={},a={};function c(e,t){if(u[t].change_cb){var n=p(t);for(var a in n)u[t].hasOwnProperty("fields")&&u[t].fields.hasOwnProperty(a)&&u[t].fields[a].hasOwnProperty("type")?n[a]=s(u[t].fields[a].type,n[a]):u[t].hasOwnProperty("type")&&(n[a]=s(u[t].type,n[a]));u[t].change_cb(n)}}function s(e,t){switch(e){case"string":return String(t);case"number":return Number(t);case"int":return parseInt(t);case"bool":return"true"===e||1===e}}function p(e){return $(e).serializeArray().map(function(e){return this[e.name]=e.value,this}.bind({}))[0]}function f(e){return Object.assign({},e)}function m(e,t){for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n]);return e}this.bindForm=function(e){return!u.hasOwnProperty(e.container)&&(function(e){var r,i,a=m(f(o),e);$(a.container).on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation();var t={obj:p(a.container),form:a.container};if(u[a.container].validate){var n=l.validateForm(a.container);!0===n?t.valid=!0:(t.valid=!1,t.error=n)}u[a.container].change_cb?u[a.container].change_cb(t):u[a.container].submit_cb?u[a.container].submit_cb(t):$(a.container).trigger("change",t)});for(var t=0;t<a.elem_types.length;t++)$(a.container).find(a.elem_types[t]).each(function(e,t){n(a,e,t)});function n(e,t,n){if(n.hasAttribute("name")){if(r=$(n).attr("name"),delete(i=f(e)).fields,delete i.container,e.hasOwnProperty("fields")&&e.fields.hasOwnProperty(r))for(var a in e.fields[r])i[a]=e.fields[r][a];i.container=e.container+" "+n.tagName.toLowerCase()+'[name="'+r+'"]',i.change_cb=c,i.params=e.container,l.bindField(i)}}u[a.container]=a}(e),!0)},this.unbindForm=function(e){u.hasOwnProperty(e)&&(!function(n){var a;$(document).off("submit",n);for(var r=0;r<u[n].elem_types.length;r++)$(n).find(u[n].elem_types[r]).each(function(e,t){t.hasAttribute("name")&&(a=$(t).attr("name"),l.unbindField(n+" "+u[n].elem_types[r]+'[name="'+a+'"]'))});delete u[n]}(e),delete u[e])},this.bindField=function(e){if(u.hasOwnProperty(e.container))return!1;!function(e){var i=m(f(t),e),o=$(i.container),c=o.attr("name");o.on("input change",function(){var e=$(this).val();if(i.input_cb){var t={value:null,obj:{},el:null};e=s(i.type,e),t.el=o[0],t.value=e,t.property=c,t.obj[c]=e,options.input_cb(t,i.params)}u[i.container].intv||(u[i.container].intv=setInterval(function(){!function(e,t){var n=$(e).val(),a=u[e];if(a.val!==n&&(a.val=n,a.changing=(new Date).getTime()),a.changing&&(new Date).getTime()>a.wait+a.changing&&(clearInterval(a.intv),a.intv=!1,u[e].change_cb)){var r={value:null,obj:{},el:null};n=s(u[e].type,n),r.el=$(e)[0],r.property=$(e).attr("name"),r.value=n,r.obj[r.property]=n,u[e].change_cb(r,t)}}(i.container,i.params)},50))}),i.multiline||o.on("keypress",function(e){var t=$(this).val();if(13!==e.which&&i.mask){if(t.length>i.mask.length)return e.preventDefault(),e.stopImmediatePropagation(),!1;for(var n=i.mask,a=0;a<t.length;a++)i.mask.substr(a,1)===i.mask_char&&(n=n.replace(i.mask_char,t.substr(a,1)));-1!==(t=n).indexOf(i.mask_char)&&(t=t.substr(0,t.indexOf(i.mask_char))),o.val(t)}if(13===e.which){e.preventDefault(),e.stopImmediatePropagation();var t=$(this).val();if(u[i.container].intv&&(clearInterval(u[i.container].intv),u[i.container].intv=null),i.change_cb){var r={value:null,obj:{},el:null};t=s(i.type,t),r.el=o[0],r.property=c,r.value=t,r.obj[c]=t,i.change_cb(r,i.params)}else o.trigger("change",t)}});((u[i.container]=i).allowed||i.forbidden)&&l.restrictField(i)}(e)},this.unbindField=function(e){if(u.hasOwnProperty(e)){var t=$(e);t.off("input change"),u[e].multiline||t.off("keypress"),u[e].intv&&clearInterval(u[e].intv),a.hasOwnProperty(e)&&l.unrestrictField(e),delete u[e]}},this.restrictField=function(e){return!a.hasOwnProperty(e.container)&&(function(n){var e=$(n.container);a[n.container]=n,a[n.container].keys=[],null===n.autocomplete&&e[0].hasAttribute("autocomplete")&&"on"===e.attr("autocomplete")?n.autocomplete=!0:n.autocomplete=!1;n.autocomplete?n.hasOwnProperty("allowed")&&n.allowed&&(n.allowed=new RegExp(n.allowed.toString().replace("$/gi","+$").replace("/^","^"),"gi")):a[n.container].keys.push(229);-1!==["input","texarea"].indexOf(e.get(0).tagName.toLowerCase())?a[n.container].content="val":a[n.container].content="html";a[n.container].multiline||a[n.container].keys.push(13);e.on("textInput keydown",function(e){if("textInput"===e.type){var t=e.originalEvent.data;if(a[n.container].allowed){if(!t.match(a[n.container].allowed))return e.preventDefault(),e.stopImmediatePropagation(),!1}else if(a[n.container].forbidden&&t.match(a[n.container].forbidden))return e.preventDefault(),e.stopImmediatePropagation(),!1}if("keydown"===e.type){if(-1!==a[n.container].keys.indexOf(e.which))return e.preventDefault(),e.stopImmediatePropagation(),!1;if($(this)[a[n.container].content]().length>=a[n.container].max&&8!==e.which)return e.preventDefault(),e.stopImmediatePropagation(),!1}}),a[n.container].paste||e.on("paste",function(e){e.preventDefault(),e.stopImmediatePropagation()})}(e),!0)},this.unrestrictField=function(e){if(a.hasOwnProperty(e)){var t=$(e);return t.off("textInput keydown"),a[e].paste||t.off("paste"),delete a[e],!0}return!1},this.formToObj=function(e){return p(e)},this.populateForm=function(e,n){var a,t=$(e);function r(e,t){a=$(t).attr("name"),e.hasOwnProperty(a)&&$(t).val(e[a])}t.find("input").each(function(e,t){r(n,t)}),t.find("texarea").each(function(e,t){r(n,t)})},this.validateForm=function(e){var n,a,r,t=$(e),i={},o=!0;return t.find("input").each(function(e,t){n=$(t),t.hasAttribute("required")&&t.hasAttribute("pattern")&&"submit"!==n.attr("type")&&(a=n.attr("pattern"),r=n.val(),a&&((a=new RegExp(a,"g")).test(r)||(i[n.attr("name")]=!1,o=!1)))}),!!o||i}},OGX.FormTools=new OGX.FormTools;