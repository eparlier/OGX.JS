if(void 0===OGX)var OGX=function(){};OGX.FormTools=function(){"use strict";var s=this,t={container:!1,allowed:!1,forbidden:!1,change_cb:!1,submit_cb:!1,validate:!1,elem_types:["input","textarea"],wait:1e3,fields:{}},n={container:!1,allowed:/^[a-z0-9\\!\\.\\?\\#\\@\\$\\-\\:\\(\\)\\/_,;%'"â€™ ]$/gi,forbidden:!1,mask:!1,mask_char:"%",paste:!0,autocomplete:null,multiline:!1,input_cb:!1,change_cb:!1,val:null,changing:!1,wait:2e3,intv:!1,max:2500,type:"string",params:null},u={},a={};function r(e,t){if(u[t].change_cb){for(var n in u[t].fields)if(u[t].fields[n].intv)return;var a,i=l(t);for(var r in i)u[t].fields.hasOwnProperty(r)&&u[t].fields[r].hasOwnProperty("type")?i[r]=f(u[t].fields[r].type,i[r]):u[t].hasOwnProperty("type")&&(i[r]=f(u[t].type,i[r]));if(u[t].validate){a={obj:i,form:t,valid:!1};var o=s.validateForm(t);!0===o?a.valid=!0:(a.valid=!1,a.error=o)}else a=i;u[t].change_cb(a)}}function f(e,t){switch(e){case"string":return String(t);case"number":return Number(t);case"int":return parseInt(t);case"bool":return"true"===t||1===t}}function l(e){return $(e).serializeArray().map(function(e){return this[e.name]=e.value,this}.bind({}))[0]}function o(e){return Object.assign({},e)}function c(e,t){for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n]);return e}this.bindForm=function(e){return!u.hasOwnProperty(e.container)&&(function(e){for(var a=c(o(t),e),n=0;n<a.elem_types.length;n++)$(a.container).find(a.elem_types[n]).each(function(e,t){t.hasAttribute("name")&&(i=t.getAttribute("name"),a.fields.hasOwnProperty(i)||(a.fields[i]={}),a.fields[i].tag=a.elem_types[n])});for(var i in a.fields)a.fields[i].change_cb=r,a.fields[i].container=a.container+" "+a.fields[i].tag+'[name="'+i+'"]',delete a.fields[i].tag,a.fields[i].params=a.container,a.fields[i]=s.bindField(a.fields[i]);u[a.container]=a,$(a.container).on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation();var t={obj:l(a.container),form:a.container};if(u[a.container].validate){var n=s.validateForm(a.container);!0===n?t.valid=!0:(t.valid=!1,t.error=n)}u[a.container].submit_cb?u[a.container].submit_cb(t):$(a.container).trigger("submit",t)})}(e),!0)},this.unbindForm=function(e){u.hasOwnProperty(e)&&(!function(e){for(var t in $(document).off("submit",e),u[e].fields)s.unbindField(u[e].fields[t].container);delete u[e]}(e),delete u[e])},this.bindField=function(e){if(u.hasOwnProperty(e.container))return!1;var t=c(o(n),e);return function(o){var l=$(o.container),c=l.attr("name"),n=l.val();l.on("input change",function(){var e=$(this).val();if(e!==n){if(n=e,o.input_cb){var t={value:null,obj:{},el:null};e=f(o.type,e),t.el=l[0],t.value=e,t.property=c,t.obj[c]=e,o.input_cb(t,o.params)}u[o.container].intv||(u[o.container].intv=setInterval(function(){!function(e,t){var n=$(e).val(),a=u[e];if(a.val!==n&&(a.val=n,a.changing=(new Date).getTime()),a.changing&&(new Date).getTime()>a.wait+a.changing&&(clearInterval(a.intv),a.intv=!1,u[e].change_cb)){var i={value:null,obj:{},el:null};n=f(u[e].type,n),i.el=$(e)[0],i.property=$(e).attr("name"),i.value=n,i.obj[i.property]=n,u[e].change_cb(i,t)}}(o.container,o.params)},50))}}),o.multiline||l.on("keydown",function(e){if(8!==e.which&&13!==e.which){var t=$(this).val();if(13!==e.which&&o.mask){if(t.length>o.mask.length)return e.preventDefault(),e.stopImmediatePropagation(),!1;for(var n=o.mask,a=0;a<t.length;a++)o.mask.substr(a,1)===o.mask_char&&(n=n.replace(o.mask_char,t.substr(a,1)));if(-1!==n.indexOf(o.mask_char)){var i=e.key;n=i===o.mask.substr(n.indexOf(o.mask_char)-1,1)?n.substr(0,n.indexOf(o.mask_char)-1):n.substr(0,n.indexOf(o.mask_char))}l.val(n)}}if(13===e.which){e.preventDefault(),e.stopImmediatePropagation();var t=$(this).val();if(u[o.container].intv&&(clearInterval(u[o.container].intv),u[o.container].intv=null),o.change_cb){var r={value:null,obj:{},el:null};t=f(o.type,t),r.el=l[0],r.property=c,r.value=t,r.obj[c]=t,o.change_cb(r,o.params)}else l.trigger("change",t)}});((u[o.container]=o).allowed||o.forbidden)&&s.restrictField(o)}(t),t},this.unbindField=function(e){if(u.hasOwnProperty(e)){var t=$(e);t.off("input change"),u[e].multiline||t.off("keydown"),u[e].intv&&clearInterval(u[e].intv),a.hasOwnProperty(e)&&s.unrestrictField(e),delete u[e]}},this.restrictField=function(e){return!a.hasOwnProperty(e.container)&&(function(n){var e=$(n.container);a[n.container]=n,a[n.container].keys=[],null===n.autocomplete&&e[0].hasAttribute("autocomplete")&&"on"===e.attr("autocomplete")?n.autocomplete=!0:n.autocomplete=!1;n.autocomplete?n.hasOwnProperty("allowed")&&n.allowed&&(n.allowed=new RegExp(n.allowed.toString().replace("$/gi","+$").replace("/^","^"),"gi")):a[n.container].keys.push(229);-1!==["input","texarea"].indexOf(e.get(0).tagName.toLowerCase())?a[n.container].content="val":a[n.container].content="html";a[n.container].multiline||a[n.container].keys.push(13);e.on("textInput keydown",function(e){if("textInput"===e.type){var t=e.originalEvent.data;if(a[n.container].allowed){if(!t.match(a[n.container].allowed))return e.preventDefault(),e.stopImmediatePropagation(),!1}else if(a[n.container].forbidden&&t.match(a[n.container].forbidden))return e.preventDefault(),e.stopImmediatePropagation(),!1}if("keydown"===e.type){if(-1!==a[n.container].keys.indexOf(e.which))return e.preventDefault(),e.stopImmediatePropagation(),!1;if($(this)[a[n.container].content]().length>=a[n.container].max&&8!==e.which)return e.preventDefault(),e.stopImmediatePropagation(),!1}}),a[n.container].paste||e.on("paste",function(e){e.preventDefault(),e.stopImmediatePropagation()})}(e),!0)},this.unrestrictField=function(e){if(a.hasOwnProperty(e)){var t=$(e);return t.off("textInput keydown"),a[e].paste||t.off("paste"),delete a[e],!0}return!1},this.formToObj=function(e){return l(e)},this.populateForm=function(e,n){var a,t=$(e);function i(e,t){a=$(t).attr("name"),e.hasOwnProperty(a)&&$(t).val(e[a])}t.find("input").each(function(e,t){i(n,t)}),t.find("texarea").each(function(e,t){i(n,t)})},this.validateForm=function(e){var n,a,i,t=$(e),r={},o=!0;return t.find("input").each(function(e,t){n=$(t),t.hasAttribute("required")&&t.hasAttribute("pattern")&&"submit"!==n.attr("type")&&(a=n.attr("pattern"),i=n.val(),a&&((a=new RegExp(a,"g")).test(i)||(r[n.attr("name")]=!1,o=!1)))}),!!o||r}},OGX.FormTools=new OGX.FormTools;