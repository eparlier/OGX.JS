if(void 0===OGX)var OGX=function(){};OGX.FormTools=function(){"use strict";var u=this,o={container:!1,allowed:!1,forbidden:!1,change_cb:!1,submit_cb:!1,validate:!1,elem_types:["input","textarea"],wait:1e3,fields:{}},t={container:!1,allowed:/^[a-z0-9\\!\\.\\?\\#\\@\\$\\-\\:\\(\\)\\/_,;%'"â€™ ]$/gi,forbidden:!1,mask:!1,mask_char:"%",paste:!0,autocomplete:null,multiline:!1,input_cb:!1,change_cb:!1,val:null,changing:!1,wait:1e3,intv:null,max:2500,type:"string",params:null},s={},a={};function c(e,t){if(s[t].change_cb){var n,a=l(t);for(var r in a)s[t].hasOwnProperty("fields")&&s[t].fields.hasOwnProperty(r)&&s[t].fields[r].hasOwnProperty("type")?a[r]=f(s[t].fields[r].type,a[r]):s[t].hasOwnProperty("type")&&(a[r]=f(s[t].type,a[r]));if(s[t].validate){n={obj:a,form:t,valid:!1};var i=u.validateForm(t);!0===i?n.valid=!0:(n.valid=!1,n.error=i)}else n=a;s[t].change_cb(n)}}function f(e,t){switch(e){case"string":return String(t);case"number":return Number(t);case"int":return parseInt(t);case"bool":return"true"===t||1===t}}function l(e){return $(e).serializeArray().map(function(e){return this[e.name]=e.value,this}.bind({}))[0]}function p(e){return Object.assign({},e)}function m(e,t){for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n]);return e}this.bindForm=function(e){return!s.hasOwnProperty(e.container)&&(function(e){var r,i,a=m(p(o),e);$(a.container).on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation();var t={obj:l(a.container),form:a.container};if(s[a.container].validate){var n=u.validateForm(a.container);!0===n?t.valid=!0:(t.valid=!1,t.error=n)}s[a.container].change_cb?s[a.container].change_cb(t):s[a.container].submit_cb?s[a.container].submit_cb(t):$(a.container).trigger("change",t)});for(var t=0;t<a.elem_types.length;t++)$(a.container).find(a.elem_types[t]).each(function(e,t){n(a,e,t)});function n(e,t,n){if(n.hasAttribute("name")){if(r=$(n).attr("name"),delete(i=p(e)).fields,delete i.container,e.hasOwnProperty("fields")&&e.fields.hasOwnProperty(r))for(var a in e.fields[r])i[a]=e.fields[r][a];i.container=e.container+" "+n.tagName.toLowerCase()+'[name="'+r+'"]',i.change_cb=c,i.params=e.container,u.bindField(i)}}s[a.container]=a}(e),!0)},this.unbindForm=function(e){s.hasOwnProperty(e)&&(!function(n){var a;$(document).off("submit",n);for(var r=0;r<s[n].elem_types.length;r++)$(n).find(s[n].elem_types[r]).each(function(e,t){t.hasAttribute("name")&&(a=$(t).attr("name"),u.unbindField(n+" "+s[n].elem_types[r]+'[name="'+a+'"]'))});delete s[n]}(e),delete s[e])},this.bindField=function(e){if(s.hasOwnProperty(e.container))return!1;!function(o){var c=$(o.container),l=c.attr("name"),n=c.val();c.on("input change",function(){var e=$(this).val();if(e!==n){if(n=e,o.input_cb){var t={value:null,obj:{},el:null};e=f(o.type,e),t.el=c[0],t.value=e,t.property=l,t.obj[l]=e,options.input_cb(t,o.params)}s[o.container].intv||(s[o.container].intv=setInterval(function(){!function(e,t){var n=$(e).val(),a=s[e];if(a.val!==n&&(a.val=n,a.changing=(new Date).getTime()),a.changing&&(new Date).getTime()>a.wait+a.changing&&(clearInterval(a.intv),a.intv=!1,s[e].change_cb)){var r={value:null,obj:{},el:null};n=f(s[e].type,n),r.el=$(e)[0],r.property=$(e).attr("name"),r.value=n,r.obj[r.property]=n,s[e].change_cb(r,t)}}(o.container,o.params)},50))}}),o.multiline||c.on("keydown",function(e){if(8!==e.which&&13!==e.which){var t=$(this).val();if(13!==e.which&&o.mask){if(t.length>o.mask.length)return e.preventDefault(),e.stopImmediatePropagation(),!1;for(var n=o.mask,a=0;a<t.length;a++)o.mask.substr(a,1)===o.mask_char&&(n=n.replace(o.mask_char,t.substr(a,1)));if(-1!==n.indexOf(o.mask_char)){var r=e.key;n=r===o.mask.substr(n.indexOf(o.mask_char)-1,1)?n.substr(0,n.indexOf(o.mask_char)-1):n.substr(0,n.indexOf(o.mask_char))}c.val(n)}}if(13===e.which){e.preventDefault(),e.stopImmediatePropagation();var t=$(this).val();if(s[o.container].intv&&(clearInterval(s[o.container].intv),s[o.container].intv=null),o.change_cb){var i={value:null,obj:{},el:null};t=f(o.type,t),i.el=c[0],i.property=l,i.value=t,i.obj[l]=t,o.change_cb(i,o.params)}else c.trigger("change",t)}});((s[o.container]=o).allowed||o.forbidden)&&u.restrictField(o)}(m(p(t),e))},this.unbindField=function(e){if(s.hasOwnProperty(e)){var t=$(e);t.off("input change"),s[e].multiline||t.off("keydown"),s[e].intv&&clearInterval(s[e].intv),a.hasOwnProperty(e)&&u.unrestrictField(e),delete s[e]}},this.restrictField=function(e){return!a.hasOwnProperty(e.container)&&(function(n){var e=$(n.container);a[n.container]=n,a[n.container].keys=[],null===n.autocomplete&&e[0].hasAttribute("autocomplete")&&"on"===e.attr("autocomplete")?n.autocomplete=!0:n.autocomplete=!1;n.autocomplete?n.hasOwnProperty("allowed")&&n.allowed&&(n.allowed=new RegExp(n.allowed.toString().replace("$/gi","+$").replace("/^","^"),"gi")):a[n.container].keys.push(229);-1!==["input","texarea"].indexOf(e.get(0).tagName.toLowerCase())?a[n.container].content="val":a[n.container].content="html";a[n.container].multiline||a[n.container].keys.push(13);e.on("textInput keydown",function(e){if("textInput"===e.type){var t=e.originalEvent.data;if(a[n.container].allowed){if(!t.match(a[n.container].allowed))return e.preventDefault(),e.stopImmediatePropagation(),!1}else if(a[n.container].forbidden&&t.match(a[n.container].forbidden))return e.preventDefault(),e.stopImmediatePropagation(),!1}if("keydown"===e.type){if(-1!==a[n.container].keys.indexOf(e.key))return e.preventDefault(),e.stopImmediatePropagation(),!1;if($(this)[a[n.container].content]().length>=a[n.container].max&&8!==e.which)return e.preventDefault(),e.stopImmediatePropagation(),!1}}),a[n.container].paste||e.on("paste",function(e){e.preventDefault(),e.stopImmediatePropagation()})}(e),!0)},this.unrestrictField=function(e){if(a.hasOwnProperty(e)){var t=$(e);return t.off("textInput keydown"),a[e].paste||t.off("paste"),delete a[e],!0}return!1},this.formToObj=function(e){return l(e)},this.populateForm=function(e,n){var a,t=$(e);function r(e,t){a=$(t).attr("name"),e.hasOwnProperty(a)&&$(t).val(e[a])}t.find("input").each(function(e,t){r(n,t)}),t.find("texarea").each(function(e,t){r(n,t)})},this.validateForm=function(e){var n,a,r,t=$(e),i={},o=!0;return t.find("input").each(function(e,t){n=$(t),t.hasAttribute("required")&&t.hasAttribute("pattern")&&"submit"!==n.attr("type")&&(a=n.attr("pattern"),r=n.val(),a&&((a=new RegExp(a,"g")).test(r)||(i[n.attr("name")]=!1,o=!1)))}),!!o||i}},OGX.FormTools=new OGX.FormTools;