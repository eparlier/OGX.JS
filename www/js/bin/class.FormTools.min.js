if(void 0===OGX)var OGX=function(){};OGX.FormTools=function(){"use strict";var l=this,s={container:!1,allowed:!1,forbidden:!1,change_cb:!1,submit_cb:!1,validate:!1,elem_types:["input","textarea"],wait:1e3,fields:{}},n={container:!1,allowed:/^[a-z0-9\\!\\.\\?\\#\\@\\$\\-\\:\\(\\)\\/_,;%'"â€™ ]$/gi,forbidden:!1,mask:!1,mask_char:"%",paste:!0,autocomplete:null,multiline:!1,input_cb:!1,change_cb:!1,val:null,changing:!1,wait:2e3,intv:!1,max:2500,type:"string",params:null},f={},i={};function t(e,t){if(f[t].change_cb){for(var n in f[t].fields)if(f[t].fields[n].intv)return;var a,i=c(t);for(var r in i)f[t].fields.hasOwnProperty(r)&&f[t].fields[r].hasOwnProperty("type")?i[r]=p(f[t].fields[r].type,i[r]):f[t].hasOwnProperty("type")&&(i[r]=p(f[t].type,i[r]));if(f[t].validate){a={obj:i,form:t,valid:!1};var o=l.validateForm(t);!0===o?a.valid=!0:(a.valid=!1,a.error=o)}else a=i;f[t].change_cb(a)}}function p(e,t){switch(e){case"string":return String(t);case"number":return Number(t);case"int":return parseInt(t);case"bool":return"true"===t||1===t}}function c(e){return $(e).serializeArray().map(function(e){return this[e.name]=e.value,this}.bind({}))[0]}function r(e){return Object.assign({},e)}function o(e,t){for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n]);return e}this.bindForm=function(e){return!f.hasOwnProperty(e.container)&&(function(e){for(var a=o(r(s),e),n=0;n<a.elem_types.length;n++)$(a.container).find(a.elem_types[n]).each(function(e,t){t.hasAttribute("name")&&(i=t.getAttribute("name"),a.fields.hasOwnProperty(i)||(a.fields[i]={}),a.fields[i].tag=a.elem_types[n])});for(var i in a.fields)a.fields[i].change_cb=t,a.fields[i].container=a.container+" "+a.fields[i].tag+'[name="'+i+'"]',delete a.fields[i].tag,a.fields[i].params=a.container,a.fields[i]=l.bindField(a.fields[i]);f[a.container]=a,$(a.container).on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation();var t={obj:c(a.container),form:a.container};if(f[a.container].validate){var n=l.validateForm(a.container);!0===n?t.valid=!0:(t.valid=!1,t.error=n)}f[a.container].submit_cb?f[a.container].submit_cb(t):$(a.container).trigger("submit",t)})}(e),!0)},this.unbindForm=function(e){f.hasOwnProperty(e)&&(!function(e){for(var t in $(document).off("submit",e),f[e].fields)l.unbindField(f[e].fields[t].container);delete f[e]}(e),delete f[e])},this.bindField=function(e){if(f.hasOwnProperty(e.container))return!1;var t=o(r(n),e);return function(c){var s=$(c.container),u=s.attr("name"),n=s.val();s.on("input change",function(){var e=$(this).val();if(e!==n){if(n=e,c.input_cb){var t={value:null,obj:{},el:null};e=p(c.type,e),t.el=s[0],t.value=e,t.property=u,t.obj[u]=e,c.input_cb(t,c.params)}f[c.container].intv||(f[c.container].intv=setInterval(function(){!function(e,t){var n=$(e).val(),a=f[e];if(a.val!==n&&(a.val=n,a.changing=(new Date).getTime()),a.changing&&(new Date).getTime()>a.wait+a.changing&&(clearInterval(a.intv),a.intv=!1,f[e].change_cb)){var i={value:null,obj:{},el:null};n=p(f[e].type,n),i.el=$(e)[0],i.property=$(e).attr("name"),i.value=n,i.obj[i.property]=n,f[e].change_cb(i,t)}}(c.container,c.params)},50))}}),c.multiline||s.on("keydown",function(e){if(8!==e.which&&13!==e.which){var t=$(this).val(),n=e.key;if(13!==e.which&&c.mask){if(t.length>c.mask.length)return e.preventDefault(),e.stopImmediatePropagation(),!1;for(var a=c.mask,i=0;i<t.length;i++)c.mask.substr(i,1)===c.mask_char&&(a=a.replace(c.mask_char,t.substr(i,1)));var r=a.indexOf(c.mask_char),o=!1;return r+1<a.length+1&&(o=a.substr(r+1,1)),-1!==r&&(n===c.mask.substr(a.indexOf(c.mask_char)-1,1)?a=a.substr(0,a.indexOf(c.mask_char)-1):(a=a.substr(0,a.indexOf(c.mask_char)),o&&o!==c.mask_char&&setTimeout(function(){s.val(a+n+o)},0))),void s.val(a)}}if(13===e.which){e.preventDefault(),e.stopImmediatePropagation();var t=$(this).val();if(f[c.container].intv&&(clearInterval(f[c.container].intv),f[c.container].intv=null),c.change_cb){var l={value:null,obj:{},el:null};t=p(c.type,t),l.el=s[0],l.property=u,l.value=t,l.obj[u]=t,c.change_cb(l,c.params)}else s.trigger("change",t)}});((f[c.container]=c).allowed||c.forbidden)&&l.restrictField(c)}(t),t},this.unbindField=function(e){if(f.hasOwnProperty(e)){var t=$(e);t.off("input change"),f[e].multiline||t.off("keydown"),f[e].intv&&clearInterval(f[e].intv),i.hasOwnProperty(e)&&l.unrestrictField(e),delete f[e]}},this.restrictField=function(e){return!i.hasOwnProperty(e.container)&&(function(n){var e=$(n.container),a=[8,9];i[n.container]=n,i[n.container].keys=[],null===n.autocomplete&&e[0].hasAttribute("autocomplete")&&"on"===e.attr("autocomplete")?n.autocomplete=!0:n.autocomplete=!1;n.autocomplete?n.hasOwnProperty("allowed")&&n.allowed&&(n.allowed=new RegExp(n.allowed.toString().replace("$/gi","+$").replace("/^","^"),"gi")):i[n.container].keys.push(229);-1!==["input","texarea"].indexOf(e.get(0).tagName.toLowerCase())?i[n.container].content="val":i[n.container].content="html";i[n.container].multiline||i[n.container].keys.push(13);e.on("textInput keydown",function(e){if("textInput"===e.type){var t=e.originalEvent.data;if(i[n.container].allowed){if(!t.match(i[n.container].allowed))return e.preventDefault(),e.stopImmediatePropagation(),!1}else if(i[n.container].forbidden&&t.match(i[n.container].forbidden))return e.preventDefault(),e.stopImmediatePropagation(),!1}if("keydown"===e.type){if(-1!==i[n.container].keys.indexOf(e.which))return e.preventDefault(),e.stopImmediatePropagation(),!1;if($(this)[i[n.container].content]().length>=i[n.container].max&&-1===e.which.indexOf(a))return e.preventDefault(),e.stopImmediatePropagation(),!1}}),i[n.container].paste||e.on("paste",function(e){e.preventDefault(),e.stopImmediatePropagation()})}(e),!0)},this.unrestrictField=function(e){if(i.hasOwnProperty(e)){var t=$(e);return t.off("textInput keydown"),i[e].paste||t.off("paste"),delete i[e],!0}return!1},this.formToObj=function(e){return c(e)},this.populateForm=function(e,n){var a,t=$(e);function i(e,t){a=$(t).attr("name"),e.hasOwnProperty(a)&&$(t).val(e[a])}t.find("input").each(function(e,t){i(n,t)}),t.find("texarea").each(function(e,t){i(n,t)})},this.validateForm=function(e){for(var n,a,i,t=$(e),r={},o=!0,l=s.elem_types,c=0;c<l.length;c++)t.find(l[c]).each(function(e,t){n=$(t),t.hasAttribute("required")&&t.hasAttribute("pattern")&&("input"===n[0].tagName&&"submit"!==n.attr("type")||"input"!==n[0].tagName)&&(a=n.attr("pattern"),i=n.val(),a&&((a=new RegExp(a,"g")).test(i)||(r[n.attr("name")]=!1,o=!1)))});return!!o||r}},OGX.FormTools=new OGX.FormTools;