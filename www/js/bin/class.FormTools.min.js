if(void 0===OGX)var OGX=function(){};OGX.FormTools=function(){"use strict";var o=this,t={container:!1,allowed:/^[a-z0-9\\!\\.\\?\\#\\@\\$\\-\\:\\(\\)\\/_,;%'"â€™ ]$/gi,forbidden:!1,paste:!0,autocomplete:null,multiline:!1,input_cb:!1,change_cb:!1,val:null,changing:!1,wait:1e3,intv:null,max:2500,type:"string",params:null},c={},a={};function l(n,e){var t=p(e);for(var a in t)c[e].fields.hasOwnProperty(a)&&c[e].fields[a].hasOwnProperty("type")?t[a]=u(c[e].fields[a].type,t[a]):c[e].hasOwnProperty("type")&&(t[a]=u(c[e].type,t[a]));c[e].change_cb(t)}function u(n,e){switch(n){case"string":return String(e);case"number":return Number(e);case"int":return parseInt(e);case"bool":return"true"===n||1===n}}function p(n){return $(n).serializeArray().map(function(n){return this[n.name]=n.value,console.log(n.name),this}.bind({}))[0]}function s(n){return Object.assign({},n)}this.bindForm=function(n){return!c.hasOwnProperty(n.container)&&(function(t){var r,i;function a(n,e,t){if(r=$(t).attr("name"),n.hasOwnProperty("fields")){if(delete(i=s(n)).fields,delete i.container,n.fields.hasOwnProperty(r))for(var a in n.fields[r])i[a]=n.fields[r][a];i.container=n.container+" "+t.tagName+'[name="'+r+'"]',i.change_cb=l,i.params=n.container,o.bindField(i)}}$(t.container).on("submit",function(n){n.preventDefault(),n.stopImmediatePropagation();var e={obj:p(t.container),form:t.container};c[t.container].hasOwnProperty("change_cb")?c[t.container].change_cb(e):$(t.container).trigger("change",e)}),$(t.container).find("input").each(function(n,e){a(t,n,e)}),$(t.container).find("textarea").each(function(n,e){a(t,n,e)})}(c[n.container]=n),!0)},this.unbindForm=function(n){var t,a;c.hasOwnProperty(n)&&(t=n,$(document).off("submit",t),$(t).find("input").each(function(n,e){a=$(e).attr("name"),o.unbindField(t+' input[name="'+a+'"]')}),$(t).find("textarea").each(function(n,e){a=$(e).attr("name"),o.unbindField(t+' textarea[name="'+a+'"]')}),delete c[n])},this.bindField=function(n){if(c.hasOwnProperty(n.container))return!1;!function(n){var a=s(t);for(var e in n)a.hasOwnProperty(e)&&(a[e]=n[e]);var r=$(a.container),i=r.attr("name");r.on("input change",function(){if(a.input_cb){var n={value:null,obj:{},el:null},e=$(this).val();e=u(a.type,e),n.el=r[0],n.value=e,n.property=i,n.obj[i]=e,options.input_cb(n,a.params)}c[a.container].intv||(c[a.container].intv=setInterval(function(){!function(n,e){var t=$(n).val(),a=c[n];if(a.val!==t&&(a.val=t,a.changing=(new Date).getTime()),a.changing&&(new Date).getTime()>a.wait+a.changing&&(clearInterval(a.intv),a.intv=!1,c[n].change_cb)){var r={value:null,obj:{},el:null};t=u(c[n].type,t),r.el=$(n)[0],r.property=$(n).attr("name"),r.value=t,r.obj[r.property]=t,c[n].change_cb(r,e)}}(a.container,a.params)},50))}),a.multiline||r.on("keypress",function(n){if(13===n.which){n.preventDefault(),n.stopImmediatePropagation();var e=$(this).val();if(c[a.container].intv&&(clearInterval(c[a.container].intv),c[a.container].intv=null),a.change_cb){var t={value:null,obj:{},el:null};e=u(a.type,e),t.el=r[0],t.property=i,t.value=e,t.obj[i]=e,a.change_cb(t,a.params)}else r.trigger("change",e)}});((c[a.container]=a).allowed||a.forbidden)&&o.restrictField(a)}(n)},this.unbindField=function(n){if(c.hasOwnProperty(n)){var e=$(n);e.off("input change"),c[n].multiline||e.off("keypress"),c[n].intv&&clearInterval(c[n].intv),a.hasOwnProperty(n)&&this.unrestrictField(n),delete c[n]}},this.restrictField=function(n){return!a.hasOwnProperty(n.container)&&(function(t){t.hasOwnProperty("forbidden")&&(t.allowed=!1);var n=$(t.container);!t.allowed&&n[0].hasAttribute("pattern")&&(t.allowed=n.attr("pattern").replace(/{[0-9,]+}/,""));a[t.container]=t,a[t.container].keys=[],null===t.autocomplete&&n[0].hasAttribute("autocomplete")&&"on"===n.attr("autocomplete")?t.autocomplete=!0:t.autocomplete=!1;t.autocomplete?t.hasOwnProperty("allowed")&&t.allowed&&(t.allowed=new RegExp(t.allowed.toString().replace("$/gi","+$").replace("/^","^"),"gi")):a[t.container].keys.push(229);-1!==["input","texarea"].indexOf(n.get(0).tagName.toLowerCase())?a[t.container].content="val":a[t.container].content="html";a[t.container].multiline||a[t.container].keys.push(13);n.on("textInput keydown",function(n){if("textInput"===n.type){var e=n.originalEvent.data;if(a[t.container].allowed){if(!e.match(a[t.container].allowed))return n.preventDefault(),n.stopImmediatePropagation(),!1}else if(a[t.container].forbidden&&e.match(a[t.container].forbidden))return n.preventDefault(),n.stopImmediatePropagation(),!1}if("keydown"===n.type){if(-1!==a[t.container].keys.indexOf(n.which))return n.preventDefault(),n.stopImmediatePropagation(),!1;if($(this)[a[t.container].content]().length>=a[t.container].max&&8!==n.which)return n.preventDefault(),n.stopImmediatePropagation(),!1}}),a[t.container].paste||n.on("paste",function(n){n.preventDefault(),n.stopImmediatePropagation()})}(n),!0)},this.unrestrictField=function(n){if(a.hasOwnProperty(n)){var e=$(n);return e.off("textInput keydown"),a[n].paste||e.off("paste"),delete a[n],!0}return!1},this.formToObj=function(n){return p(n)},this.populateForm=function(n,t){var a,e=$(n);function r(n,e){a=$(e).attr("name"),n.hasOwnProperty(a)&&$(e).val(n[a])}e.find("input").each(function(n,e){r(t,e)}),e.find("texarea").each(function(n,e){r(t,e)})},this.validateForm=function(n){var t,a,r,e=$(n),i={},o=!0;return e.find("input").each(function(n,e){t=$(e),e.hasAttribute("required")&&e.hasAttribute("pattern")&&"submit"!==t.attr("type")&&(a=t.attr("pattern"),r=t.val(),a&&((a=new RegExp(a,"g")).test(r)||(i[t.attr("name")]=!1,o=!1)))}),!!o||i}},OGX.FormTools=new OGX.FormTools;