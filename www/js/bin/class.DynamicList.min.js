OGX.DynamicList=function(t){"use strict";var d,c,o,m,l=this,f=t,e={container:null,enabled:!0,key:!1,display:!1,list:[],mode:OGX.DynamicList.SELECT_MODE_SINGLE,trigger:!1},a=new OGX.List,_={},h=1,i="__id__";function g(){for(var t,e,i,n=E(),s="",r=0;r<n.length;r++)!1,e="",t=n[r][m],a.find(m,t,1).length&&(e="ogx_dynamic_list_selected_item"),s+='<div class="ogx_dynamic_list_item '+e+" "+(i=u(n[r])).css+'" data-id='+t+">"+OGX.Templater.templatize(n[r],i.html)+"</div>";d.html(s),f.trigger&&d.trigger(OGX.DynamicList.RENDER)}function u(t){var e={html:"",css:""},i=f.display;return i.hasOwnProperty("html")?e.html=i.html:i.hasOwnProperty("template")&&("object"==typeof i.template&&i.template.hasOwnProperty("bind")?t.hasOwnProperty(i.template.bind)&&(e.html=OGX.Templater.getTemplate(t[i.template.bind])):"string"==typeof i.template&&(e.html=OGX.Templater.getTemplate(i.template))),i.hasOwnProperty("css")&&("object"==typeof i.css&&i.css.hasOwnProperty("bind")?t.hasOwnProperty(i.css.bind)&&(e.css=t[i.css.bind]):"string"==typeof i.css&&(e.css=i.css)),e}function n(t){if("object"==typeof _[t])switch(_[t]._NAME_){case OGX.DynamicList.NAME:_[t].el.off(OGX.DynamicList.SELECT),_[t].el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:_[t].el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:_[t].el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:_[t].el.off(OGX.SwitchMulti.CHANGE);break;default:_[t].off("input")}else _[t].off("input");return f.list.removeFilter(t),delete _[t],c=f.list.filter(),o=!0,g(),!0}function y(t,e){for(var i=_[t].getSelection(),n=[],s=0;s<i.length;s++)n.push(i[s][e]);return n}function s(t){t?d.on("click",".ogx_dynamic_list_item",function(){switch(f.mode){case OGX.DynamicList.SELECT_MODE_SINGLE:$(this).hasClass("ogx_dynamic_list_selected_item")||(O($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,a[a.length-1]));break;case OGX.DynamicList.SELECT_MODE_TOGGLE:$(this).hasClass("ogx_dynamic_list_selected_item")?(O($(this).index(),!1),d.trigger(OGX.DynamicList.UNSELECT)):(l.resetSelection(),O($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,a[a.length-1]));break;case OGX.DynamicList.SELECT_MODE_MULTI:$(this).hasClass("ogx_dynamic_list_selected_item")?(O($(this).index(),!1),d.trigger(OGX.DynamicList.UNSELECT)):(O($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,a))}}):d.off("click",".ogx_dynamic_list_item")}function r(t,e,i){"single"===f.mode&&l.resetSelection();for(var n,s=E().find(t,e),r=0;r<s.length;r++)(n=d.find(".ogx_dynamic_list_item[data-id="+s[r][m]+"]:first"))&&(i?(n.addClass("ogx_dynamic_list_selected_item"),a.push(s[r])):n.removeClass("ogx_dynamic_list_selected_item"));return"single"===f.mode&&s.length?s[0]:s}function O(t,e){var i,n=E();return 0<(i=d.find(".ogx_dynamic_list_item:eq("+t+")")).length&&(f.mode===OGX.DynamicList.SELECT_MODE_SINGLE&&l.resetSelection(),e?(i.addClass("ogx_dynamic_list_selected_item"),a.push(n[t])):(i.removeClass("ogx_dynamic_list_selected_item"),a.findDelete(m,i.data("id"),1)),!0)}function E(){return o?c:f.list}function G(){for(var t=0;t<f.list.length;t++)f.list[t][m]=h,h++}function L(t){for(var e=0;e<t.length;e++)delete t[e][m];return t}this._NAME_=OGX.DynamicList.NAME,this.el=null,this.val=function(t){if(void 0===t)return f.key?f.list:L(JSON.parse(JSON.stringify(f.list)));t.hasOwnProperty("insert")||(t=new OGX.List(t)),f.list=t,f.key||(h=1,m=i,G()),g()},this.display=function(t){return void 0===t?f.display:(f.display=t,!0)},this.mode=function(t){return void 0===t?f.mode:(f.mode=t,!0)},this.enable=function(){return!f.enabled&&(s(f.enabled=!0),!0)},this.disable=function(){return!!f.enabled&&(s(f.enabled=!1),!0)},this.bind=function(t,e,i,n){return!_.hasOwnProperty(t)&&function(n,t,s,r){null==s&&(s=n);null==r&&(r="eqjson");if("object"==typeof t)switch((_[n]=t)._NAME_){case OGX.DynamicList.NAME:f.list.removeFilter(n);var e=y(n,s);f.list.addFilter(n,r,e),_[n].el.on(OGX.DynamicList.SELECT,function(t,e){var i;f.list.removeFilter(n),i=_[n].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||_[n].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?_[n].getSelection()[0][s]:y(n,s),f.list.addFilter(n,r,i),c=f.list.filter(),o=!0,g()}),_[n].el.on(OGX.DynamicList.UNSELECT,function(t,e){var i;f.list.removeFilter(n),0<(i=_[n].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||_[n].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:y(n,s)).length&&f.list.addFilter(n,r,i),c=f.list.filter(),o=!0,g()});break;case OGX.TagManager.NAME:f.list.removeFilter(n),f.list.addFilter(n,r,t.getCurrentTags()),_[n].el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(t,e){f.list.removeFilter(n),f.list.addFilter(n,r,_[n].getCurrentTags()),c=f.list.filter(),o=!0,g()});break;case OGX.Switch.NAME:f.list.removeFilter(n),f.list.addFilter(n,r,t.val()),_[n].el.on(OGX.Switch.TOGGLE,function(t,e){f.list.removeFilter(n),f.list.addFilter(n,r,e),c=f.list.filter(),o=!0,g()});break;case OGX.SwitchMulti.NAME:f.list.removeFilter(n),f.list.addFilter(n,r,t.val()),_[n].el.on(OGX.SwitchMulti.CHANGE,function(t,e){f.list.removeFilter(n),f.list.addFilter(n,r,e),c=f.list.filter(),o=!0,g()})}else if("string"==typeof t){if(0===$(t).length)return!1;var i;switch(_[n]=$(t),$(t).attr("type").toLowerCase()){case"text":case"number":case"email":case"password":_[n].on("input",function(){i=$(this).val(),f.list.removeFilter(n),i.length&&f.list.addFilter(n,r,i),c=f.list.filter(),o=!0,g()});break;case"range":var l;_[n].on("input",function(){l=Number($(this).attr("min")),f.list.removeFilter(n),f.list.addFilter(n,r,[l,$(this).val()]),c=f.list.filter(),o=!0,g()})}}}(t,e,i,n)},this.unbind=function(t){return!!_.hasOwnProperty(t)&&n(t)},this.order=function(t,e){f.list.order(t,e),g()},this.filter=function(){return c=f.list.filter(),o=!0,g(),c},this.unfilter=function(){return o=!1,g(),!0},this.addFilter=function(t,e,i){return f.list.addFilter(t,e,i)},this.removeFilter=function(t,e,i){return f.list.removeFilter(t,e,i)},this.resetFilters=function(){return f.list.resetFilters()},this.getFilters=function(){return f.list.getFilters()},this.insert=function(t,e){var i;f.key||(t[m]=h++);var n=!0;if(o){var s=new OGX.List(t);s.setFilters(f.list.getFilters()),0===s.filter().length&&(n=!1)}var r=u(t),l='<span class="ogx_dynamic_list_item '+r.css+'" data-id='+t[m]+">"+OGX.Templater.templatize(t,r.html)+"</span>";if(void 0===e)f.list.push(t),n&&d.append(l);else if(f.list.insert(t,e),n){if(o)i=(c=f.list.filter()).findIndex(m,t[m]);else{if(0===e)return d.prepend(l),!0;i=f.list.findIndex(m,t[m])}var a=d.children(".ogx_dynamic_list_item:nth-child("+(i.index+1)+")");0<a.length?a.before(l):d.append(l),f.trigger&&d.trigger(OGX.DynamicList.RENDER)}return n},this.delete=function(t){return!!E().delete(t)&&(d.children(".ogx_dynamic_list_item:eq("+t+")").remove(),!0)},this.deleteSelection=function(){for(var t=E(),e=0;e<a.length;e++)t.findDelete(m,a[e][m],1),d.children(".ogx_dynamic_list_selected_item").remove();return!0},this.findDelete=function(t,e,i){for(var n=f.list.findDelete(t,e,i),s=0;s<n.length;s++)d.children(".ogx_dynamic_list_item[data-id="+n[s][m]+"]:first").remove();return n},this.select=function(t,e){return r(t,e,!0)},this.selectIndex=function(t){return O(t,!0)},this.unselect=function(t,e){return r(t,e,!1)},this.unselectIndex=function(t){return O(t,!1)},this.resetSelection=function(){a=new OGX.List,d.children(".ogx_dynamic_list_selected_item").removeClass("ogx_dynamic_list_selected_item")},this.getSelection=function(t){return void 0===t&&(t=!1),t?d.children(".ogx_dynamic_list_selected_item"):f.key?a:L(JSON.parse(JSON.stringify(a)))},this.replace=function(t,e,i){f.key||(i[m]=h++);var n=f.list.findReplace(t,e,i,1);if(0<n.length){var s=d.children(".ogx_dynamic_list_item[data-id="+n[0][m]+"]:first");if(s.length){var r=u(i),l=OGX.Templater.templatize(i,r.html);s.attr("data-id",i[m]),s.html(l),f.trigger&&d.trigger(OGX.DynamicList.RENDER)}return!0}return!1},this.update=function(t,e,i,n,s){var r,l,a=f.list.findUpdate(t,e,i,n,s);if(a.length){for(var c,o=0;o<a.length;o++)0<(r=d.children(".ogx_dynamic_list_item[data-id="+a[o][m]+"]:first")).length&&(c=u(a[o]),l=OGX.Templater.templatize(a[o],c.html),r.html(l),f.trigger&&d.trigger(OGX.DynamicList.RENDER));return a.length}return!1},this.clear=function(){d.empty()},this.reset=function(){d.empty(),o=!1,f.list=new OGX.List,a=new OGX.List,c=new OGX.List},this.destroy=function(){!function(){for(var t in _)n(t)}(),f.enabled&&s(!1),d.empty(),d.removeClass("ogx_dynamic_list")},this.render=function(){g()},void 0!==OGX.Templater?void 0!==OGX.List?(function(){for(var t in f||(f={}),e)f.hasOwnProperty(t)||(f[t]=e[t]);0<f.list.length&&!f.list.hasOwnProperty("insert")&&(f.list=new OGX.List(f.list)),!f.key&&0<f.list.length?(m=i,G()):m=f.key,$(f.container).append('<div class="ogx_dynamic_list"></div>'),l.el=d=$(f.container).children(".ogx_dynamic_list:first")}(),l.val(f.list),g(),f.enabled&&s(!0),setTimeout(function(){d.trigger(OGX.DynamicList.READY)},0)):console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000"):console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000")},OGX.DynamicList.NAME="OgxDynamicList",OGX.DynamicList.SELECT="DynamicListSelect",OGX.DynamicList.UNSELECT="DynamicListUnselect",OGX.DynamicList.RENDER="DynamicListRender",OGX.DynamicList.SELECT_MODE_SINGLE="single",OGX.DynamicList.SELECT_MODE_TOGGLE="toggle",OGX.DynamicList.SELECT_MODE_MULTI="multi",OGX.DynamicList.READY="DynamicListReady";