OGX.DynamicList=function(t){"use strict";var d,a,c,m,l=this,p=t,e={container:null,enabled:!0,key:!1,display:!1,list:[],mode:OGX.DynamicList.SELECT_MODE_SINGLE,trigger:!1},o=new OGX.List,s={},y=1,i="__id__";function n(){for(var t,e,i,r=O(),n="",s=0;s<r.length;s++)!1,e="",t=r[s][m],o.find(m,t,1).length&&(e="ogx_dynamic_list_selected_item"),n+='<div class="ogx_dynamic_list_item '+e+" "+(i=f(r[s])).css+'" data-id='+t+">"+OGX.Templater.templatize(r[s],i.html)+"</div>";d.html(n),p.trigger&&d.trigger(OGX.DynamicList.RENDER)}function f(t){var e={html:"",css:""},i=p.display;return i.hasOwnProperty("html")?e.html=i.html:i.hasOwnProperty("template")&&("object"==typeof i.template&&i.template.hasOwnProperty("bind")?t.hasOwnProperty(i.template.bind)&&(e.html=OGX.Templater.getTemplate(t[i.template.bind])):"string"==typeof i.template&&(e.html=OGX.Templater.getTemplate(i.template))),i.hasOwnProperty("css")&&("object"==typeof i.css&&i.css.hasOwnProperty("bind")?t.hasOwnProperty(i.css.bind)&&(e.css=t[i.css.bind]):"string"==typeof i.css&&(e.css=i.css)),e}function r(t){if(s.hasOwnProperty(t)&&"object"==typeof s[t].object)switch(s[t].object._NAME_){case OGX.DynamicList.NAME:s[t].object.el.off(OGX.DynamicList.SELECT),s[t].object.el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:s[t].object.el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:s[t].object.el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:s[t].object.el.off(OGX.SwitchMulti.CHANGE);break;default:s[t].object.off("input")}else s[t].object.off("input");return p.list.removeFilter(t),delete s[t],a=p.list.filter(),c=!0,n(),!0}function _(t,e){for(var i=s[t].getSelection(),r=[],n=0;n<i.length;n++)r.push(i[n][e]);return r}function h(t){t?d.on("click",".ogx_dynamic_list_item",function(){switch(p.mode){case OGX.DynamicList.SELECT_MODE_SINGLE:$(this).hasClass("ogx_dynamic_list_selected_item")||(u($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,o[o.length-1]));break;case OGX.DynamicList.SELECT_MODE_TOGGLE:$(this).hasClass("ogx_dynamic_list_selected_item")?(u($(this).index(),!1),d.trigger(OGX.DynamicList.UNSELECT)):(l.resetSelection(),u($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,o[o.length-1]));break;case OGX.DynamicList.SELECT_MODE_MULTI:$(this).hasClass("ogx_dynamic_list_selected_item")?(u($(this).index(),!1),d.trigger(OGX.DynamicList.UNSELECT)):(u($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,o))}}):d.off("click",".ogx_dynamic_list_item")}function g(t,e,i){"single"===p.mode&&l.resetSelection();for(var r,n=O().find(t,e),s=0;s<n.length;s++)(r=d.find(".ogx_dynamic_list_item[data-id="+n[s][m]+"]:first"))&&(i?(r.addClass("ogx_dynamic_list_selected_item"),o.push(n[s])):r.removeClass("ogx_dynamic_list_selected_item"));return"single"===p.mode&&n.length?n[0]:n}function u(t,e){var i,r=O();return 0<(i=d.find(".ogx_dynamic_list_item:eq("+t+")")).length&&(p.mode===OGX.DynamicList.SELECT_MODE_SINGLE&&l.resetSelection(),e?(i.addClass("ogx_dynamic_list_selected_item"),o.push(r[t])):(i.removeClass("ogx_dynamic_list_selected_item"),o.findDelete(m,i.data("id"),1)),!0)}function O(){return c?a:p.list}function E(){for(var t=0;t<p.list.length;t++)p.list[t][m]=y,y++}function G(t){for(var e=0;e<t.length;e++)delete t[e][m];return t}this._NAME_=OGX.DynamicList.NAME,this.el=null,this.val=function(t){if(void 0===t)return p.key?p.list:G(JSON.parse(JSON.stringify(p.list)));t.hasOwnProperty("insert")||(t=new OGX.List(t)),p.list=t,p.key||(y=1,m=i,E()),n()},this.display=function(t){return void 0===t?p.display:(p.display=t,!0)},this.mode=function(t){return void 0===t?p.mode:(p.mode=t,!0)},this.enable=function(){return!p.enabled&&(h(p.enabled=!0),!0)},this.disable=function(){return!!p.enabled&&(h(p.enabled=!1),!0)},this.bind=function(t){return!s.hasOwnProperty(t.property)&&function(r){r.hasOwnProperty("mode")||(r.mode="eqjson");if("object"==typeof r.object)switch((s[r.property]=r).object._NAME_){case OGX.DynamicList.NAME:p.list.removeFilter(r.property);var t=_(r.property,r.remote_property);p.list.addFilter(r.property,r.mode,t),s[r.property].el.on(OGX.DynamicList.SELECT,function(t,e){var i;p.list.removeFilter(r.property),i=s[r.property].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||s[r.property].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?s[r.property].getSelection()[0][r.remote_property]:_(r.property,r.remote_property),p.list.addFilter(r.property,r.mode,i),a=p.list.filter(),c=!0,n()}),s[r.property].el.on(OGX.DynamicList.UNSELECT,function(t,e){var i;p.list.removeFilter(r.property),0<(i=s[r.property].mode()===OGX.DynamicList.SELECT_MODE_SINGLE||s[r.property].mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:_(r.property,r.remote_property)).length&&p.list.addFilter(r.property,r.mode,i),a=p.list.filter(),c=!0,n()});break;case OGX.TagManager.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.getCurrentTags()),s[r.property].el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(t,e){p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,s[r.property].object.getCurrentTags()),a=p.list.filter(),c=!0,n()});break;case OGX.Switch.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),s[r.property].el.on(OGX.Switch.TOGGLE,function(t,e){p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,n()});break;case OGX.SwitchMulti.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),s[r.property].el.on(OGX.SwitchMulti.CHANGE,function(t,e){p.list.removeFilter(r.property),""!==e&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,n()})}else if("string"==typeof r.object){if(0===$(r.object).length)return!1;var e;switch(r.object=$(r.object),(s[r.property]=r).object.attr("type").toLowerCase()){case"text":case"number":case"email":case"password":case"tel":s[r.property].object.on("input",function(){if(e=$(this).val(),s[r.property].hasOwnProperty("min_length")&&e.length<s[r.property].min_length)return!1;p.list.removeFilter(r.property),e.length&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,n()});break;case"range":var i;s[r.property].object.on("input",function(){i=Number($(this).attr("min")),p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,[i,$(this).val()]),a=p.list.filter(),c=!0,n()})}}}(t)},this.unbind=function(t){return!!s.hasOwnProperty(t)&&r(t)},this.order=function(t,e){p.list.order(t,e),n()},this.filter=function(){return a=p.list.filter(),c=!0,n(),a},this.unfilter=function(){return c=!1,n(),!0},this.addFilter=function(t,e,i){return p.list.addFilter(t,e,i)},this.removeFilter=function(t,e,i){return p.list.removeFilter(t,e,i)},this.resetFilters=function(){return p.list.resetFilters()},this.getFilters=function(){return p.list.getFilters()},this.insert=function(t,e){var i;p.key||(t[m]=y++);var r=!0;if(c){var n=new OGX.List(t);n.setFilters(p.list.getFilters()),0===n.filter().length&&(r=!1)}var s=f(t),l='<span class="ogx_dynamic_list_item '+s.css+'" data-id='+t[m]+">"+OGX.Templater.templatize(t,s.html)+"</span>";if(void 0===e)p.list.push(t),r&&d.append(l);else if(p.list.insert(t,e),r){if(c)i=(a=p.list.filter()).findIndex(m,t[m]);else{if(0===e)return d.prepend(l),!0;i=p.list.findIndex(m,t[m])}var o=d.children(".ogx_dynamic_list_item:nth-child("+(i.index+1)+")");0<o.length?o.before(l):d.append(l),p.trigger&&d.trigger(OGX.DynamicList.RENDER)}return r},this.delete=function(t){return!!O().delete(t)&&(d.children(".ogx_dynamic_list_item:eq("+t+")").remove(),!0)},this.deleteSelection=function(){for(var t=O(),e=0;e<o.length;e++)t.findDelete(m,o[e][m],1),d.children(".ogx_dynamic_list_selected_item").remove();return!0},this.findDelete=function(t,e,i){for(var r=p.list.findDelete(t,e,i),n=0;n<r.length;n++)d.children(".ogx_dynamic_list_item[data-id="+r[n][m]+"]:first").remove();return r},this.select=function(t,e){return g(t,e,!0)},this.selectIndex=function(t){return u(t,!0)},this.unselect=function(t,e){return g(t,e,!1)},this.unselectIndex=function(t){return u(t,!1)},this.resetSelection=function(){o=new OGX.List,d.children(".ogx_dynamic_list_selected_item").removeClass("ogx_dynamic_list_selected_item")},this.getSelection=function(t){return void 0===t&&(t=!1),t?d.children(".ogx_dynamic_list_selected_item"):p.key?o:G(JSON.parse(JSON.stringify(o)))},this.replace=function(t,e,i){p.key||(i[m]=y++);var r=p.list.findReplace(t,e,i,1);if(0<r.length){var n=d.children(".ogx_dynamic_list_item[data-id="+r[0][m]+"]:first");if(n.length){var s=f(i),l=OGX.Templater.templatize(i,s.html);n.attr("data-id",i[m]),n.html(l),p.trigger&&d.trigger(OGX.DynamicList.RENDER)}return!0}return!1},this.update=function(t,e,i,r,n){var s,l,o=p.list.findUpdate(t,e,i,r,n);if(o.length){for(var a,c=0;c<o.length;c++)0<(s=d.children(".ogx_dynamic_list_item[data-id="+o[c][m]+"]:first")).length&&(a=f(o[c]),l=OGX.Templater.templatize(o[c],a.html),s.html(l),p.trigger&&d.trigger(OGX.DynamicList.RENDER));return o.length}return!1},this.clear=function(){d.empty()},this.reset=function(){d.empty(),c=!1,p.list=new OGX.List,o=new OGX.List,a=new OGX.List},this.destroy=function(){!function(){for(var t in s)r(t)}(),p.enabled&&h(!1),d.empty(),d.removeClass("ogx_dynamic_list")},this.render=function(){n()},void 0!==OGX.Templater?void 0!==OGX.List?(function(){for(var t in p||(p={}),e)p.hasOwnProperty(t)||(p[t]=e[t]);0<p.list.length&&!p.list.hasOwnProperty("insert")&&(p.list=new OGX.List(p.list)),!p.key&&0<p.list.length?(m=i,E()):m=p.key,$(p.container).append('<div class="ogx_dynamic_list"></div>'),l.el=d=$(p.container).children(".ogx_dynamic_list:first")}(),l.val(p.list),n(),p.enabled&&h(!0),setTimeout(function(){d.trigger(OGX.DynamicList.READY)},0)):console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000"):console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000")},OGX.DynamicList.NAME="OgxDynamicList",OGX.DynamicList.SELECT="DynamicListSelect",OGX.DynamicList.UNSELECT="DynamicListUnselect",OGX.DynamicList.RENDER="DynamicListRender",OGX.DynamicList.SELECT_MODE_SINGLE="single",OGX.DynamicList.SELECT_MODE_TOGGLE="toggle",OGX.DynamicList.SELECT_MODE_MULTI="multi",OGX.DynamicList.READY="DynamicListReady";