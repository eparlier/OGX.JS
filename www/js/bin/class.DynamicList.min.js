OGX.DynamicList=function(t){"use strict";var m,a,c,d,o=this,p=t,e={container:null,enabled:!0,key:!1,display:!1,list:[],mode:OGX.DynamicList.SELECT_MODE_SINGLE,trigger:!1},l=new OGX.List,s={},y=1,i="__id__";function n(){for(var t,e,i,r=O(),n="",s=0;s<r.length;s++)!1,e="",t=r[s][d],l.find(d,t,1).length&&(e="ogx_dynamic_list_selected_item"),n+='<div class="ogx_dynamic_list_item '+e+" "+(i=u(r[s])).css+'" data-id='+t+">"+OGX.Templater.templatize(r[s],i.html)+"</div>";m.html(n),p.trigger&&m.trigger(OGX.DynamicList.RENDER)}function u(t){var e={html:"",css:""},i=p.display;return i.hasOwnProperty("html")?e.html=i.html:i.hasOwnProperty("template")&&("object"==typeof i.template&&i.template.hasOwnProperty("bind")?t.hasOwnProperty(i.template.bind)&&(e.html=OGX.Templater.getTemplate(t[i.template.bind])):"string"==typeof i.template&&(e.html=OGX.Templater.getTemplate(i.template))),i.hasOwnProperty("css")&&("object"==typeof i.css&&i.css.hasOwnProperty("bind")?t.hasOwnProperty(i.css.bind)&&(e.css=t[i.css.bind]):"string"==typeof i.css&&(e.css=i.css)),e}function r(t){if(s.hasOwnProperty(t)&&"object"==typeof s[t].object)switch(s[t].object._NAME_){case OGX.DynamicList.NAME:s[t].object.el.off(OGX.DynamicList.SELECT),s[t].object.el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:s[t].object.el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:s[t].object.el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:s[t].object.el.off(OGX.SwitchMulti.CHANGE);break;default:s[t].object.off("input")}else s[t].object.off("input");return p.list.removeFilter(t),delete s[t],a=p.list.filter(),c=!0,setTimeout(n,0),!0}function f(t,e){for(var i=s[t].object.getSelection(),r=[],n=0;n<i.length;n++)r.push(i[n][e]);return r}function _(t){t?m.on("click",".ogx_dynamic_list_item",function(){switch(p.mode){case OGX.DynamicList.SELECT_MODE_SINGLE:$(this).hasClass("ogx_dynamic_list_selected_item")||(g($(this).index(),!0),m.trigger(OGX.DynamicList.SELECT,l[l.length-1]));break;case OGX.DynamicList.SELECT_MODE_TOGGLE:$(this).hasClass("ogx_dynamic_list_selected_item")?(g($(this).index(),!1),m.trigger(OGX.DynamicList.UNSELECT)):(o.resetSelection(),g($(this).index(),!0),m.trigger(OGX.DynamicList.SELECT,l[l.length-1]));break;case OGX.DynamicList.SELECT_MODE_MULTI:$(this).hasClass("ogx_dynamic_list_selected_item")?(g($(this).index(),!1),m.trigger(OGX.DynamicList.UNSELECT)):(g($(this).index(),!0),m.trigger(OGX.DynamicList.SELECT,l))}}):m.off("click",".ogx_dynamic_list_item")}function h(t,e,i){"single"===p.mode&&o.resetSelection();for(var r,n=O().find(t,e),s=0;s<n.length;s++)(r=m.find(".ogx_dynamic_list_item[data-id="+n[s][d]+"]:first"))&&(i?(r.addClass("ogx_dynamic_list_selected_item"),l.push(n[s])):r.removeClass("ogx_dynamic_list_selected_item"));return"single"===p.mode&&n.length?n[0]:n}function g(t,e){var i,r=O();return 0<(i=m.find(".ogx_dynamic_list_item:eq("+t+")")).length&&(p.mode===OGX.DynamicList.SELECT_MODE_SINGLE&&o.resetSelection(),e?(i.addClass("ogx_dynamic_list_selected_item"),l.push(r[t])):(i.removeClass("ogx_dynamic_list_selected_item"),l.findDelete(d,i.data("id"),1)),!0)}function O(){return c?a:p.list}function E(){for(var t=0;t<p.list.length;t++)p.list[t][d]=y,y++}function G(t){for(var e=0;e<t.length;e++)delete t[e][d];return t}this._NAME_=OGX.DynamicList.NAME,this.el=null,this.val=function(t){if(void 0===t)return p.key?p.list:G(JSON.parse(JSON.stringify(p.list)));t.hasOwnProperty("insert")||(t=new OGX.List(t)),p.list=t,p.key||(y=1,d=i,E()),setTimeout(n,0)},this.display=function(t){return void 0===t?p.display:(p.display=t,!0)},this.mode=function(t){return void 0===t?p.mode:(p.mode=t,!0)},this.enable=function(){return!p.enabled&&(_(p.enabled=!0),!0)},this.disable=function(){return!!p.enabled&&(_(p.enabled=!1),!0)},this.bind=function(t){return!s.hasOwnProperty(t.property)&&function(r){r.hasOwnProperty("mode")||(r.mode="eqjson");if("object"==typeof r.object)switch((s[r.property]=r).object._NAME_){case OGX.DynamicList.NAME:p.list.removeFilter(r.property);var t=f(r.property,r.remote_property);p.list.addFilter(r.property,r.mode,t),s[r.property].object.el.on(OGX.DynamicList.SELECT,function(t,e){var i;return p.list.removeFilter(r.property),i=s[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||s[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?s[r.property].object.getSelection()[0][r.remote_property]:f(r.property,r.remote_property),p.list.addFilter(r.property,r.mode,i),a=p.list.filter(),c=!0,setTimeout(n,0),!1}),s[r.property].object.el.on(OGX.DynamicList.UNSELECT,function(t,e){var i;return p.list.removeFilter(r.property),0<(i=s[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||s[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:f(r.property,r.remote_property)).length&&p.list.addFilter(r.property,r.mode,i),a=p.list.filter(),c=!0,setTimeout(n,0),!1});break;case OGX.TagManager.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.getCurrentTags()),s[r.property].object.el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(t,e){return p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,s[r.property].object.getCurrentTags()),a=p.list.filter(),c=!0,setTimeout(n,0),!1});break;case OGX.Switch.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),s[r.property].object.el.on(OGX.Switch.TOGGLE,function(t,e){return p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,setTimeout(n,0),!1});break;case OGX.SwitchMulti.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),s[r.property].object.el.on(OGX.SwitchMulti.CHANGE,function(t,e){return p.list.removeFilter(r.property),""!==e&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,setTimeout(n,0),!1})}else if("string"==typeof r.object){if(0===$(r.object).length)return!1;var e;switch(r.object=$(r.object),(s[r.property]=r).object.attr("type").toLowerCase()){case"text":case"number":case"email":case"password":case"tel":s[r.property].object.on("input",function(){return e=$(this).val(),s[r.property].hasOwnProperty("min_length")&&e.length<s[r.property].min_length||(p.list.removeFilter(r.property),e.length&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,setTimeout(n,0)),!1});break;case"range":var i;s[r.property].object.on("input",function(){return i=Number($(this).attr("min")),p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,[i,$(this).val()]),a=p.list.filter(),c=!0,setTimeout(n,0),!1})}}}(t)},this.unbind=function(t){return!!s.hasOwnProperty(t)&&r(t)},this.order=function(t,e){return p.list.order(t,e),setTimeout(n,0),!0},this.filter=function(){return a=p.list.filter(),c=!0,setTimeout(n,0),a},this.unfilter=function(){return c=!1,setTimeout(n,0),!0},this.addFilter=function(t,e,i){return p.list.addFilter(t,e,i)},this.removeFilter=function(t,e,i){return p.list.removeFilter(t,e,i)},this.resetFilters=function(){return p.list.resetFilters()},this.getFilters=function(){return p.list.getFilters()},this.insert=function(t,e){var i;p.key||(t[d]=y++);var r=!0;if(c){var n=new OGX.List(t);n.setFilters(p.list.getFilters()),0===n.filter().length&&(r=!1)}var s=u(t),o='<span class="ogx_dynamic_list_item '+s.css+'" data-id='+t[d]+">"+OGX.Templater.templatize(t,s.html)+"</span>";if(void 0===e)p.list.push(t),r&&m.append(o);else if(p.list.insert(t,e),r){if(c)i=(a=p.list.filter()).findIndex(d,t[d]);else{if(0===e)return m.prepend(o),!0;i=p.list.findIndex(d,t[d])}var l=m.children(".ogx_dynamic_list_item:nth-child("+(i.index+1)+")");0<l.length?l.before(o):m.append(o),p.trigger&&m.trigger(OGX.DynamicList.RENDER)}return r},this.delete=function(t){return!!O().delete(t)&&(m.children(".ogx_dynamic_list_item:eq("+t+")").remove(),!0)},this.deleteSelection=function(){for(var t=O(),e=0;e<l.length;e++)t.findDelete(d,l[e][d],1),m.children(".ogx_dynamic_list_selected_item").remove();return!0},this.findDelete=function(t,e,i){for(var r=p.list.findDelete(t,e,i),n=0;n<r.length;n++)m.children(".ogx_dynamic_list_item[data-id="+r[n][d]+"]:first").remove();return r},this.select=function(t,e){return h(t,e,!0)},this.selectIndex=function(t){return g(t,!0)},this.unselect=function(t,e){return h(t,e,!1)},this.unselectIndex=function(t){return g(t,!1)},this.resetSelection=function(){l=new OGX.List,m.children(".ogx_dynamic_list_selected_item").removeClass("ogx_dynamic_list_selected_item")},this.getSelection=function(t){return void 0===t&&(t=!1),t?m.children(".ogx_dynamic_list_selected_item"):p.key?l:G(JSON.parse(JSON.stringify(l)))},this.replace=function(t,e,i){p.key||(i[d]=y++);var r=p.list.findReplace(t,e,i,1);if(0<r.length){var n=m.children(".ogx_dynamic_list_item[data-id="+r[0][d]+"]:first");if(n.length){var s=u(i),o=OGX.Templater.templatize(i,s.html);n.attr("data-id",i[d]),n.html(o),p.trigger&&m.trigger(OGX.DynamicList.RENDER)}return!0}return!1},this.update=function(t,e,i,r,n){var s,o,l=p.list.findUpdate(t,e,i,r,n);if(l.length){for(var a,c=0;c<l.length;c++)0<(s=m.children(".ogx_dynamic_list_item[data-id="+l[c][d]+"]:first")).length&&(a=u(l[c]),o=OGX.Templater.templatize(l[c],a.html),s.html(o),p.trigger&&m.trigger(OGX.DynamicList.RENDER));return l.length}return!1},this.clear=function(){m.empty()},this.reset=function(){m.empty(),c=!1,p.list=new OGX.List,l=new OGX.List,a=new OGX.List},this.destroy=function(){!function(){for(var t in s)r(t)}(),p.enabled&&_(!1),m.empty(),m.removeClass("ogx_dynamic_list")},this.render=function(){setTimeout(n,0)},void 0!==OGX.Templater?void 0!==OGX.List?(function(){for(var t in p||(p={}),e)p.hasOwnProperty(t)||(p[t]=e[t]);0<p.list.length&&!p.list.hasOwnProperty("insert")&&(p.list=new OGX.List(p.list)),!p.key&&0<p.list.length?(d=i,E()):d=p.key,$(p.container).append('<div class="ogx_dynamic_list"></div>'),o.el=m=$(p.container).children(".ogx_dynamic_list:first")}(),o.val(p.list),setTimeout(n,0),p.enabled&&_(!0),setTimeout(function(){m.trigger(OGX.DynamicList.READY)},0)):console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000"):console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000")},OGX.DynamicList.NAME="OgxDynamicList",OGX.DynamicList.SELECT="DynamicListSelect",OGX.DynamicList.UNSELECT="DynamicListUnselect",OGX.DynamicList.RENDER="DynamicListRender",OGX.DynamicList.SELECT_MODE_SINGLE="single",OGX.DynamicList.SELECT_MODE_TOGGLE="toggle",OGX.DynamicList.SELECT_MODE_MULTI="multi",OGX.DynamicList.READY="DynamicListReady";