OGX.DynamicList=function(t){"use strict";var m,l,c,d,o=this,p=t,e={container:null,enabled:!0,key:!1,display:!1,reorder:!1,swipe:!1,chromeos:!1,min_x:30,click_time:100,hold_time:2e3,list:[],mode:OGX.DynamicList.SELECT_MODE_SINGLE,trigger:!1,swipe_template:'<div class="ogx_dynamic_list_item ogx_dynamic_list_swiper_back_item" style="height:{{$height}}px; z-index:{{$zindex}};">{{$template}}</div>'},i={mode:OGX.DynamicList.SWIPE_MODE_DELETE,template:!1,html:""},a=new OGX.List,n={},_=1,r="__id__",y={mode:!1,stime:0,target:0,si:0,ei:0,y:0},s=null,g=null,f=null,h="mousedown",u="mouseup",O="mousemove";function E(){for(var t,e,i,r=z(),s="",n=0;n<r.length;n++)!1,e="",t=r[n][d],a.find(d,t,1).length&&(e="ogx_dynamic_list_selected_item"),s+='<div class="ogx_dynamic_list_item '+e+" "+(i=v(r[n])).css+'" data-id='+t+">"+OGX.Templater.templatize(r[n],i.html)+"</div>";m.html(s),p.trigger&&m.trigger(OGX.DynamicList.RENDER)}function v(t){var e={html:"",css:""},i=p.display;return i.hasOwnProperty("html")?e.html=i.html:i.hasOwnProperty("template")&&("object"==typeof i.template&&i.template.hasOwnProperty("bind")?t.hasOwnProperty(i.template.bind)&&(e.html=OGX.Templater.getTemplate(t[i.template.bind])):"string"==typeof i.template&&(e.html=OGX.Templater.getTemplate(i.template))),i.hasOwnProperty("css")&&("object"==typeof i.css&&i.css.hasOwnProperty("bind")?(t.hasOwnProperty(i.css.bind)&&(e.css=t[i.css.bind]),i.css.hasOwnProperty("add")&&(e.css+=" "+i.css.add)):"string"==typeof i.css&&(e.css=i.css)),e}function L(t){if(n.hasOwnProperty(t)&&"object"==typeof n[t].object)switch(n[t].object._NAME_){case OGX.DynamicList.NAME:n[t].object.el.off(OGX.DynamicList.SELECT),n[t].object.el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:n[t].object.el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:n[t].object.el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:n[t].object.el.off(OGX.SwitchMulti.CHANGE);break;case OGX.Roulette.NAME:n[t].object.el.off(OGX.Roulette.CHANGE);break;default:n[t].object.off("input")}else n[t].object.off("input");return p.list.removeFilter(t),delete n[t],l=p.list.filter(),c=!0,setTimeout(E,0),!0}function G(t,e){for(var i=n[t].object.getSelection(),r=[],s=0;s<i.length;s++)r.push(i[s][e]);return r}function D(t){t?m.on("click",".ogx_dynamic_list_item",R):m.off("click",".ogx_dynamic_list_item",R)}function x(t){t?m.on(h,".ogx_dynamic_list_item",T):m.off(h,".ogx_dynamic_list_item",T)}function w(t){t?g=setInterval(S,20):(clearInterval(g),g=null)}function X(t){t?m.on(O,".ogx_dynamic_list_item",b):m.off(O,".ogx_dynamic_list_item")}function T(t){y.mode=!1,y.target=$(t.currentTarget),y.si=y.target.index(),y.cy=m.offset().top,t=A(t),y.startx=t.pageX,y.starty=t.pageY,f&&clearInterval(f),y.stime=(new Date).getTime(),p.reorder&&w(!0),X(!0),$("body").on(u,C)}function b(t){t.preventDefault(),t.stopImmediatePropagation(),t=A(t),y.y=-1*(y.starty-t.pageY),y.mx=t.pageX-y.startx,y.px=t.pageX,y.mode||Math.abs(y.mx)>p.min_x&&(y.mode="swipe",p.reorder&&w(!1),M(!0))}function S(){!y.mode&&(new Date).getTime()-y.stime>p.hold_time&&(y.mode="reorder",y.item=p.list.find(d,y.target.data("id").toString(),1),m.trigger(OGX.DynamicList.HOLD,y.item),w(!1),setTimeout(function(){y.tgy=y.target.position().top,y.tgx=y.target.position().left,y.y=0;var t=y.target.outerWidth(),e=y.target.outerHeight();y.clone=y.target.clone().css({position:"absolute",left:y.tgx+"px",top:y.tgy+"px",width:t+"px",height:e+"px"}).addClass("ogx_dynamic_list_reorder").prependTo(m),y.target.addClass("ogx_dynamic_list_frozen"),f=setInterval(P,10),m.on(O,j)}(),0))}function C(t){if($("body").off(u,C),t.preventDefault(),t.stopImmediatePropagation(),(p.reorder||p.swipe)&&(clearInterval(f),X(f=!1)),p.swipe&&M(!1),p.reorder&&w(!1),p.reorder&&"reorder"===y.mode){if(m.off(O,j),y.clone){var e=JSON.parse(JSON.stringify(p.list[y.si]));return p.list.delete(y.si),p.list.insert(e,y.ei),y.clone.remove(),y.clone=!1,y.target.removeClass("ogx_dynamic_list_frozen"),void m.trigger(OGX.DynamicList.DROP,y.item)}if((new Date).getTime()-y.stime<p.click_time){var i=y.target.data("id").toString(),r=p.list.find(d,i,1);m.trigger(OGX.DynamicList.SELECT,r),o.select(d,i)}}else if(p.swipe&&"swipe"===y.mode){var s=y.target.width(),n=Math.abs(100*y.mx/s);n<50?n?(y.target.addClass("ogx_dynamic_list_swiper_trans_item_restore"),y.target.addClass("ogx_dynamic_list_swiper_trans_item").css("transform","translateX("+-1*y.target.position().left+"px)")):(y.target.next(".ogx_dynamic_list_swiper_back_item:first").remove(),y.target[0].style.removeProperty("right"),y.target[0].style.removeProperty("transform")):0<y.mx?(y.target.attr("data-side","left"),y.target.addClass("ogx_dynamic_list_swiper_trans_item").css("transform","translateX("+(s-y.target.position().left)+"px)")):(y.target.attr("data-side","right"),y.target.addClass("ogx_dynamic_list_swiper_trans_item").css("transform","translateX("+-1*(y.target.position().left+s)+"px)"))}y.mode=!1}function M(t){t?s=setInterval(F,20):(clearInterval(s),s=!1)}function F(){if("swipe"===y.mode&&Math.abs(y.mx)>p.min_x){if(!y.target.hasClass("ogx_dynamic_list_swiper_work")){y.target.addClass("ogx_dynamic_list_swiper_work");var t=y.target.outerHeight(),e={};e.height=t,e.margin=t,e.top=y.target.position().top,e.zindex=p.zindex;var i="";p.swipe.template?i=OGX.Templater.getTemplate(p.swipe.template):p.swipe.html&&(i=p.swipe.html),e.template=i,i=OGX.Templater.templatize(e,p.swipe_template),y.target.after(i)}y.target.css("right",-1*y.mx+"px");var r=y.target.next(".ogx_dynamic_list_swiper_back_item:first");y.mx<0?(r.removeClass("ogx_dynamic_list_swiper_left"),r.addClass("ogx_dynamic_list_swiper_right")):(r.addClass("ogx_dynamic_list_swiper_left"),r.removeClass("ogx_dynamic_list_swiper_right"))}}function N(t){t?m.on("transitionend",".ogx_dynamic_list_swiper_trans_item",function(){var t,e=$(this),i=e.next(".ogx_dynamic_list_swiper_back_item:first");if(e.hasClass("ogx_dynamic_list_swiper_trans_item_restore"))i.remove(),e[0].style.removeProperty("right"),e[0].style.removeProperty("transform"),e.removeClass("ogx_dynamic_list_swiper_trans_item");else switch(p.swipe.mode){case OGX.DynamicList.SWIPE_MODE_DELETE:e.remove(),(t=i).addClass("ogx_dynamic_list_swiper_delete"),t.on("transitionend",function(){t.off("transitionend"),t.remove()});var r=p.list.findDelete(p.key,e.data("id"),1);r;break;case OGX.DynamicList.SWIPE_MODE_CUSTOM:}e.removeClass("ogx_dynamic_list_swiper_work"),e.removeClass("ogx_dynamic_list_swiper_trans_item_restore")}):m.off("transitionend",".ogx_dynamic_list_swiper_trans_item")}function j(t){t.preventDefault(),t.stopImmediatePropagation(),t=A(t),y.y=-1*(y.starty-t.pageY)}function P(){if(1<Math.abs(m.offset().top-y.cy))return clearInterval(f),f=!1,y.clone.remove(),y.clone=!1,y.target.removeClass("ogx_dynamic_list_frozen"),void m.trigger(OGX.DynamicList.RELEASE);var i=!1,t=m.children(".ogx_dynamic_list_item:last"),e=t.offset().top+-1*y.cy;if(y.tgy+y.y<e?y.clone.css({top:y.tgy+y.y}):i=t,!i){var r,s,n,o,a=0;m.children(".ogx_dynamic_list_item").each(function(t,e){if((e=$(e))[0]!==y.clone[0]&&!e.hasClass("ogx_dynamic_list_frozen")){if(r=e.offset().top,s=e.outerHeight(),o=r+s/2,n=y.clone.offset().top,r<n&&n<o)return a=-1,void(i=e);if(o<n&&n<r+s)return a=1,void(i=e)}})}if(i){switch(y.ei=p.list.findIndex(d,$(i).data("id").toString()).index,a){case-1:i.index()-1!==y.target.index()&&y.target.detach().insertBefore(i);break;case 1:i.index()+1!==y.target.index()&&y.target.detach().insertAfter(i)}i=!1}}function R(t){switch(p.mode){case OGX.DynamicList.SELECT_MODE_SINGLE:$(this).hasClass("ogx_dynamic_list_selected_item")||(k($(this).index(),!0),m.trigger(OGX.DynamicList.SELECT,a[a.length-1]));break;case OGX.DynamicList.SELECT_MODE_TOGGLE:$(this).hasClass("ogx_dynamic_list_selected_item")?(k($(this).index(),!1),m.trigger(OGX.DynamicList.UNSELECT)):(o.resetSelection(),k($(this).index(),!0),m.trigger(OGX.DynamicList.SELECT,a[a.length-1]));break;case OGX.DynamicList.SELECT_MODE_MULTI:$(this).hasClass("ogx_dynamic_list_selected_item")?(k($(this).index(),!1),m.trigger(OGX.DynamicList.UNSELECT)):(k($(this).index(),!0),m.trigger(OGX.DynamicList.SELECT,a));break;case OGX.DynamicList.SELECT_MODE_HIT:var e=z();m.trigger(OGX.DynamicList.SELECT,e[$(this).index()])}}function I(t,e,i){"single"===p.mode&&o.resetSelection();for(var r,s=z().find(t,e),n=0;n<s.length;n++)(r=m.find(".ogx_dynamic_list_item[data-id="+s[n][d]+"]:first"))&&(i?(r.addClass("ogx_dynamic_list_selected_item"),a.push(s[n])):r.removeClass("ogx_dynamic_list_selected_item"));return"single"===p.mode&&s.length?s[0]:s}function k(t,e){var i,r=z();return 0<(i=m.find(".ogx_dynamic_list_item:eq("+t+")")).length&&(p.mode===OGX.DynamicList.SELECT_MODE_SINGLE&&o.resetSelection(),e?(i.addClass("ogx_dynamic_list_selected_item"),a.push(r[t])):(i.removeClass("ogx_dynamic_list_selected_item"),a.findDelete(d,i.data("id"),1)),!0)}function A(t){return t.hasOwnProperty("originalEvent")&&void 0!==t.originalEvent.changedTouches?t.originalEvent.changedTouches[0]:t}function z(){return c?l:p.list}function H(){for(var t=0;t<p.list.length;t++)p.list[t][d]=String(_),_++}function U(t){for(var e=0;e<t.length;e++)delete t[e][d];return t}this._NAME_=OGX.DynamicList.NAME,this.el=null,this.val=function(t){if(void 0===t)return p.key?p.list:U(JSON.parse(JSON.stringify(p.list)));t.hasOwnProperty("insert")||(t=new OGX.List(t)),p.list=t,p.key||(_=1,d=r,H()),setTimeout(E,0)},this.getFilteredList=function(){return!!c&&l},this.display=function(t){return void 0===t?p.display:(p.display=t,!0)},this.mode=function(t){return void 0===t?p.mode:(p.mode=t,!0)},this.enable=function(){return!p.enabled&&(D(p.enabled=!0),!0)},this.disable=function(){return!!p.enabled&&(D(p.enabled=!1),!0)},this.bind=function(t){return!n.hasOwnProperty(t.property)&&function(r){r.hasOwnProperty("mode")||(r.mode="eqjson");if("object"==typeof r.object)switch((n[r.property]=r).object._NAME_){case OGX.DynamicList.NAME:p.list.removeFilter(r.property);var t=G(r.property,r.remote_property);p.list.addFilter(r.property,r.mode,t),n[r.property].object.el.on(OGX.DynamicList.SELECT,function(t,e){var i;return p.list.removeFilter(r.property),i=n[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||n[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?n[r.property].object.getSelection()[0][r.remote_property]:G(r.property,r.remote_property),p.list.addFilter(r.property,r.mode,i),l=p.list.filter(),c=!0,setTimeout(E,0),!1}),n[r.property].object.el.on(OGX.DynamicList.UNSELECT,function(t,e){var i;return p.list.removeFilter(r.property),0<(i=n[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||n[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:G(r.property,r.remote_property)).length&&p.list.addFilter(r.property,r.mode,i),l=p.list.filter(),c=!0,setTimeout(E,0),!1});break;case OGX.TagManager.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.getCurrentTags()),n[r.property].object.el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(t,e){return p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,n[r.property].object.getCurrentTags()),l=p.list.filter(),c=!0,setTimeout(E,0),!1});break;case OGX.Switch.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),n[r.property].object.el.on(OGX.Switch.TOGGLE,function(t,e){return p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e),l=p.list.filter(),c=!0,setTimeout(E,0),!1});break;case OGX.SwitchMulti.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),n[r.property].object.el.on(OGX.SwitchMulti.CHANGE,function(t,e){return p.list.removeFilter(r.property),""!==e&&p.list.addFilter(r.property,r.mode,e),l=p.list.filter(),c=!0,setTimeout(E,0),!1});break;case OGX.Roulette.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),n[r.property].object.el.on(OGX.Roulette.CHANGE,function(t,e){return p.list.removeFilter(r.property),""!==e&&p.list.addFilter(r.property,r.mode,e),l=p.list.filter(),c=!0,setTimeout(E,0),!1})}else if("string"==typeof r.object){if(0===$(r.object).length)return!1;r.object=$(r.object);var e=(n[r.property]=r).object.val();switch(n[r.property].hasOwnProperty("min_length")?(n[r.property].last_val=e).length>=n[r.property].min_length&&(p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e)):(p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e)),r.object.attr("type").toLowerCase()){case"text":case"number":case"email":case"password":case"tel":n[r.property].object.on("input",function(){return e=$(this).val(),p.list.removeFilter(r.property),n[r.property].hasOwnProperty("min_length")?e.length<n[r.property].min_length&&n[r.property].last_val.length>=n[r.property].min_length||e.length>=n[r.property].min_length?(e.length>=n[r.property].min_length&&p.list.addFilter(r.property,r.mode,e),l=p.list.filter(),c=!0,n[r.property].last_val=e,setTimeout(E,0)):n[r.property].last_val=e:(e.length&&p.list.addFilter(r.property,r.mode,e),l=p.list.filter(),c=!0,setTimeout(E,0)),!1});break;case"range":var i;n[r.property].object.on("input",function(){return i=Number($(this).attr("min")),p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,[i,$(this).val()]),l=p.list.filter(),c=!0,setTimeout(E,0),!1})}}}(t)},this.unbind=function(t){return!!n.hasOwnProperty(t)&&L(t)},this.order=function(t,e){return p.list.order(t,e),setTimeout(E,0),!0},this.filter=function(){return l=p.list.filter(),c=!0,setTimeout(E,0),l},this.unfilter=function(){return c=!1,setTimeout(E,0),!0},this.addFilter=function(t,e,i){return p.list.addFilter(t,e,i)},this.removeFilter=function(t,e,i){return p.list.removeFilter(t,e,i)},this.resetFilters=function(){return p.list.resetFilters()},this.getFilters=function(){return p.list.getFilters()},this.insert=function(t,e){var i;p.key||(t[d]=_++);var r=!0;if(c){var s=new OGX.List(t);s.setFilters(p.list.getFilters()),0===s.filter().length?r=!1:l.push(t)}var n=v(t),o='<span class="ogx_dynamic_list_item '+n.css+'" data-id='+t[d]+">"+OGX.Templater.templatize(t,n.html)+"</span>";if(void 0===e)p.list.push(t),r&&m.append(o);else if(p.list.insert(t,e),r){if(c)i=(l=p.list.filter()).findIndex(d,t[d]);else{if(0===e)return m.prepend(o),!0;i=p.list.findIndex(d,t[d])}var a=m.children(".ogx_dynamic_list_item:nth-child("+(i.index+1)+")");0<a.length?a.before(o):m.append(o),p.trigger&&m.trigger(OGX.DynamicList.RENDER)}return r},this.delete=function(t){return!!z().delete(t)&&(m.children(".ogx_dynamic_list_item:eq("+t+")").remove(),!0)},this.deleteSelection=function(){for(var t=z(),e=0;e<a.length;e++)t.findDelete(d,a[e][d],1),m.children(".ogx_dynamic_list_selected_item").remove();return!0},this.findDelete=function(t,e,i){for(var r=p.list.findDelete(t,e,i),s=0;s<r.length;s++)m.children(".ogx_dynamic_list_item[data-id="+r[s][d]+"]:first").remove();return r},this.select=function(t,e){return I(t,e,!0)},this.selectIndex=function(t){return k(t,!0)},this.unselect=function(t,e){return I(t,e,!1)},this.unselectIndex=function(t){return k(t,!1)},this.resetSelection=function(){a=new OGX.List,m.children(".ogx_dynamic_list_selected_item").removeClass("ogx_dynamic_list_selected_item")},this.getSelection=function(t){return void 0===t&&(t=!1),t?m.children(".ogx_dynamic_list_selected_item"):p.key?a:U(JSON.parse(JSON.stringify(a)))},this.replace=function(t,e,i){p.key||(i[d]=_++);var r=p.list.findReplace(t,e,i,1);if(0<r.length){var s=m.children(".ogx_dynamic_list_item[data-id="+r[0][d]+"]:first");if(s.length){var n=v(i),o=OGX.Templater.templatize(i,n.html);s.attr("data-id",i[d]),s.html(o),p.trigger&&m.trigger(OGX.DynamicList.RENDER)}return!0}return!1},this.update=function(t,e,i,r,s){var n,o,a=p.list.findUpdate(t,e,i,r,s);if(a.length){for(var l,c=0;c<a.length;c++)0<(n=m.children(".ogx_dynamic_list_item[data-id="+a[c][d]+"]:first")).length&&(l=v(a[c]),o=OGX.Templater.templatize(a[c],l.html),n.html(o),p.trigger&&m.trigger(OGX.DynamicList.RENDER));return a.length}return!1},this.clear=function(){m.empty()},this.reset=function(){m.empty(),c=!1,p.list=new OGX.List,a=new OGX.List,l=new OGX.List},this.destroy=function(){!function(){for(var t in n)L(t)}(),p.enabled&&D(!1),(p.reorder||p.swipe)&&(x(!1),p.swipe&&N(!1)),m.empty(),m.removeClass("ogx_dynamic_list")},this.render=function(){setTimeout(E,0)},void 0!==OGX.Templater?void 0!==OGX.List?(OGX.hasOwnProperty("TagManager")||(OGX.TagManager={NAME:"OgxTagManager"}),OGX.hasOwnProperty("Switch")||(OGX.Switch={NAME:"OgxSwitch"}),OGX.hasOwnProperty("SwitchMulti")||(OGX.SwitchMulti={NAME:"OgxSwitchMulti"}),OGX.hasOwnProperty("Roulette")||(OGX.Roulette={NAME:"OgxRoulette"}),function(){for(var t in p||(p={}),e)p.hasOwnProperty(t)||(p[t]=e[t]);if(0<p.list.length&&!p.list.hasOwnProperty("insert")&&(p.list=new OGX.List(p.list)),!p.key&&0<p.list.length?(d=r,H()):d=p.key,p.swipe)for(var t in"object"!=typeof p.swipe&&(p.swipe={}),i)p.swipe.hasOwnProperty(t)||(p.swipe[t]=i[t]);$(p.container).append('<div class="ogx_dynamic_list"></div>'),o.el=m=$(p.container).children(".ogx_dynamic_list:first"),void 0===window.ontouchstart||p.chromeos||(h="touchstart",O="touchmove",u="touchend")}(),o.val(p.list),setTimeout(E,0),p.enabled&&D(!0),(p.reorder||p.swipe)&&(x(!0),p.swipe&&N(!0)),setTimeout(function(){m.trigger(OGX.DynamicList.READY)},0)):console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000"):console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000")},OGX.DynamicList.NAME="OgxDynamicList",OGX.DynamicList.HOLD="DynamicListHold",OGX.DynamicList.RELEASE="DynamicListRelease",OGX.DynamicList.DROP="DynamicListDrop",OGX.DynamicList.SELECT="DynamicListSelect",OGX.DynamicList.UNSELECT="DynamicListUnselect",OGX.DynamicList.RENDER="DynamicListRender",OGX.DynamicList.SELECT_MODE_SINGLE="single",OGX.DynamicList.SELECT_MODE_TOGGLE="toggle",OGX.DynamicList.SELECT_MODE_MULTI="multi",OGX.DynamicList.SELECT_MODE_HIT="hit",OGX.DynamicList.SWIPE_LEFT="DynamicListSwipeLeft",OGX.DynamicList.SWIPE_RIGHT="DynamicListSwipeRight",OGX.DynamicList.SWIPE_MODE_DELETE="DynamicListSwipeModeDelete",OGX.DynamicList.SWIPE_MODE_CUSTOM="DynamicListSwipeModeCustom",OGX.DynamicList.READY="DynamicListReady";