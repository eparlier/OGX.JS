OGX.DynamicList=function(t){"use strict";var d,a,c,m,s=this,p=t,e={container:null,enabled:!0,key:!1,display:!1,reorder:!1,chromeos:!1,click_time:100,hold_time:2e3,list:[],mode:OGX.DynamicList.SELECT_MODE_SINGLE,trigger:!1},l=new OGX.List,o={},y=1,i="__id__",g={stime:0,intv:0,target:0,si:0,ei:0},r="mousedown",n="mouseup",u="mousemove";function h(){for(var t,e,i,r=w(),n="",o=0;o<r.length;o++)!1,e="",t=r[o][m],l.find(m,t,1).length&&(e="ogx_dynamic_list_selected_item"),n+='<div class="ogx_dynamic_list_item '+e+" "+(i=f(r[o])).css+'" data-id='+t+">"+OGX.Templater.templatize(r[o],i.html)+"</div>";d.html(n),p.trigger&&d.trigger(OGX.DynamicList.RENDER)}function f(t){var e={html:"",css:""},i=p.display;return i.hasOwnProperty("html")?e.html=i.html:i.hasOwnProperty("template")&&("object"==typeof i.template&&i.template.hasOwnProperty("bind")?t.hasOwnProperty(i.template.bind)&&(e.html=OGX.Templater.getTemplate(t[i.template.bind])):"string"==typeof i.template&&(e.html=OGX.Templater.getTemplate(i.template))),i.hasOwnProperty("css")&&("object"==typeof i.css&&i.css.hasOwnProperty("bind")?t.hasOwnProperty(i.css.bind)&&(e.css=t[i.css.bind]):"string"==typeof i.css&&(e.css=i.css)),e}function _(t){if(o.hasOwnProperty(t)&&"object"==typeof o[t].object)switch(o[t].object._NAME_){case OGX.DynamicList.NAME:o[t].object.el.off(OGX.DynamicList.SELECT),o[t].object.el.off(OGX.DynamicList.UNSELECT);break;case OGX.TagManager.NAME:o[t].object.el.off(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED);break;case OGX.Switch.NAME:o[t].object.el.off(OGX.Switch.TOGGLE);break;case OGX.SwitchMulti.NAME:o[t].object.el.off(OGX.SwitchMulti.CHANGE);break;case OGX.Roulette.NAME:o[t].object.el.off(OGX.Roulette.CHANGE);break;default:o[t].object.off("input")}else o[t].object.off("input");return p.list.removeFilter(t),delete o[t],a=p.list.filter(),c=!0,setTimeout(h,0),!0}function O(t,e){for(var i=o[t].object.getSelection(),r=[],n=0;n<i.length;n++)r.push(i[n][e]);return r}function E(t){t?d.on("click",".ogx_dynamic_list_item",T):d.off("click",".ogx_dynamic_list_item",T)}function G(t){g.target=$(t.currentTarget),g.si=g.target.index(),t=S(t),g.starty=t.pageY,g.intv&&clearInterval(g.intv),g.stime=(new Date).getTime(),g.intv=setInterval(v,20)}function v(){(new Date).getTime()-g.stime>p.hold_time&&(g.item=p.list.find(m,g.target.data("id").toString(),1),d.trigger(OGX.DynamicList.HOLD,g.item),clearInterval(g.intv),function(){g.tgy=g.target.position().top,g.tgx=g.target.position().left,g.y=0;var t=g.target.outerWidth(),e=g.target.outerHeight();g.clone=g.target.clone().css({position:"absolute",left:g.tgx+"px",top:g.tgy+"px",width:t+"px",height:e+"px"}).addClass("ogx_dynamic_list_reorder").prependTo(d),g.target.addClass("ogx_dynamic_list_frozen"),g.intv=setInterval(X,10),$(document).on(u,D)}())}function L(t){if(t.preventDefault(),t.stopImmediatePropagation(),clearInterval(g.intv),g.intv=!1,$(document).off(u,D),g.clone){var e=JSON.parse(JSON.stringify(p.list[g.si]));return p.list.delete(g.si),p.list.insert(e,g.ei),g.clone.remove(),g.clone=!1,g.target.removeClass("ogx_dynamic_list_frozen"),void d.trigger(OGX.DynamicList.DROP,g.item)}if((new Date).getTime()-g.stime<p.click_time){var i=g.target.data("id").toString(),r=p.list.find(m,i,1);d.trigger(OGX.DynamicList.SELECT,r),s.select(m,i)}}function D(t){t=S(t),g.y=-1*(g.starty-t.pageY)}function X(){var i=!1,t=d.children(".ogx_dynamic_list_item:last"),e=t.offset().top;if(g.tgy+g.y<e?g.clone.css({top:g.tgy+g.y}):i=t,!i){var r,n,o,s,l=0;d.children(".ogx_dynamic_list_item").each(function(t,e){if((e=$(e))[0]!==g.clone[0]&&!e.hasClass("ogx_dynamic_list_frozen")){if(r=e.offset().top,n=e.outerHeight(),s=r+n/2,o=g.clone.offset().top,r<o&&o<s)return l=-1,void(i=e);if(s<o&&o<r+n)return l=1,void(i=e)}})}if(i){switch(g.ei=p.list.findIndex(m,$(i).data("id").toString()).index,l){case-1:i.index()-1!==g.target.index()&&g.target.detach().insertBefore(i);break;case 1:i.index()+1!==g.target.index()&&g.target.detach().insertAfter(i)}i=!1}}function T(t){switch(p.mode){case OGX.DynamicList.SELECT_MODE_SINGLE:$(this).hasClass("ogx_dynamic_list_selected_item")||(x($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,l[l.length-1]));break;case OGX.DynamicList.SELECT_MODE_TOGGLE:$(this).hasClass("ogx_dynamic_list_selected_item")?(x($(this).index(),!1),d.trigger(OGX.DynamicList.UNSELECT)):(s.resetSelection(),x($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,l[l.length-1]));break;case OGX.DynamicList.SELECT_MODE_MULTI:$(this).hasClass("ogx_dynamic_list_selected_item")?(x($(this).index(),!1),d.trigger(OGX.DynamicList.UNSELECT)):(x($(this).index(),!0),d.trigger(OGX.DynamicList.SELECT,l))}}function b(t,e,i){"single"===p.mode&&s.resetSelection();for(var r,n=w().find(t,e),o=0;o<n.length;o++)(r=d.find(".ogx_dynamic_list_item[data-id="+n[o][m]+"]:first"))&&(i?(r.addClass("ogx_dynamic_list_selected_item"),l.push(n[o])):r.removeClass("ogx_dynamic_list_selected_item"));return"single"===p.mode&&n.length?n[0]:n}function x(t,e){var i,r=w();return 0<(i=d.find(".ogx_dynamic_list_item:eq("+t+")")).length&&(p.mode===OGX.DynamicList.SELECT_MODE_SINGLE&&s.resetSelection(),e?(i.addClass("ogx_dynamic_list_selected_item"),l.push(r[t])):(i.removeClass("ogx_dynamic_list_selected_item"),l.findDelete(m,i.data("id"),1)),!0)}function S(t){return t.hasOwnProperty("originalEvent")&&void 0!==t.originalEvent.changedTouches?t.originalEvent.changedTouches[0]:t}function w(){return c?a:p.list}function M(){for(var t=0;t<p.list.length;t++)p.list[t][m]=String(y),y++}function C(t){for(var e=0;e<t.length;e++)delete t[e][m];return t}this._NAME_=OGX.DynamicList.NAME,this.el=null,this.val=function(t){if(void 0===t)return p.key?p.list:C(JSON.parse(JSON.stringify(p.list)));t.hasOwnProperty("insert")||(t=new OGX.List(t)),p.list=t,p.key||(y=1,m=i,M()),setTimeout(h,0)},this.getFilteredList=function(){return!!c&&a},this.display=function(t){return void 0===t?p.display:(p.display=t,!0)},this.mode=function(t){return void 0===t?p.mode:(p.mode=t,!0)},this.enable=function(){return!p.enabled&&(E(p.enabled=!0),!0)},this.disable=function(){return!!p.enabled&&(E(p.enabled=!1),!0)},this.bind=function(t){return!o.hasOwnProperty(t.property)&&function(r){r.hasOwnProperty("mode")||(r.mode="eqjson");if("object"==typeof r.object)switch((o[r.property]=r).object._NAME_){case OGX.DynamicList.NAME:p.list.removeFilter(r.property);var t=O(r.property,r.remote_property);p.list.addFilter(r.property,r.mode,t),o[r.property].object.el.on(OGX.DynamicList.SELECT,function(t,e){var i;return p.list.removeFilter(r.property),i=o[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||o[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?o[r.property].object.getSelection()[0][r.remote_property]:O(r.property,r.remote_property),p.list.addFilter(r.property,r.mode,i),a=p.list.filter(),c=!0,setTimeout(h,0),!1}),o[r.property].object.el.on(OGX.DynamicList.UNSELECT,function(t,e){var i;return p.list.removeFilter(r.property),0<(i=o[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_SINGLE||o[r.property].object.mode()===OGX.DynamicList.SELECT_MODE_TOGGLE?[]:O(r.property,r.remote_property)).length&&p.list.addFilter(r.property,r.mode,i),a=p.list.filter(),c=!0,setTimeout(h,0),!1});break;case OGX.TagManager.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.getCurrentTags()),o[r.property].object.el.on(OGX.TagManager.TAG_ADDED+" "+OGX.TagManager.TAG_REMOVED,function(t,e){return p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,o[r.property].object.getCurrentTags()),a=p.list.filter(),c=!0,setTimeout(h,0),!1});break;case OGX.Switch.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),o[r.property].object.el.on(OGX.Switch.TOGGLE,function(t,e){return p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,setTimeout(h,0),!1});break;case OGX.SwitchMulti.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),o[r.property].object.el.on(OGX.SwitchMulti.CHANGE,function(t,e){return p.list.removeFilter(r.property),""!==e&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,setTimeout(h,0),!1});break;case OGX.Roulette.NAME:p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,r.object.val()),o[r.property].object.el.on(OGX.Roulette.CHANGE,function(t,e){return p.list.removeFilter(r.property),""!==e&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,setTimeout(h,0),!1})}else if("string"==typeof r.object){if(0===$(r.object).length)return!1;r.object=$(r.object);var e=(o[r.property]=r).object.val();switch(o[r.property].hasOwnProperty("min_length")?(o[r.property].last_val=e).length>=o[r.property].min_length&&(p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e)):(p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,e)),r.object.attr("type").toLowerCase()){case"text":case"number":case"email":case"password":case"tel":o[r.property].object.on("input",function(){return e=$(this).val(),p.list.removeFilter(r.property),o[r.property].hasOwnProperty("min_length")?e.length<o[r.property].min_length&&o[r.property].last_val.length>=o[r.property].min_length||e.length>=o[r.property].min_length?(e.length>=o[r.property].min_length&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,o[r.property].last_val=e,setTimeout(h,0)):o[r.property].last_val=e:(e.length&&p.list.addFilter(r.property,r.mode,e),a=p.list.filter(),c=!0,setTimeout(h,0)),!1});break;case"range":var i;o[r.property].object.on("input",function(){return i=Number($(this).attr("min")),p.list.removeFilter(r.property),p.list.addFilter(r.property,r.mode,[i,$(this).val()]),a=p.list.filter(),c=!0,setTimeout(h,0),!1})}}}(t)},this.unbind=function(t){return!!o.hasOwnProperty(t)&&_(t)},this.order=function(t,e){return p.list.order(t,e),setTimeout(h,0),!0},this.filter=function(){return a=p.list.filter(),c=!0,setTimeout(h,0),a},this.unfilter=function(){return c=!1,setTimeout(h,0),!0},this.addFilter=function(t,e,i){return p.list.addFilter(t,e,i)},this.removeFilter=function(t,e,i){return p.list.removeFilter(t,e,i)},this.resetFilters=function(){return p.list.resetFilters()},this.getFilters=function(){return p.list.getFilters()},this.insert=function(t,e){var i;p.key||(t[m]=y++);var r=!0;if(c){var n=new OGX.List(t);n.setFilters(p.list.getFilters()),0===n.filter().length?r=!1:a.push(t)}var o=f(t),s='<span class="ogx_dynamic_list_item '+o.css+'" data-id='+t[m]+">"+OGX.Templater.templatize(t,o.html)+"</span>";if(void 0===e)p.list.push(t),r&&d.append(s);else if(p.list.insert(t,e),r){if(c)i=(a=p.list.filter()).findIndex(m,t[m]);else{if(0===e)return d.prepend(s),!0;i=p.list.findIndex(m,t[m])}var l=d.children(".ogx_dynamic_list_item:nth-child("+(i.index+1)+")");0<l.length?l.before(s):d.append(s),p.trigger&&d.trigger(OGX.DynamicList.RENDER)}return r},this.delete=function(t){return!!w().delete(t)&&(d.children(".ogx_dynamic_list_item:eq("+t+")").remove(),!0)},this.deleteSelection=function(){for(var t=w(),e=0;e<l.length;e++)t.findDelete(m,l[e][m],1),d.children(".ogx_dynamic_list_selected_item").remove();return!0},this.findDelete=function(t,e,i){for(var r=p.list.findDelete(t,e,i),n=0;n<r.length;n++)d.children(".ogx_dynamic_list_item[data-id="+r[n][m]+"]:first").remove();return r},this.select=function(t,e){return b(t,e,!0)},this.selectIndex=function(t){return x(t,!0)},this.unselect=function(t,e){return b(t,e,!1)},this.unselectIndex=function(t){return x(t,!1)},this.resetSelection=function(){l=new OGX.List,d.children(".ogx_dynamic_list_selected_item").removeClass("ogx_dynamic_list_selected_item")},this.getSelection=function(t){return void 0===t&&(t=!1),t?d.children(".ogx_dynamic_list_selected_item"):p.key?l:C(JSON.parse(JSON.stringify(l)))},this.replace=function(t,e,i){p.key||(i[m]=y++);var r=p.list.findReplace(t,e,i,1);if(0<r.length){var n=d.children(".ogx_dynamic_list_item[data-id="+r[0][m]+"]:first");if(n.length){var o=f(i),s=OGX.Templater.templatize(i,o.html);n.attr("data-id",i[m]),n.html(s),p.trigger&&d.trigger(OGX.DynamicList.RENDER)}return!0}return!1},this.update=function(t,e,i,r,n){var o,s,l=p.list.findUpdate(t,e,i,r,n);if(l.length){for(var a,c=0;c<l.length;c++)0<(o=d.children(".ogx_dynamic_list_item[data-id="+l[c][m]+"]:first")).length&&(a=f(l[c]),s=OGX.Templater.templatize(l[c],a.html),o.html(s),p.trigger&&d.trigger(OGX.DynamicList.RENDER));return l.length}return!1},this.clear=function(){d.empty()},this.reset=function(){d.empty(),c=!1,p.list=new OGX.List,l=new OGX.List,a=new OGX.List},this.destroy=function(){!function(){for(var t in o)_(t)}(),p.enabled&&E(!1),d.empty(),d.removeClass("ogx_dynamic_list")},this.render=function(){setTimeout(h,0)},void 0!==OGX.Templater?void 0!==OGX.List?(OGX.hasOwnProperty("TagManager")||(OGX.TagManager={NAME:"OgxTagManager"}),OGX.hasOwnProperty("Switch")||(OGX.Switch={NAME:"OgxSwitch"}),OGX.hasOwnProperty("SwitchMulti")||(OGX.SwitchMulti={NAME:"OgxSwitchMulti"}),OGX.hasOwnProperty("Roulette")||(OGX.Roulette={NAME:"OgxRoulette"}),function(){for(var t in p||(p={}),e)p.hasOwnProperty(t)||(p[t]=e[t]);0<p.list.length&&!p.list.hasOwnProperty("insert")&&(p.list=new OGX.List(p.list)),!p.key&&0<p.list.length?(m=i,M()):m=p.key,$(p.container).append('<div class="ogx_dynamic_list"></div>'),s.el=d=$(p.container).children(".ogx_dynamic_list:first"),void 0===window.ontouchstart||p.chromeos||(r="touchstart",u="touchmove",n="touchend")}(),s.val(p.list),setTimeout(h,0),p.enabled&&E(!0),p.reorder&&(d.on(r,".ogx_dynamic_list_item",G),$(document).on(n,".ogx_dynamic_list_item",L)),setTimeout(function(){d.trigger(OGX.DynamicList.READY)},0)):console.log("%c CRITICAL ERROR - OGX.List not found! ","background:#222; color: #FF0000"):console.log("%c CRITICAL ERROR - OGX.Templater not found! ","background:#222; color: #FF0000")},OGX.DynamicList.NAME="OgxDynamicList",OGX.DynamicList.HOLD="DynamicListHold",OGX.DynamicList.DROP="DynamicListDrop",OGX.DynamicList.SELECT="DynamicListSelect",OGX.DynamicList.UNSELECT="DynamicListUnselect",OGX.DynamicList.RENDER="DynamicListRender",OGX.DynamicList.SELECT_MODE_SINGLE="single",OGX.DynamicList.SELECT_MODE_TOGGLE="toggle",OGX.DynamicList.SELECT_MODE_MULTI="multi",OGX.DynamicList.READY="DynamicListReady";